<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Dados para Firebase</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            padding: 20px;
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        }
        
        .app-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .app-header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .app-header p {
            color: #666;
        }
        
        .mode-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #ddd;
        }
        
        .mode-button {
            padding: 12px 30px;
            background: #f0f0f0;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            border-radius: 5px 5px 0 0;
            margin: 0 5px;
        }
        
        .mode-button.active {
            background: #4285F4;
            color: white;
        }
        
        .mode-button:hover:not(.active) {
            background: #e0e0e0;
        }
        
        .mode-content {
            display: none;
        }
        
        .mode-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 5px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: #4285F4;
            outline: none;
        }
        
        .tab-manager {
            background: #f9f9f9;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .tab-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab-item {
            background: white;
            border: 2px solid #ddd;
            border-radius: 5px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 200px;
        }
        
        .tab-name {
            font-weight: bold;
            margin-right: 10px;
        }
        
        .remove-tab {
            background: #ff4444;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .add-tab-form {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .add-tab-form input {
            flex: 1;
        }
        
        .editor-container {
            margin-top: 20px;
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .editor-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .editor-tab {
            padding: 8px 15px;
            background: #f0f0f0;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .editor-tab.active {
            background: #4285F4;
            color: white;
        }
        
        .editor-area {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            resize: vertical;
        }
        
        .editor-area:focus {
            border-color: #4285F4;
            outline: none;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }
        
        .btn {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }
        
        .btn-primary {
            background: #4285F4;
            color: white;
        }
        
        .btn-primary:hover {
            background: #357ae8;
        }
        
        .btn-secondary {
            background: #34A853;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #2d9249;
        }
        
        .btn-danger {
            background: #EA4335;
            color: white;
        }
        
        .btn-danger:hover {
            background: #d33426;
        }
        
        .status-message {
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        .password-section {
            background: #fff8e1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }
        
        .viewer-container {
            margin-top: 30px;
        }
        
        .viewer-container .iframe-container {
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .mode-button {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .add-tab-form {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="app-header">
            <h1>üìÑ Gerador de Dados para Firebase</h1>
            <p>Crie e gerencie documentos na cole√ß√£o "gespai" do Firebase Firestore</p>
        </div>
        
        <div class="mode-selector">
            <button class="mode-button active" onclick="switchMode('editor')">‚úèÔ∏è Editor</button>
            <button class="mode-button" onclick="switchMode('viewer')">üëÅÔ∏è Visualizador</button>
        </div>
        
        <!-- MODO EDITOR -->
        <div id="editorMode" class="mode-content active">
            <div class="form-group">
                <label for="documentId">ID do Documento:</label>
                <input type="text" id="documentId" class="form-control" 
                       placeholder="Digite o ID √∫nico do documento (ex: usuario_123)">
                <small style="color: #666;">Este ser√° o nome do documento na cole√ß√£o "gespai"</small>
            </div>
            
            <div class="password-section">
                <h3 style="margin-top: 0;">üîê Criptografia (Opcional)</h3>
                <div class="checkbox-group">
                    <input type="checkbox" id="encryptData" onchange="toggleEncryption()">
                    <label for="encryptData">Criptografar conte√∫do das abas</label>
                </div>
                
                <div id="encryptionFields" style="display: none;">
                    <div class="form-group">
                        <label for="encryptionKey">Chave de Criptografia:</label>
                        <input type="password" id="encryptionKey" class="form-control" 
                               placeholder="Digite uma senha para criptografar">
                        <small style="color: #666;">Mesma senha ser√° necess√°ria para visualizar</small>
                    </div>
                </div>
            </div>
            
            <div class="tab-manager">
                <h3>üìë Gerenciador de Abas</h3>
                <p>Adicione abas que ser√£o convertidas em campos do documento</p>
                
                <div id="tabList" class="tab-list">
                    <!-- Tabs ser√£o adicionadas aqui -->
                </div>
                
                <div class="add-tab-form">
                    <input type="text" id="newTabName" class="form-control" 
                           placeholder="Nome da aba (ex: home, perfil, config)">
                    <button type="button" class="btn btn-primary" onclick="addNewTab()">+ Adicionar Aba</button>
                </div>
            </div>
            
            <div class="editor-container" id="editorContainer">
                <!-- Editor ser√° criado dinamicamente -->
            </div>
            
            <div class="action-buttons">
                <button type="button" class="btn btn-primary" onclick="saveToFirebase()">
                    üíæ Salvar no Firebase
                </button>
                <button type="button" class="btn btn-secondary" onclick="loadFromFirebase()">
                    üìÇ Carregar do Firebase
                </button>
                <button type="button" class="btn btn-danger" onclick="clearAll()">
                    üóëÔ∏è Limpar Tudo
                </button>
            </div>
            
            <div id="statusMessage" class="status-message"></div>
        </div>
        
        <!-- MODO VISUALIZADOR -->
        <div id="viewerMode" class="mode-content">
            <div class="form-group">
                <label for="viewerDocId">ID do Documento para Visualizar:</label>
                <input type="text" id="viewerDocId" class="form-control" 
                       placeholder="Digite o ID do documento">
            </div>
            
            <div class="form-group">
                <label for="viewerPassword">Senha (se criptografado):</label>
                <input type="password" id="viewerPassword" class="form-control" 
                       placeholder="Deixe em branco se n√£o houver criptografia">
            </div>
            
            <div class="action-buttons">
                <button type="button" class="btn btn-primary" onclick="loadForViewing()">
                    üëÅÔ∏è Visualizar Documento
                </button>
            </div>
            
            <div id="viewerStatus" class="status-message"></div>
            
            <div id="viewerContent" class="viewer-container" style="display: none;">
                <div class="tabs" id="viewerTabs"></div>
                <div id="viewerIframesContainer"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <script>
        // Configura√ß√£o do Firebase (SUBSTITUA COM SUAS CONFIGURA√á√ïES)
        const firebaseConfig = {
            apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0",
            authDomain: "wzzm-ce3fc.firebaseapp.com",
            projectId: "wzzm-ce3fc",
            storageBucket: "wzzm-ce3fc.appspot.com",
            messagingSenderId: "249427877153",
            appId: "1:249427877153:web:0e4297294794a5aadeb260",
            measurementId: "G-PLKNZNFCQ8"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Estado da aplica√ß√£o
        let tabs = [];
        let activeEditorTab = null;
        let currentDocumentId = '';

        // Inicializar com uma aba padr√£o
        document.addEventListener('DOMContentLoaded', function() {
            addTab('home', '<h1>Conte√∫do da P√°gina Inicial</h1>\n<p>Edite este conte√∫do como desejar.</p>');
        });

        // Alternar entre modos
        function switchMode(mode) {
            document.querySelectorAll('.mode-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.mode-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`[onclick="switchMode('${mode}')"]`).classList.add('active');
            document.getElementById(mode + 'Mode').classList.add('active');
            
            if (mode === 'editor') {
                document.title = "Gerador de Dados para Firebase";
            } else {
                document.title = "Visualizador de Dados do Firebase";
            }
        }

        // Mostrar/ocultar campos de criptografia
        function toggleEncryption() {
            const encryptCheckbox = document.getElementById('encryptData');
            const encryptionFields = document.getElementById('encryptionFields');
            encryptionFields.style.display = encryptCheckbox.checked ? 'block' : 'none';
        }

        // Adicionar nova aba
        function addNewTab() {
            const tabNameInput = document.getElementById('newTabName');
            const tabName = tabNameInput.value.trim();
            
            if (!tabName) {
                showStatus('Por favor, digite um nome para a aba.', 'error');
                return;
            }
            
            if (tabs.some(tab => tab.name === tabName)) {
                showStatus('J√° existe uma aba com este nome.', 'error');
                return;
            }
            
            addTab(tabName, `<h1>${tabName}</h1>\n<p>Conte√∫do da aba ${tabName}</p>`);
            tabNameInput.value = '';
            showStatus(`Aba "${tabName}" adicionada com sucesso.`, 'success');
        }

        // Adicionar aba ao sistema
        function addTab(name, content = '') {
            tabs.push({ name, content });
            renderTabList();
            renderEditor();
            setActiveEditorTab(name);
        }

        // Remover aba
        function removeTab(tabName) {
            tabs = tabs.filter(tab => tab.name !== tabName);
            renderTabList();
            renderEditor();
            
            if (activeEditorTab === tabName) {
                activeEditorTab = tabs.length > 0 ? tabs[0].name : null;
                renderEditor();
            }
            
            showStatus(`Aba "${tabName}" removida.`, 'info');
        }

        // Renderizar lista de abas
        function renderTabList() {
            const tabList = document.getElementById('tabList');
            tabList.innerHTML = '';
            
            tabs.forEach(tab => {
                const tabElement = document.createElement('div');
                tabElement.className = 'tab-item';
                tabElement.innerHTML = `
                    <span class="tab-name">${tab.name}</span>
                    <button class="remove-tab" onclick="removeTab('${tab.name}')">&times;</button>
                `;
                tabList.appendChild(tabElement);
            });
        }

        // Renderizar editor
        function renderEditor() {
            const editorContainer = document.getElementById('editorContainer');
            
            if (tabs.length === 0) {
                editorContainer.innerHTML = '<p style="text-align: center; color: #666;">Adicione uma aba para come√ßar a editar.</p>';
                return;
            }
            
            let html = '<div class="editor-header">';
            html += '<h3>Editor de Conte√∫do</h3>';
            html += '<div class="editor-tabs">';
            
            tabs.forEach(tab => {
                const activeClass = tab.name === activeEditorTab ? 'active' : '';
                html += `<div class="editor-tab ${activeClass}" onclick="setActiveEditorTab('${tab.name}')">${tab.name}</div>`;
            });
            
            html += '</div></div>';
            
            const activeTab = tabs.find(tab => tab.name === activeEditorTab) || tabs[0];
            if (activeTab) {
                html += `<textarea class="editor-area" id="editorContent" 
                          oninput="updateTabContent('${activeTab.name}', this.value)">${activeTab.content}</textarea>`;
            }
            
            editorContainer.innerHTML = html;
        }

        // Definir aba ativa no editor
        function setActiveEditorTab(tabName) {
            activeEditorTab = tabName;
            renderEditor();
        }

        // Atualizar conte√∫do da aba
        function updateTabContent(tabName, content) {
            const tab = tabs.find(t => t.name === tabName);
            if (tab) {
                tab.content = content;
            }
        }

        // Mostrar mensagem de status
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status-message status-${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // Salvar no Firebase
        async function saveToFirebase() {
            const docId = document.getElementById('documentId').value.trim();
            
            if (!docId) {
                showStatus('Por favor, digite um ID para o documento.', 'error');
                return;
            }
            
            if (tabs.length === 0) {
                showStatus('Adicione pelo menos uma aba antes de salvar.', 'error');
                return;
            }
            
            try {
                // Preparar dados
                const data = {};
                const encryptData = document.getElementById('encryptData').checked;
                const encryptionKey = document.getElementById('encryptionKey').value;
                
                for (const tab of tabs) {
                    if (encryptData && encryptionKey) {
                        // Criptografar conte√∫do
                        const encrypted = CryptoJS.AES.encrypt(tab.content, encryptionKey).toString();
                        data[tab.name] = encrypted;
                    } else {
                        data[tab.name] = tab.content;
                    }
                }
                
                // Adicionar metadados
                data._metadata = {
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    tabsCount: tabs.length,
                    encrypted: encryptData,
                    version: '1.0'
                };
                
                // Salvar no Firestore
                await db.collection('gespai').doc(docId).set(data, { merge: true });
                
                showStatus(`‚úÖ Documento "${docId}" salvo com sucesso na cole√ß√£o "gespai"!`, 'success');
                currentDocumentId = docId;
                
            } catch (error) {
                console.error('Erro ao salvar:', error);
                showStatus(`‚ùå Erro ao salvar: ${error.message}`, 'error');
            }
        }

        // Carregar do Firebase
        async function loadFromFirebase() {
            const docId = document.getElementById('documentId').value.trim();
            
            if (!docId) {
                showStatus('Por favor, digite um ID para carregar.', 'error');
                return;
            }
            
            try {
                showStatus('Carregando documento...', 'info');
                
                const docRef = db.collection('gespai').doc(docId);
                const doc = await docRef.get();
                
                if (!doc.exists) {
                    showStatus('Documento n√£o encontrado.', 'error');
                    return;
                }
                
                const data = doc.data();
                
                // Limpar abas atuais
                tabs = [];
                
                // Processar dados (ignorar metadados)
                for (const key in data) {
                    if (key !== '_metadata') {
                        tabs.push({ name: key, content: data[key] });
                    }
                }
                
                // Atualizar interface
                renderTabList();
                renderEditor();
                
                currentDocumentId = docId;
                showStatus(`‚úÖ Documento "${docId}" carregado com sucesso!`, 'success');
                
            } catch (error) {
                console.error('Erro ao carregar:', error);
                showStatus(`‚ùå Erro ao carregar: ${error.message}`, 'error');
            }
        }

        // Limpar tudo
        function clearAll() {
            if (confirm('Tem certeza que deseja limpar tudo? Todas as abas ser√£o perdidas.')) {
                tabs = [];
                document.getElementById('documentId').value = '';
                document.getElementById('encryptData').checked = false;
                document.getElementById('encryptionKey').value = '';
                toggleEncryption();
                renderTabList();
                renderEditor();
                showStatus('‚úÖ Tudo limpo!', 'success');
            }
        }

        // ===== FUN√á√ïES DO VISUALIZADOR =====
        
        // Carregar documento para visualiza√ß√£o
        async function loadForViewing() {
            const docId = document.getElementById('viewerDocId').value.trim();
            const password = document.getElementById('viewerPassword').value;
            
            if (!docId) {
                showViewerStatus('Por favor, digite um ID do documento.', 'error');
                return;
            }
            
            try {
                showViewerStatus('Carregando...', 'info');
                
                const docRef = db.collection('gespai').doc(docId);
                const doc = await docRef.get();
                
                if (!doc.exists) {
                    showViewerStatus('Documento n√£o encontrado.', 'error');
                    return;
                }
                
                const data = doc.data();
                
                // Limpar visualiza√ß√£o anterior
                document.getElementById('viewerTabs').innerHTML = '';
                document.getElementById('viewerIframesContainer').innerHTML = '';
                
                // Processar cada campo
                let hasContent = false;
                
                for (const key in data) {
                    if (key !== '_metadata') {
                        let content = data[key];
                        
                        // Tentar descriptografar se parecer criptografado
                        if (password && typeof content === 'string' && content.includes('U2FsdGVk')) {
                            try {
                                const bytes = CryptoJS.AES.decrypt(content, password);
                                content = bytes.toString(CryptoJS.enc.Utf8);
                            } catch (e) {
                                // Continua com conte√∫do criptografado
                            }
                        }
                        
                        // Adicionar aba no visualizador
                        addViewerTab(content, key);
                        hasContent = true;
                    }
                }
                
                if (hasContent) {
                    document.getElementById('viewerContent').style.display = 'block';
                    showViewerStatus(`‚úÖ Documento "${docId}" carregado com sucesso!`, 'success');
                } else {
                    showViewerStatus('Nenhum conte√∫do encontrado no documento.', 'info');
                }
                
            } catch (error) {
                console.error('Erro ao carregar para visualiza√ß√£o:', error);
                showViewerStatus(`‚ùå Erro: ${error.message}`, 'error');
            }
        }

        // Adicionar aba no visualizador
        function addViewerTab(htmlContent, tabName) {
            // Criar bot√£o da aba
            const tabButton = document.createElement('div');
            tabButton.className = 'tab';
            tabButton.innerText = tabName;
            tabButton.onclick = () => setActiveViewerTab(tabName);
            document.getElementById('viewerTabs').appendChild(tabButton);
            
            // Criar container do iframe
            const iframeContainer = document.createElement('div');
            iframeContainer.className = 'iframe-container';
            
            const iframe = document.createElement('iframe');
            iframe.id = 'viewer_' + tabName;
            iframe.srcdoc = htmlContent;
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            iframe.style.border = 'none';
            
            iframeContainer.appendChild(iframe);
            document.getElementById('viewerIframesContainer').appendChild(iframeContainer);
            
            // Primeira aba ativa
            if (document.querySelectorAll('#viewerTabs .tab').length === 1) {
                tabButton.classList.add('active');
                iframe.style.display = 'block';
            } else {
                iframe.style.display = 'none';
            }
        }

        // Definir aba ativa no visualizador
        function setActiveViewerTab(tabName) {
            const tabs = document.querySelectorAll('#viewerTabs .tab');
            const iframes = document.querySelectorAll('#viewerIframesContainer iframe');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            iframes.forEach(iframe => iframe.style.display = 'none');
            
            const activeIframe = document.getElementById('viewer_' + tabName);
            const activeTab = Array.from(tabs).find(tab => tab.innerText === tabName);
            
            if (activeIframe) activeIframe.style.display = 'block';
            if (activeTab) activeTab.classList.add('active');
        }

        // Mostrar status no visualizador
        function showViewerStatus(message, type = 'info') {
            const statusDiv = document.getElementById('viewerStatus');
            statusDiv.textContent = message;
            statusDiv.className = `status-message status-${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // Permitir Enter nos campos
        document.getElementById('documentId').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') loadFromFirebase();
        });
        
        document.getElementById('viewerDocId').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') loadForViewing();
        });
        
        document.getElementById('newTabName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addNewTab();
        });
    </script>
</body>
</html>
