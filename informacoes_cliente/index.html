<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informa√ß√µes do Cliente - WZZM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* Tela de Login */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
        }

        .login-container {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }

        .login-logo {
            font-size: 4rem;
            color: #667eea;
            margin-bottom: 20px;
        }

        .login-title {
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .login-subtitle {
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        .login-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            background: #4285f4;
            color: white;
            border: none;
            padding: 18px 30px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .login-button:hover {
            background: #357ae8;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(66, 133, 244, 0.3);
        }

        .login-button-google {
            background: #4285f4;
        }

        .login-button-google:hover {
            background: #357ae8;
        }

        .login-button-icon {
            font-size: 1.5rem;
            background: white;
            color: #4285f4;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .login-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-top: 30px;
            font-size: 0.9rem;
            color: #666;
            text-align: left;
        }

        .login-info h4 {
            color: #333;
            margin-bottom: 10px;
        }

        /* Interface Principal */
        .main-container {
            display: none;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .user-info h2 {
            font-size: 1.8rem;
            font-weight: 300;
            margin-bottom: 5px;
        }

        .user-info p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .admin-badge {
            background: #4caf50;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .btn-logout {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-logout:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Conte√∫do Principal */
        .content {
            padding: 40px;
        }

        /* Loading */
        .loading-container {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Erros */
        .error-container {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        /* Cards de Dados */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .data-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .data-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .data-card h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .data-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .value {
            color: #333;
            font-size: 1.1rem;
            word-break: break-word;
        }

        /* Status */
        .status-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .status-active { background: #e8f5e9; color: #2e7d32; }
        .status-inactive { background: #fff3e0; color: #f57c00; }
        .status-banned { background: #ffebee; color: #c62828; }

        /* A√ß√µes */
        .actions-container {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #eee;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #666;
            border: 2px solid #ddd;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* Debug */
        .debug-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff9800;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
            z-index: 1000;
            border: none;
        }

        .debug-button:hover {
            transform: scale(1.1);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .header-left {
                flex-direction: column;
                text-align: center;
            }
            
            .header-actions {
                flex-direction: column;
                width: 100%;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .data-grid {
                grid-template-columns: 1fr;
            }
            
            .login-container {
                padding: 30px 20px;
            }
            
            .content {
                padding: 20px;
            }
        }

        /* Modal de Cria√ß√£o de Perfil */
        .profile-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .profile-modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-title {
            font-size: 2rem;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .modal-text {
            color: #666;
            margin-bottom: 30px;
            text-align: center;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 15px 30px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            min-width: 150px;
        }

        .modal-btn-primary {
            background: #667eea;
            color: white;
        }

        .modal-btn-secondary {
            background: #f5f5f5;
            color: #666;
            border: 2px solid #ddd;
        }
    </style>
</head>
<body>
    <!-- Bot√£o de Debug -->
    <button class="debug-button" onclick="debugFirebase()" title="Debug Firebase">
        üêõ
    </button>

    <!-- Tela de Login -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="login-logo">üë§</div>
            <h1 class="login-title">Informa√ß√µes do Cliente</h1>
            <p class="login-subtitle">Fa√ßa login para acessar seus dados pessoais</p>
            
            <button class="login-button login-button-google" onclick="loginWithGoogle()">
                <span class="login-button-icon">G</span>
                <span>Entrar com Google</span>
            </button>
            
            <div class="login-info">
                <h4>‚ÑπÔ∏è Como funciona:</h4>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>Seu perfil ser√° criado automaticamente no primeiro login</li>
                    <li>Voc√™ pode visualizar e editar suas informa√ß√µes pessoais</li>
                    <li>Administradores podem acessar todos os perfis</li>
                    <li>Seus dados s√£o protegidos por criptografia</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Interface Principal (ap√≥s login) -->
    <div class="main-container" id="mainContainer">
        <!-- Header com informa√ß√µes do usu√°rio -->
        <div class="header">
            <div class="header-left">
                <div class="user-avatar" id="userAvatar">
                    üë§
                </div>
                <div class="user-info">
                    <h2 id="userName">Carregando...</h2>
                    <p id="userEmail">email@exemplo.com</p>
                </div>
            </div>
            
            <div class="header-actions">
                <div class="admin-badge" id="adminBadge" style="display: none;">
                    ADMIN
                </div>
                <button class="btn-logout" onclick="logout()">
                    Sair
                </button>
            </div>
        </div>

        <!-- Conte√∫do Principal -->
        <div class="content">
            <!-- Loading -->
            <div class="loading-container" id="loadingContainer">
                <div class="spinner"></div>
                <h3>Carregando suas informa√ß√µes...</h3>
                <p>Aguarde enquanto buscamos seus dados no sistema.</p>
            </div>

            <!-- Erros -->
            <div class="error-container" id="errorContainer" style="display: none;">
                <h3>‚ö†Ô∏è Erro ao Carregar Dados</h3>
                <p id="errorMessage"></p>
                <div class="actions-container" style="border: none; padding: 0; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="location.reload()">
                        üîÑ Tentar Novamente
                    </button>
                    <button class="btn btn-secondary" onclick="debugFirebase()">
                        üêõ Debug
                    </button>
                </div>
            </div>

            <!-- Dados do Cliente -->
            <div id="dataContainer" style="display: none;">
                <!-- Informa√ß√µes Pessoais -->
                <div class="data-grid">
                    <div class="data-card">
                        <h3>üë§ Identifica√ß√£o</h3>
                        <div class="data-item">
                            <div class="label">UID</div>
                            <div class="value" id="displayUid"></div>
                        </div>
                        <div class="data-item">
                            <div class="label">Nome Completo</div>
                            <div class="value" id="displayFullName"></div>
                        </div>
                        <div class="data-item">
                            <div class="label">CPF</div>
                            <div class="value" id="displayCpf"></div>
                        </div>
                        <div class="data-item">
                            <div class="label">RG</div>
                            <div class="value" id="displayRg"></div>
                        </div>
                        <div class="data-item">
                            <div class="label">Nome Social</div>
                            <div class="value" id="displaySocialName"></div>
                        </div>
                    </div>

                    <div class="data-card">
                        <h3>üéÇ Dados Pessoais</h3>
                        <div class="data-item">
                            <div class="label">Data de Nascimento</div>
                            <div class="value" id="displayBirthDate"></div>
                        </div>
                        <div class="data-item">
                            <div class="label">G√™nero</div>
                            <div class="value" id="displayGender"></div>
                        </div>
                        <div class="data-item">
                            <div class="label">Data de Cadastro</div>
                            <div class="value" id="displayCreatedAt"></div>
                        </div>
                        <div class="data-item">
                            <div class="label">√öltima Atualiza√ß√£o</div>
                            <div class="value" id="displayUpdatedAt"></div>
                        </div>
                    </div>
                </div>

                <!-- Contato e Endere√ßo -->
                <div class="data-grid">
                    <div class="data-card">
                        <h3>üìû Contato</h3>
                        <div class="data-item">
                            <div class="label">Telefone(s)</div>
                            <div class="value" id="displayPhone"></div>
                        </div>
                        <div class="data-item">
                            <div class="label">E-mail(s)</div>
                            <div class="value" id="displayEmail"></div>
                        </div>
                    </div>

                    <div class="data-card">
                        <h3>üè† Endere√ßo</h3>
                        <div class="data-item">
                            <div class="label">Endere√ßo</div>
                            <div class="value" id="displayAddress"></div>
                        </div>
                        <div class="data-item">
                            <div class="label">CEP</div>
                            <div class="value" id="displayZipCode"></div>
                        </div>
                        <div class="data-item">
                            <div class="label">Cidade/Estado</div>
                            <div class="value" id="displayCityState"></div>
                        </div>
                        <div class="data-item">
                            <div class="label">Pa√≠s</div>
                            <div class="value" id="displayCountry"></div>
                        </div>
                    </div>
                </div>

                <!-- Status da Conta -->
                <div class="data-grid">
                    <div class="data-card">
                        <h3>üîê Status da Conta</h3>
                        <div class="data-item">
                            <div class="label">Status Atual</div>
                            <div class="value">
                                <span class="status-badge" id="displayStatus"></span>
                            </div>
                        </div>
                        <div class="data-item">
                            <div class="label">Tipo de Acesso</div>
                            <div class="value" id="displayAccessType"></div>
                        </div>
                    </div>
                </div>

                <!-- A√ß√µes -->
                <div class="actions-container">
                    <button class="btn btn-primary" onclick="editProfile()">
                        ‚úèÔ∏è Editar Perfil
                    </button>
                    <button class="btn btn-secondary" onclick="location.reload()">
                        üîÑ Recarregar
                    </button>
                    <button class="btn btn-secondary" onclick="window.print()">
                        üñ®Ô∏è Imprimir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Cria√ß√£o de Perfil -->
    <div class="profile-modal" id="profileModal">
        <div class="profile-modal-content">
            <h2 class="modal-title">üéâ Bem-vindo!</h2>
            <p class="modal-text">
                Parece que √© sua primeira vez aqui. Gostaria de criar seu perfil agora?
                <br><br>
                Voc√™ poder√° adicionar suas informa√ß√µes pessoais, contato e muito mais.
            </p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" onclick="createProfile()">
                    ‚úÖ Criar Perfil
                </button>
                <button class="modal-btn modal-btn-secondary" onclick="skipProfile()">
                    ‚è≠Ô∏è Pular
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    
    <script>
        // ========== CONFIGURA√á√ÉO DO FIREBASE ==========
        const firebaseConfig = {
            apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0",
            authDomain: "wzzm-ce3fc.firebaseapp.com",
            projectId: "wzzm-ce3fc",
            storageBucket: "wzzm-ce3fc.appspot.com",
            messagingSenderId: "249427877153",
            appId: "1:249427877153:web:0e4297294794a5aadeb260",
            measurementId: "G-PLKNZNFCQ8"
        };

        // Inicializa Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
            console.log('‚úÖ Firebase inicializado');
        }
        
        const firestore = firebase.firestore();
        const auth = firebase.auth();
        const googleProvider = new firebase.auth.GoogleAuthProvider();

        // ========== ELEMENTOS DO DOM ==========
        const loginScreen = document.getElementById('loginScreen');
        const mainContainer = document.getElementById('mainContainer');
        const loadingContainer = document.getElementById('loadingContainer');
        const errorContainer = document.getElementById('errorContainer');
        const errorMessage = document.getElementById('errorMessage');
        const dataContainer = document.getElementById('dataContainer');
        const profileModal = document.getElementById('profileModal');
        
        // Elementos do usu√°rio
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userEmail = document.getElementById('userEmail');
        const adminBadge = document.getElementById('adminBadge');

        // ========== VARI√ÅVEIS GLOBAIS ==========
        let currentUser = null;
        let isAdmin = false;
        let userProfile = null;

        // ========== FUN√á√ïES UTILIT√ÅRIAS ==========
        function getUrlParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        function formatDate(timestamp) {
            if (!timestamp) return 'N√£o informado';
            try {
                const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
                return date.toLocaleDateString('pt-BR') + ' ' + 
                       date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            } catch (e) {
                return 'Data inv√°lida';
            }
        }

        function formatCPF(cpf) {
            if (!cpf) return 'N√£o informado';
            cpf = cpf.toString().replace(/\D/g, '');
            if (cpf.length === 11) {
                return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            }
            return cpf;
        }

        function formatPhone(phone) {
            if (!phone) return 'N√£o informado';
            phone = phone.toString().replace(/\D/g, '');
            if (phone.length === 11) {
                return phone.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (phone.length === 10) {
                return phone.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
            }
            return phone;
        }

        // ========== SISTEMA DE LOGIN ==========
        async function loginWithGoogle() {
            try {
                console.log('üîê Iniciando login com Google...');
                
                // Desativa o bot√£o para evitar m√∫ltiplos cliques
                const loginBtn = document.querySelector('.login-button');
                loginBtn.disabled = true;
                loginBtn.innerHTML = '<span class="spinner" style="width: 20px; height: 20px; border-width: 2px;"></span> Conectando...';
                
                const result = await auth.signInWithPopup(googleProvider);
                console.log('‚úÖ Login realizado:', result.user.email);
                
                // Verifica se o usu√°rio j√° tem perfil
                await checkUserProfile(result.user);
                
            } catch (error) {
                console.error('‚ùå Erro no login:', error);
                showError('Erro ao fazer login: ' + error.message);
                
                // Reativa o bot√£o
                const loginBtn = document.querySelector('.login-button');
                loginBtn.disabled = false;
                loginBtn.innerHTML = '<span class="login-button-icon">G</span><span>Entrar com Google</span>';
            }
        }

        async function checkUserProfile(user) {
            try {
                console.log('üîç Verificando perfil do usu√°rio...');
                
                const clientDoc = await firestore.collection('clients').doc(user.uid).get();
                
                if (!clientDoc.exists) {
                    console.log('üì≠ Perfil n√£o encontrado, mostrando modal...');
                    // Mostra modal para cria√ß√£o de perfil
                    profileModal.style.display = 'flex';
                    return;
                }
                
                // Carrega dados do perfil existente
                await loadUserProfile(user.uid);
                
            } catch (error) {
                console.error('Erro ao verificar perfil:', error);
            }
        }

        async function createProfile() {
            try {
                const user = auth.currentUser;
                if (!user) return;
                
                console.log('üìù Criando perfil para:', user.uid);
                
                // Cria perfil b√°sico
                const profileData = {
                    fullName: user.displayName || '',
                    email: user.email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    isActive: true,
                    isBanned: false
                };
                
                await firestore.collection('clients').doc(user.uid).set(profileData);
                console.log('‚úÖ Perfil criado com sucesso');
                
                // Fecha modal e carrega dados
                profileModal.style.display = 'none';
                await loadUserProfile(user.uid);
                
            } catch (error) {
                console.error('Erro ao criar perfil:', error);
                showError('Erro ao criar perfil: ' + error.message);
            }
        }

        function skipProfile() {
            profileModal.style.display = 'none';
            loadUserProfile(auth.currentUser.uid);
        }

        // ========== CARREGAMENTO DE DADOS ==========
        async function loadUserProfile(userId) {
            console.log('üîÑ Carregando perfil do usu√°rio:', userId);
            
            // Mostra tela principal
            loginScreen.style.display = 'none';
            mainContainer.style.display = 'block';
            loadingContainer.style.display = 'block';
            errorContainer.style.display = 'none';
            dataContainer.style.display = 'none';
            
            try {
                // Atualiza informa√ß√µes do header
                currentUser = auth.currentUser;
                if (currentUser) {
                    userEmail.textContent = currentUser.email;
                    userName.textContent = currentUser.displayName || currentUser.email;
                    
                    // Avatar com inicial
                    const initials = currentUser.displayName 
                        ? currentUser.displayName.charAt(0).toUpperCase()
                        : currentUser.email.charAt(0).toUpperCase();
                    userAvatar.textContent = initials;
                }
                
                // Verifica se √© admin
                await checkAdminStatus(userId);
                
                // Carrega dados do cliente
                const clientDoc = await firestore.collection('clients').doc(userId).get();
                
                if (!clientDoc.exists) {
                    console.log('‚ùå Perfil n√£o encontrado');
                    showError('Perfil n√£o encontrado. Clique em "Editar Perfil" para criar um.');
                    loadingContainer.style.display = 'none';
                    dataContainer.style.display = 'block';
                    return;
                }
                
                const clientData = clientDoc.data();
                userProfile = clientData;
                
                console.log('‚úÖ Dados do cliente carregados:', clientData);
                
                // Preenche dados pessoais
                document.getElementById('displayUid').textContent = userId;
                document.getElementById('displayFullName').textContent = clientData.fullName || 'N√£o informado';
                document.getElementById('displayCpf').textContent = formatCPF(clientData.cpf) || 'N√£o informado';
                document.getElementById('displayRg').textContent = clientData.rg || 'N√£o informado';
                document.getElementById('displaySocialName').textContent = clientData.socialName || 'N√£o informado';
                document.getElementById('displayBirthDate').textContent = formatDate(clientData.birthDate) || 'N√£o informado';
                document.getElementById('displayGender').textContent = clientData.gender || 'N√£o informado';
                document.getElementById('displayCreatedAt').textContent = formatDate(clientData.createdAt) || 'N√£o informado';
                document.getElementById('displayUpdatedAt').textContent = formatDate(clientData.updatedAt) || 'N√£o informado';
                
                // Endere√ßo
                document.getElementById('displayAddress').textContent = clientData.address || 'N√£o informado';
                document.getElementById('displayZipCode').textContent = clientData.zipCode || 'N√£o informado';
                const cityState = [clientData.city, clientData.state]
                    .filter(Boolean)
                    .join(', ');
                document.getElementById('displayCityState').textContent = cityState || 'N√£o informado';
                document.getElementById('displayCountry').textContent = clientData.country || 'N√£o informado';
                
                // Status da conta
                const statusElement = document.getElementById('displayStatus');
                if (clientData.isBanned) {
                    statusElement.textContent = 'BANIDO';
                    statusElement.className = 'status-badge status-banned';
                } else if (clientData.isActive === false) {
                    statusElement.textContent = 'INATIVO';
                    statusElement.className = 'status-badge status-inactive';
                } else {
                    statusElement.textContent = 'ATIVO';
                    statusElement.className = 'status-badge status-active';
                }
                
                // Tipo de acesso
                const accessElement = document.getElementById('displayAccessType');
                if (isAdmin) {
                    accessElement.textContent = 'Administrador';
                    accessElement.style.color = '#4caf50';
                    accessElement.style.fontWeight = 'bold';
                } else {
                    accessElement.textContent = 'Usu√°rio padr√£o';
                    accessElement.style.color = '#2196f3';
                }
                
                // Carrega telefones
                try {
                    const phonesSnapshot = await firestore.collection('clientPhones')
                        .where('clientId', '==', userId)
                        .get();
                    
                    const phones = phonesSnapshot.docs.map(doc => {
                        const phoneData = doc.data();
                        return formatPhone(phoneData.phoneNumber);
                    }).join(', ');
                    
                    document.getElementById('displayPhone').textContent = phones || 'N√£o informado';
                } catch (phoneError) {
                    console.warn('‚ö†Ô∏è Erro ao carregar telefones:', phoneError);
                    document.getElementById('displayPhone').textContent = 'N√£o informado';
                }
                
                // Carrega emails adicionais
                try {
                    const emailsSnapshot = await firestore.collection('clientEmails')
                        .where('clientId', '==', userId)
                        .get();
                    
                    const emails = emailsSnapshot.docs.map(doc => {
                        const emailData = doc.data();
                        return emailData.emailAddress;
                    }).join(', ');
                    
                    document.getElementById('displayEmail').textContent = emails || currentUser.email;
                } catch (emailError) {
                    console.warn('‚ö†Ô∏è Erro ao carregar emails:', emailError);
                    document.getElementById('displayEmail').textContent = currentUser.email || 'N√£o informado';
                }
                
                // Mostra dados
                loadingContainer.style.display = 'none';
                dataContainer.style.display = 'block';
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar perfil:', error);
                handleError(error);
            }
        }

        async function checkAdminStatus(userId) {
            try {
                console.log('üëë Verificando status de admin...');
                
                const userDoc = await firestore.collection('users').doc(userId).get();
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    isAdmin = userData.isAdmin === true || 
                              userData.isAdminUID === true || 
                              userId === "sZxfMuOBPbXdR8nttVPXIN8QOOl1";
                    
                    console.log('‚úÖ √â admin?', isAdmin);
                    
                    if (isAdmin) {
                        adminBadge.style.display = 'block';
                    }
                } else {
                    console.log('üìù Usu√°rio n√£o encontrado na cole√ß√£o users');
                    isAdmin = false;
                }
                
            } catch (error) {
                console.warn('‚ö†Ô∏è Erro ao verificar admin:', error);
                isAdmin = false;
            }
        }

        // ========== MANIPULA√á√ÉO DE ERROS ==========
        function handleError(error) {
            loadingContainer.style.display = 'none';
            
            let errorMsg = '';
            
            switch (error.code) {
                case 'permission-denied':
                    errorMsg = `
                        <strong>üîí Permiss√£o Negada</strong><br>
                        <p>Voc√™ n√£o tem permiss√£o para acessar estas informa√ß√µes.</p>
                        <p><em>${error.message || 'Verifique se voc√™ tem acesso a este perfil.'}</em></p>
                        <br>
                        <p><strong>Poss√≠veis causas:</strong></p>
                        <ul>
                            <li>‚ùå Seu usu√°rio est√° banido</li>
                            <li>üë§ Voc√™ n√£o √© o propriet√°rio deste perfil</li>
                            <li>üëë Voc√™ n√£o √© um administrador</li>
                        </ul>
                    `;
                    break;
                    
                case 'not-found':
                    errorMsg = `
                        <strong>üîç Perfil N√£o Encontrado</strong><br>
                        <p>N√£o existe um perfil para o seu usu√°rio.</p>
                        <p>Clique em "Editar Perfil" para criar um novo perfil.</p>
                    `;
                    break;
                    
                default:
                    errorMsg = `
                        <strong>‚ö†Ô∏è Erro Inesperado</strong><br>
                        <p><em>${error.message || 'Erro ao conectar com o servidor'}</em></p>
                        <p><strong>Detalhes:</strong> ${error.code || 'N/A'}</p>
                    `;
            }
            
            errorMessage.innerHTML = errorMsg;
            errorContainer.style.display = 'block';
        }

        function showError(message) {
            errorMessage.innerHTML = `<p>${message}</p>`;
            errorContainer.style.display = 'block';
        }

        // ========== FUN√á√ïES DE INTERA√á√ÉO ==========
        function editProfile() {
            const userId = currentUser ? currentUser.uid : getUrlParam('uid');
            if (userId) {
                window.location.href = `editar_cliente/?uid=${userId}`;
            }
        }

        async function logout() {
            try {
                await auth.signOut();
                console.log('‚úÖ Logout realizado');
                
                // Volta para tela de login
                loginScreen.style.display = 'flex';
                mainContainer.style.display = 'none';
                
            } catch (error) {
                console.error('Erro no logout:', error);
                showError('Erro ao fazer logout: ' + error.message);
            }
        }

        function debugFirebase() {
            console.clear();
            console.log('üîç === DEBUG FIREBASE ===');
            console.log('üìä Configura√ß√£o:', firebaseConfig);
            console.log('üë§ Usu√°rio atual:', auth.currentUser);
            console.log('üëë √â admin?', isAdmin);
            console.log('üìÅ Perfil carregado:', userProfile);
            
            // Testa permiss√µes
            testPermissions();
        }

        async function testPermissions() {
            console.log('\nüîí Testando permiss√µes...');
            
            const userId = auth.currentUser?.uid;
            if (!userId) {
                console.log('‚ùå Nenhum usu√°rio logado');
                return;
            }
            
            try {
                // Testa acesso √† cole√ß√£o clients
                const test = await firestore.collection('clients').doc(userId).get();
                console.log('‚úÖ Acesso √† cole√ß√£o "clients":', test.exists ? 'OK' : 'N√£o encontrado');
                
                // Testa acesso √† cole√ß√£o clientPhones
                const phonesTest = await firestore.collection('clientPhones')
                    .where('clientId', '==', userId)
                    .limit(1)
                    .get();
                console.log('‚úÖ Acesso √† cole√ß√£o "clientPhones":', phonesTest.empty ? 'Vazia' : 'OK');
                
                // Testa acesso √† cole√ß√£o clientEmails
                const emailsTest = await firestore.collection('clientEmails')
                    .where('clientId', '==', userId)
                    .limit(1)
                    .get();
                console.log('‚úÖ Acesso √† cole√ß√£o "clientEmails":', emailsTest.empty ? 'Vazia' : 'OK');
                
            } catch (error) {
                console.error('‚ùå Erro ao testar permiss√µes:', error.code, error.message);
            }
        }

        // ========== INICIALIZA√á√ÉO ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Sistema de Informa√ß√µes do Cliente inicializado');
            
            // Monitora estado de autentica√ß√£o
            auth.onAuthStateChanged(async (user) => {
                console.log('üîê Estado de autentica√ß√£o:', user ? 'Logado' : 'Deslogado');
                
                if (user) {
                    console.log('üë§ Usu√°rio:', user.email);
                    await loadUserProfile(user.uid);
                } else {
                    // Mostra tela de login
                    loginScreen.style.display = 'flex';
                    mainContainer.style.display = 'none';
                }
            });
        });

        // ========== FUN√á√ïES GLOBAIS ==========
        window.debugFirebase = debugFirebase;
        window.loginWithGoogle = loginWithGoogle;
        window.logout = logout;
        window.editProfile = editProfile;
        window.createProfile = createProfile;
        window.skipProfile = skipProfile;
        
        // Atalho F12 para debug
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12') {
                e.preventDefault();
                debugFirebase();
            }
        });
    </script>
</body>
</html>
