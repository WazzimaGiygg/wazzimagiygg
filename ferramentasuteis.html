<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - WZZM</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7f6;
        }
        
        /* Estilos do formulário de login */
        .login-container {
            display: none; /* Inicia oculto e só é mostrado se não houver usuário logado */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #e9ecef;
        }
        .login-form {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 350px;
        }
        .login-form h2 {
            text-align: center;
            color: #333;
            margin-bottom: 25px;
        }
        .login-form label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: bold;
        }
        .login-form input {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .login-form button {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        .login-form button:hover {
            background-color: #0056b3;
        }
        .login-message {
            margin-top: 15px;
            text-align: center;
            color: #dc3545;
        }

        /* Estilos do cabeçalho de usuário logado */
        .header-logged-in {
            display: none; /* Inicia oculto e só é mostrado se o usuário estiver logado */
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background-color: #343a40;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .header-logged-in h1 {
            margin: 0;
            font-size: 24px;
        }
        .header-logged-in button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .header-logged-in button:hover {
            background-color: #c82333;
        }

        /* Estilos da janela dividida */
        .container-split {
            display: none; /* Inicia oculto e só é mostrado se o usuário estiver logado */
            flex-direction: row;
            height: calc(100vh - 70px); /* Ajuste para o header */
        }
        .lista-recente {
            width: 30%;
            background-color: #ffffff;
            border-right: 1px solid #ddd;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }
        .lista-recente h2 {
            text-align: center;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .artigo-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .artigo-item:hover, .artigo-item.ativo {
            background-color: #e9ecef;
        }
        .artigo-item h3 {
            margin: 0 0 5px 0;
            color: #007bff;
        }
        .artigo-item p {
            font-size: 12px;
            color: #888;
            margin: 0;
        }
        .detalhes-artigo {
            width: 70%;
            padding: 40px;
            overflow-y: auto;
        }
        .detalhes-artigo h1 {
            color: #333;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }
        .detalhes-artigo .descricao-container {
            margin-top: 20px;
            line-height: 1.6;
        }
        .detalhes-artigo .fontes-container {
            margin-top: 25px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        .detalhes-artigo .fontes-container p {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
        }
        .detalhes-artigo .fontes-container ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .detalhes-artigo .fontes-container li {
            margin-bottom: 5px;
        }
        .detalhes-artigo .fontes-container a {
            color: #28a745;
            text-decoration: none;
        }
        .detalhes-artigo .fontes-container a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

<div class="login-container" id="login-section">
    <div class="login-form">
        <h2>Entrar</h2>
        <form id="login-form-element">
            <label for="email">E-mail</label>
            <input type="email" id="email" required>
            <label for="password">Senha</label>
            <input type="password" id="password" required>
            <button type="submit">Entrar</button>
            <p class="login-message" id="login-message"></p>
        </form>
    </div>
</div>

<div id="logged-in-container">
    <div class="header-logged-in" id="header-logged-in">
        <h1>Artigos Corrigidos e Aprimorados do Usuário "O Repositor" (Orepositor) na Wikipédia</h1>
        <button id="logout-button">Sair</button>
    </div>
    <div class="container-split" id="content-split">
        <div class="lista-recente">
            <h2>Artigos Recentes</h2>
            <div id="artigos-list">
                <p style="text-align: center; color: #666;">Carregando...</p>
            </div>
        </div>
        <div class="detalhes-artigo" id="detalhes-artigo">
            <p style="text-align: center; color: #888;">Selecione um artigo na lista para ver os detalhes.</p>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

<script>
// --- Configuração do Firebase ---
const firebaseConfig = {
    apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0", 
    authDomain: "wzzm-ce3fc.firebaseapp.com",
    projectId: "wzzm-ce3fc",
    storageBucket: "wzzm-ce3fc.appspot.com",
    messagingSenderId: "249427877153",
    appId: "1:249427877153:web:0e4297294794a5aadeb260",
    measurementId: "G-PLKNZNFCQ8"
};

// Inicialize o Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// Elementos da interface
const loginSection = document.getElementById('login-section');
const loggedInHeader = document.getElementById('header-logged-in');
const contentSplit = document.getElementById('content-split');
const loginFormElement = document.getElementById('login-form-element');
const loginMessage = document.getElementById('login-message');
const logoutButton = document.getElementById('logout-button');
const artigosList = document.getElementById('artigos-list');
const detalhesArtigo = document.getElementById('detalhes-artigo');
let artigoSelecionado = null;

// --- Lógica de Autenticação ---

// Listener para o estado de autenticação
auth.onAuthStateChanged(user => {
    if (user) {
        // Usuário logado: mostra o painel e esconde o login
        console.log("Usuário logado:", user.email);
        loginSection.style.display = 'none';
        loggedInHeader.style.display = 'flex';
        contentSplit.style.display = 'flex';
        buscarArtigosRecentes();
    } else {
        // Usuário não logado: mostra o formulário de login e esconde o painel
        console.log("Nenhum usuário logado.");
        loginSection.style.display = 'flex';
        loggedInHeader.style.display = 'none';
        contentSplit.style.display = 'none';
        
        artigosList.innerHTML = '<p style="text-align: center; color: #666;">Carregando...</p>';
        detalhesArtigo.innerHTML = '<p style="text-align: center; color: #888;">Selecione um artigo na lista para ver os detalhes.</p>';
    }
});

// Evento de envio do formulário de login
loginFormElement.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = loginFormElement.email.value;
    const password = loginFormElement.password.value;
    
    try {
        await auth.signInWithEmailAndPassword(email, password);
        loginMessage.textContent = ''; // Limpa a mensagem de erro
    } catch (error) {
        loginMessage.textContent = 'Erro no login: ' + error.message;
        console.error("Erro no login:", error);
    }
});

// Evento do botão de logout
logoutButton.addEventListener('click', () => {
    auth.signOut();
});

// --- Lógica de busca e exibição dos artigos ---
async function buscarArtigosRecentes() {
    try {
        const querySnapshot = await db.collection('materias')
                                      .orderBy('createdAt', 'desc')
                                      .limit(10)
                                      .get();
        
        artigosList.innerHTML = '';
        
        if (querySnapshot.empty) {
            artigosList.innerHTML = '<p style="text-align: center; color: #666;">Nenhum artigo encontrado.</p>';
            return;
        }
        
        querySnapshot.forEach(doc => {
            const materia = doc.data();
            const artigoItem = document.createElement('div');
            artigoItem.className = 'artigo-item';
            artigoItem.setAttribute('data-id', doc.id);
            
            artigoItem.innerHTML = `
                <h3>${materia.titulo}</h3>
                <p>ID: ${doc.id}</p>
            `;
            
            artigoItem.addEventListener('click', () => {
                carregarDetalhesArtigo(doc.id, materia);
                
                if (artigoSelecionado) {
                    artigoSelecionado.classList.remove('ativo');
                }
                artigoItem.classList.add('ativo');
                artigoSelecionado = artigoItem;
            });
            
            artigosList.appendChild(artigoItem);
        });
        
    } catch (error) {
        console.error("Erro ao buscar artigos recentes: ", error);
        artigosList.innerHTML = '<p style="text-align: center; color: #e74c3c;">Erro: ' + error.message + '</p>';
    }
}

function carregarDetalhesArtigo(id, materia) {
    let fontesHtml = '';
    if (materia.fontes && materia.fontes.length > 0) {
        const fontesLista = materia.fontes.map(fonte => {
            const isUrl = fonte.startsWith('http://') || fonte.startsWith('https://');
            if (isUrl) {
                return `<li><a href="${fonte}" target="_blank">${fonte}</a></li>`;
            } else {
                return `<li>${fonte}</li>`;
            }
        }).join('');
        
        fontesHtml = `
            <div class="fontes-container">
                <p>Fontes:</p>
                <ul>${fontesLista}</ul>
            </div>
        `;
    }

    detalhesArtigo.innerHTML = `
        <h1>${materia.titulo}</h1>
        <p style="font-style: italic; color: #555;">ID do Documento: ${id}</p>
        <div class="descricao-container">${materia.descricao}</div>
        ${fontesHtml}
    `;
}

</script>

</body>
</html>
