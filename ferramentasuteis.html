<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artigos Recentes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7f6;
        }
        .container-split {
            display: flex;
            height: 100vh;
        }
        .lista-recente {
            width: 30%;
            background-color: #ffffff;
            border-right: 1px solid #ddd;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }
        .lista-recente h2 {
            text-align: center;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .artigo-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .artigo-item:hover, .artigo-item.ativo {
            background-color: #e9ecef;
        }
        .artigo-item h3 {
            margin: 0 0 5px 0;
            color: #007bff;
        }
        .artigo-item p {
            font-size: 12px;
            color: #888;
            margin: 0;
        }
        .detalhes-artigo {
            width: 70%;
            padding: 40px;
            overflow-y: auto;
        }
        .detalhes-artigo h1 {
            color: #333;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }
        .detalhes-artigo .descricao-container {
            margin-top: 20px;
            line-height: 1.6;
        }
        .detalhes-artigo .fontes-container {
            margin-top: 25px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        .detalhes-artigo .fontes-container p {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
        }
        .detalhes-artigo .fontes-container ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .detalhes-artigo .fontes-container li {
            margin-bottom: 5px;
        }
        .detalhes-artigo .fontes-container a {
            color: #28a745;
            text-decoration: none;
        }
        .detalhes-artigo .fontes-container a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

<div class="container-split">
    <div class="lista-recente">
        <h2>Artigos Recentes</h2>
        <div id="artigos-list">
            <p style="text-align: center; color: #666;">Carregando...</p>
        </div>
    </div>
    
    <div class="detalhes-artigo" id="detalhes-artigo">
        <p style="text-align: center; color: #888;">Selecione um artigo na lista para ver os detalhes.</p>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script>
// --- Configuração do Firebase ---
const firebaseConfig = {
    apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0", 
    authDomain: "wzzm-ce3fc.firebaseapp.com",
    projectId: "wzzm-ce3fc",
    storageBucket: "wzzm-ce3fc.appspot.com",
    messagingSenderId: "249427877153",
    appId: "1:249427877153:web:0e4297294794a5aadeb260",
    measurementId: "G-PLKNZNFCQ8"
};

// Inicialize o Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Elementos da interface
const artigosList = document.getElementById('artigos-list');
const detalhesArtigo = document.getElementById('detalhes-artigo');
let artigoSelecionado = null;

// Função para buscar os 10 artigos mais recentes
async function buscarArtigosRecentes() {
    try {
        const querySnapshot = await db.collection('materias')
                                      .orderBy('createdAt', 'desc')
                                      .limit(10) // Pega os 10 mais recentes
                                      .get();
        
        artigosList.innerHTML = ''; // Limpa o carregando...
        
        if (querySnapshot.empty) {
            artigosList.innerHTML = '<p style="text-align: center; color: #666;">Nenhum artigo encontrado.</p>';
            return;
        }
        
        // Renderiza a lista de artigos recentes
        querySnapshot.forEach(doc => {
            const materia = doc.data();
            const artigoItem = document.createElement('div');
            artigoItem.className = 'artigo-item';
            artigoItem.setAttribute('data-id', doc.id); // Adiciona o ID do documento como um atributo
            
            artigoItem.innerHTML = `
                <h3>${materia.titulo}</h3>
                <p>ID: ${doc.id}</p>
            `;
            
            artigoItem.addEventListener('click', () => {
                carregarDetalhesArtigo(doc.id, materia);
                
                // Remove a classe 'ativo' de todos os itens e adiciona ao item clicado
                if (artigoSelecionado) {
                    artigoSelecionado.classList.remove('ativo');
                }
                artigoItem.classList.add('ativo');
                artigoSelecionado = artigoItem;
            });
            
            artigosList.appendChild(artigoItem);
        });
        
    } catch (error) {
        console.error("Erro ao buscar artigos recentes: ", error);
        artigosList.innerHTML = '<p style="text-align: center; color: #e74c3c;">Erro ao carregar a lista.</p>';
    }
}

// Função para carregar e exibir os detalhes de um artigo
function carregarDetalhesArtigo(id, materia) {
    let fontesHtml = '';
    if (materia.fontes && materia.fontes.length > 0) {
        const fontesLista = materia.fontes.map(fonte => {
            const isUrl = fonte.startsWith('http://') || fonte.startsWith('https://');
            if (isUrl) {
                return `<li><a href="${fonte}" target="_blank">${fonte}</a></li>`;
            } else {
                return `<li>${fonte}</li>`;
            }
        }).join('');
        
        fontesHtml = `
            <div class="fontes-container">
                <p>Fontes:</p>
                <ul>${fontesLista}</ul>
            </div>
        `;
    }

    detalhesArtigo.innerHTML = `
        <h1>${materia.titulo}</h1>
        <p style="font-style: italic; color: #555;">ID do Documento: ${id}</p>
        <div class="descricao-container">${materia.descricao}</div>
        ${fontesHtml}
    `;
}

// Inicia o carregamento da lista de artigos recentes
document.addEventListener('DOMContentLoaded', buscarArtigosRecentes);
</script>

</body>
</html>
