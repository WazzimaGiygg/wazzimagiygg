<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carregando...</title>
<link rel="icon" href="favicom.png" type="image/x-icon">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.min.css">
<style id="custom-app-css">
/* Este será o local onde o CSS dos aplicativos do usuário será injetado */
</style>
<style id="custom-theme-color">
/* A cor do tema será injetada aqui pelo JavaScript */
</style>
<style>
/* Seus estilos CSS existentes aqui */
body {
display: flex;
flex-direction: column;
min-height: 100vh;
margin: 0;
font-family: 'Roboto', sans-serif;
background-color: #f5f5f5;
}
.mdl-layout__content {
flex-grow: 1;
display: flex;
position: relative; /* Adicionado para posicionamento absoluto */
padding: 0;
}
.page-content {
flex-grow: 1;
display: flex;
flex-direction: column;
}
.mdl-layout__drawer .mdl-navigation .mdl-navigation__link {
color: #424242;
}
.mdl-layout__drawer .mdl-navigation .mdl-navigation__link[data-requires-auth="true"] {
color: #9e9e9e;
pointer-events: none;
}
/* Estilo para o novo iframe de conteúdo em tela cheia */
#main-content-frame {
flex-grow: 1;
border: none;
width: 100%;
height: 100%;
position: absolute;
top: 0;
left: 0;
z-index: 0; /* z-index para ficar no fundo */
}
/* Estilo para o contêiner das janelas flutuantes */
#window-container {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: 1000; /* Garante que as janelas fiquem por cima */
pointer-events: none; /* Permite cliques passarem para o iframe de fundo */
}
#window-container > .floating-window {
pointer-events: auto; /* Reativa os cliques para as janelas */
}
/* Estilo para as janelas flutuantes */
.floating-window {
display: flex;
flex-direction: column;
position: absolute;
min-width: 300px;
min-height: 200px;
background-color: white;
box-shadow: 0 4px 8px rgba(0,0,0,0.2);
border-radius: 8px;
overflow: hidden;
resize: both;
transition: transform 0.2s ease-out;
border: 1px solid #ccc;
top: 50px;
left: 50px;
z-index: 1000;
}
.window-header {
cursor: grab;
padding: 8px 12px;
background-color: #f5f5f5;
border-bottom: 1px solid #ddd;
display: flex;
align-items: center;
justify-content: space-between;
}
.window-header:active {
cursor: grabbing;
}
.window-header span {
font-weight: bold;
}
.window-controls button {
border: none;
background: none;
font-size: 24px;
cursor: pointer;
color: #666;
line-height: 1;
padding: 0 8px;
}
.window-controls button:hover {
color: #333;
}
.window-body {
flex-grow: 1;
overflow: hidden;
}
.window-body iframe {
width: 100%;
height: 100%;
border: none;
}
.mdl-layout__header-row {
padding: 0 16px;
}
.mdl-layout__header-row .mdl-navigation {
display: flex;
align-items: center;
}
.mdl-layout__header-row .mdl-navigation .mdl-navigation__link {
padding: 0 12px;
}
/* Estilo para a imagem de perfil */
#user-profile-pic {
width: 32px;
height: 32px;
border-radius: 50%;
margin-left: 8px;
vertical-align: middle;
display: none;
}
/* Estilos para o popup de apps */
#google-apps-button {
display: none;
}
#google-apps-popup {
display: none;
position: absolute;
top: 48px; /* Altura do header */
right: 0;
width: 300px;
background-color: white;
border-radius: 8px;
box-shadow: 0 5px 15px rgba(0,0,0,0.3);
z-index: 1000;
padding: 10px;
box-sizing: border-box;
}
#google-apps-popup h4 {
margin-top: 0;
margin-bottom: 10px;
color: #3f51b5;
text-align: center;
}
#app-grid {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 10px;
padding: 10px;
}
.app-item {
display: flex;
flex-direction: column;
align-items: center;
text-align: center;
cursor: pointer;
padding: 8px;
border-radius: 4px;
transition: background-color 0.3s;
}
.app-item:hover {
background-color: #f0f0f0;
}
.app-item img {
width: 48px;
height: 48px;
margin-bottom: 5px;
}
.app-item span {
font-size: 0.8em;
color: #555;
}
/* Mensagens de acesso */
#access-denied-message, #banned-message {
display: none;
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background-color: #ffe0b2;
border: 1px solid #ffb74d;
padding: 20px;
border-radius: 8px;
box-shadow: 0 4px 8px rgba(0,0,0,0.2);
text-align: center;
color: #e65100;
font-weight: bold;
z-index: 1001;
}
/* --- ESTILOS PARA NOTÍCIAS (Botão e Popup) --- */
#news-button {
margin-right: 8px;
display: none;
}
#news-center-popup {
display: none;
position: absolute;
top: 48px;
right: 0;
width: 400px;
max-height: 80vh;
background-color: white;
border-radius: 8px;
box-shadow: 0 5px 15px rgba(0,0,0,0.3);
z-index: 998;
flex-direction: column;
overflow: hidden;
}
#news-popup-header {
background-color: #3f51b5;
color: white;
padding: 10px 15px;
border-top-left-radius: 8px;
border-top-right-radius: 8px;
display: flex;
align-items: center;
justify-content: space-between;
font-weight: bold;
font-size: 16px;
}
#news-popup-header .close-button {
background: none;
border: none;
color: white;
font-size: 24px;
cursor: pointer;
padding: 0;
}
#news-popup-content {
flex-grow: 1;
overflow-y: auto;
padding: 15px;
}
#news-popup-footer {
padding: 10px 15px;
border-top: 1px solid #eee;
text-align: center;
}
#news-popup-footer button {
width: 100%;
}
/* Estilos para os itens de notícia dentro do popup (adaptados do seu código original) */
.news-popup-item {
background-color: #f9f9f9;
border: 1px solid #e0e0e0;
border-radius: 4px;
padding: 15px;
margin-bottom: 15px;
box-shadow: 0 1px 1px 0 rgba(0,0,0,.08);
}
.news-popup-item h3 {
margin-top: 0;
color: #5c6bc0;
}
.news-popup-item p {
color: #555;
line-height: 1.5;
}
.news-popup-item small {
font-size: 0.8em;
color: #888;
display: block;
margin-top: 10px;
}
.news-popup-item img {
max-width: 100%;
height: auto;
margin-top: 10px;
border-radius: 4px;
}
</style>
<script>
    // Script de redirecionamento para navegadores não-Chromium
    (function() {
        const userAgent = navigator.userAgent;
        const isChromium = !!window.chrome && userAgent.indexOf('Chrome') > -1 && userAgent.indexOf('Edg') === -1 && userAgent.indexOf('OPR') === -1;

        if (!isChromium) {
            window.location.href = './notchromium';
        }
    })();

    // Script de redirecionamento para mobile
    (function() {
        const isMobile = /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || (window.innerWidth <= 768);
        if (isMobile) {
            window.location.href = './mobile/index.html';
        }
    })();
</script>
</head>
<body>

<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
<header class="mdl-layout__header">
<div class="mdl-layout__header-row">
<span class="mdl-layout-title" id="wiki-page-name">Carregando...</span>
<a href="https://wikizero.wzzm.org/" id="./wikinotpedia/">
<img src="https://wzzm.org/wnp.png" alt="Logo Wiki Zone Zero Mod" style="height: 32px; vertical-align: middle; margin-right: 8px;"></a> <div class="mdl-layout-spacer"></div>
<nav class="mdl-navigation">
<button class="mdl-button mdl-js-button mdl-button--icon" id="error-log-button" title="Ver Erros">
<i class="material-icons">bug_report</i>
</button>
<a class="mdl-navigation__link" href="#" id="search-articles-link" onclick="loadInMainFrame('ferramentasuteis.html', null, false)">Procurar Artigos</a>
<div style="position: relative; display: flex; align-items: center;">
<button class="mdl-button mdl-js-button mdl-button--icon" id="news-button" style="display: none;">
<i class="material-icons">article</i>
</button>
<div id="news-center-popup">
<div id="news-popup-header">
<span>Últimas Notícias</span>
<button class="close-button" id="close-news-popup-button">×</button>
</div>
<div id="news-popup-content">
<p>Carregando últimas notícias...</p>
</div>
<div id="news-popup-footer">
<button id="view-all-news-button" class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent">
Ver todas as Notícias
</button>
</div>
</div>
<button class="mdl-button mdl-js-button mdl-button--icon" id="google-apps-button" style="display: none;">
<i class="material-icons">widgets</i>
</button>
<div id="google-apps-popup">
<h4>Serviços WZZM</h4>
<div id="app-grid">
</div>
</div>
<div id="user-info-container" style="display: none; align-items: center;">
<span id="user-info" style="margin-left: 8px; color: white;"></span>
<img id="user-profile-pic" src="" alt="Profile Pic">
<button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="logout-button" style="margin-left: 10px; display: none;">Sair</button>
</div>
<button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="login-google">Login Google</button>
<button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="login-github" style="margin-left: 10px;">Login GitHub</button>
</div>
</nav>
</div>
</header>
<div class="mdl-layout__drawer">
<span class="mdl-layout-title" id="drawer-title">Navegação</span>
<nav class="mdl-navigation" id="drawer-menu">
</nav>
</div>
<main class="mdl-layout__content">
<iframe id="main-content-frame" src="wnpx.html" frameborder="0"></iframe>
<div id="window-container"></div>
</main>
<div id="access-denied-message" style="display:none;">
<p>Acesso negado. Por favor, faça login para ver este conteúdo.</p>
</div>
<div id="banned-message" style="display:none;">
<p>Sua conta foi banida. Você não pode acessar o conteúdo.</p>
<p>Para mais informações, contate o suporte.</p>
</div>
<div id="error-log-popup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; max-width: 600px; height: 80%; max-height: 400px; background: white; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); z-index: 1002; flex-direction: column;">
<div style="padding: 16px; background-color: #f5f5f5; border-bottom: 1px solid #ccc; display: flex; justify-content: space-between; align-items: center;">
<h4 style="margin: 0;">Log de Erros do Console</h4>
<button onclick="document.getElementById('error-log-popup').style.display='none';" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
</div>
<ul id="error-log-list" style="list-style-type: none; margin: 0; padding: 16px; flex-grow: 1; overflow-y: auto;">
</ul>
</div>
</div>

<script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-analytics-compat.js"></script>
<script>
    // --- Configuração do Firebase ---
    const firebaseConfig = {
        apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0",
        authDomain: "wzzm-ce3fc.firebaseapp.com",
        projectId: "wzzm-ce3fc",
        storageBucket: "wzzm-ce3fc.appspot.com",
        messagingSenderId: "249427877153",
        appId: "1:249427877153:web:0e4297294794a5aadeb260",
        measurementId: "G-PLKNZNFCQ8"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const firestore = firebase.firestore();
    firebase.analytics();

    let currentUser = null;
    let isCurrentUserBanned = false;

    // --- Funções principais ---
    function loadInMainFrame(src) {
        const contentFrame = document.getElementById('main-content-frame');
        if (contentFrame) {
            contentFrame.src = src;
        }
    }

    function setNavLinksEnabled(enabled) {
        const navLinks = document.querySelectorAll('.mdl-navigation__link[data-requires-auth="true"]');
        navLinks.forEach(link => {
            if (enabled) {
                link.style.pointerEvents = 'auto';
                link.style.color = '#424242';
            } else {
                link.style.pointerEvents = 'none';
                link.style.color = '#9e9e9e';
            }
        });
    }

    function loadPage(src, requiresAuth = false) {
        const contentFrame = document.getElementById('main-content-frame');
        const accessDeniedMessage = document.getElementById('access-denied-message');
        const bannedMessage = document.getElementById('banned-message');
        if (contentFrame) {
            if (accessDeniedMessage) accessDeniedMessage.style.display = 'none';
            if (bannedMessage) bannedMessage.style.display = 'none';
            if (requiresAuth && !currentUser) {
                if (accessDeniedMessage) accessDeniedMessage.style.display = 'block';
                return;
            }
            if (isCurrentUserBanned) {
                if (bannedMessage) bannedMessage.style.display = 'block';
                return;
            }
            contentFrame.src = src;
            contentFrame.style.display = 'block';
        }
    }

    function applyConfigData(data) {
        document.title = data.nomeCompletoWiki || 'Wiki';
        const wikiPageName = document.getElementById('wiki-page-name');
        if (wikiPageName) {
            wikiPageName.textContent = data.nomeCompletoWiki || 'Wiki';
        }
        const drawerTitle = document.getElementById('drawer-title');
        if (drawerTitle) {
            drawerTitle.textContent = data.nomePaginaDrawer || 'Navegação';
        }
        const searchArticlesLink = document.getElementById('search-articles-link');
        if (searchArticlesLink) {
            searchArticlesLink.textContent = data.linkProcurarArtigos || 'Procurar Artigos';
        }
    }

    function showNewsPopup() {
        const newsCenterPopup = document.getElementById('news-center-popup');
        if (newsCenterPopup) {
            newsCenterPopup.style.display = 'flex';
            fetchLatestNews();
        }
    }

    function hideNewsPopup() {
        const newsCenterPopup = document.getElementById('news-center-popup');
        if (newsCenterPopup) {
            newsCenterPopup.style.display = 'none';
        }
    }
    
    async function fetchLatestNews() {
        const newsPopupContent = document.getElementById('news-popup-content');
        newsPopupContent.innerHTML = '<p>Carregando últimas notícias...</p>';
        try {
            const newsSnapshot = await firestore.collection('news')
                .orderBy('createdAt', 'desc')
                .limit(5)
                .get();
            if (newsSnapshot.empty) {
                newsPopupContent.innerHTML = '<p>Nenhuma notícia encontrada.</p>';
                return;
            }
            newsPopupContent.innerHTML = '';
            newsSnapshot.forEach(doc => {
                const news = doc.data();
                const newsItem = document.createElement('div');
                newsItem.classList.add('news-popup-item');
                const timestampDate = news.createdAt ? news.createdAt.toDate() : new Date();
                const timeString = timestampDate.toLocaleString([], {
                    year: 'numeric', month: 'numeric', day: 'numeric',
                    hour: '2-digit', minute: '2-digit'
                });
                newsItem.innerHTML = `
<h3>${news.title}</h3>
<p>${news.description}</p>
<small>Categoria: ${news.category}</small><br> ${news.tags && news.tags.length > 0 ? `<small>Tags: ${news.tags.join(', ')}</small><br>` : ''}
<small>Publicado em: ${timeString}</small>
${news.imageUrl ? `<img src="${news.imageUrl}" alt="Imagem da Notícia">` : ''}
`;
                newsPopupContent.appendChild(newsItem);
            });
        } catch (error) {
            console.error("Erro ao buscar últimas notícias para o popup:", error);
            newsPopupContent.innerHTML = `<p style="color: red;">Erro ao carregar notícias: ${error.message}</p>`;
        }
    }

    async function createUserProfileDocument(user) {
        if (!user) return;
        const userRef = firestore.doc(`users/${user.uid}`);
        const snapshot = await userRef.get();
        if (!snapshot.exists) {
            const { displayName, email, photoURL } = user;
            const createdAt = new Date();
            try {
                await userRef.set({
                    displayName,
                    email,
                    photoURL,
                    createdAt,
                    isAdmin: false,
                    isBan: false
                });
                console.log("Perfil do usuário criado no Firestore.");
            } catch (error) {
                console.error("Erro ao criar perfil do usuário:", error);
            }
        }
    }

    async function loadAndApplyUserAppsCSS(userId) {
        const customAppCssStyleTag = document.getElementById('custom-app-css');
        if (!customAppCssStyleTag) return;
        try {
            const userAppsSnapshot = await firestore.collection('userApps').doc(userId).get();
            if (userAppsSnapshot.exists) {
                const appData = userAppsSnapshot.data();
                let cssContent = '';
                if (appData && appData.apps) {
                    appData.apps.forEach(app => {
                        if (app.css) {
                            cssContent += app.css + '\n';
                        }
                    });
                }
                customAppCssStyleTag.innerHTML = cssContent;
            } else {
                customAppCssStyleTag.innerHTML = '';
            }
        } catch (error) {
            console.error("Erro ao carregar CSS de aplicativos do usuário:", error);
            customAppCssStyleTag.innerHTML = '';
        }
    }

    const providerGoogle = new firebase.auth.GoogleAuthProvider();
    const providerGitHub = new firebase.auth.GithubAuthProvider();

    document.getElementById('login-google').addEventListener('click', () => {
        auth.signInWithPopup(providerGoogle).catch(error => { console.error("Erro no login com Google:", error); });
    });
    document.getElementById('login-github').addEventListener('click', () => {
        auth.signInWithPopup(providerGitHub).catch(error => { console.error("Erro no login com GitHub:", error); });
    });
    function handleLogout() {
        auth.signOut().then(() => { console.log("Usuário deslogado."); }).catch((error) => { console.error("Erro ao deslogar:", error); });
    }
    const logoutButton = document.getElementById('logout-button');
    if (logoutButton) {
        logoutButton.addEventListener('click', handleLogout);
    }

    // --- Gerenciamento de Estado de Autenticação ---
    auth.onAuthStateChanged(async (user) => {
        currentUser = user;
        const userInfo = document.getElementById('user-info');
        const loginGoogleButton = document.getElementById('login-google');
        const loginGitHubButton = document.getElementById('login-github');
        const logoutButton = document.getElementById('logout-button');
        const userProfilePic = document.getElementById('user-profile-pic');
        const googleAppsButton = document.getElementById('google-apps-button');
        const userInfoContainer = document.getElementById('user-info-container');
        const googleAppsPopup = document.getElementById('google-apps-popup');
        const customAppCssStyleTag = document.getElementById('custom-app-css');
        const contentFrame = document.getElementById('main-content-frame');
        const accessDeniedMessage = document.getElementById('access-denied-message');
        const bannedMessage = document.getElementById('banned-message');
        const newsButton = document.getElementById('news-button');
        const newsCenterPopup = document.getElementById('news-center-popup');
        if (user) {
            if (userInfo) userInfo.textContent = `Olá, ${user.displayName || user.email}!`;
            if (loginGoogleButton) loginGoogleButton.style.display = 'none';
            if (loginGitHubButton) loginGitHubButton.style.display = 'none';
            if (user.photoURL) {
                if (userProfilePic) {
                    userProfilePic.src = user.photoURL;
                    userProfilePic.style.display = 'inline-block';
                }
            } else {
                if (userProfilePic) userProfilePic.style.display = 'none';
            }
            if (googleAppsButton) googleAppsButton.style.display = 'inline-block';
            if (userInfoContainer) userInfoContainer.style.display = 'flex';
            await createUserProfileDocument(user);
            let isUserBanned = false;
            try {
                const userProfileRef = firestore.collection('users').doc(user.uid);
                const doc = await userProfileRef.get();
                if (doc.exists && doc.data()) {
                    isUserBanned = doc.data().isBan || false;
                }
            } catch (error) {
                console.error("Erro ao verificar perfil de usuário ou status de banimento:", error);
                isUserBanned = false;
            }
            isCurrentUserBanned = isUserBanned;
            if (isUserBanned) {
                console.warn(`Usuário ${user.uid} está banido.`);
                setNavLinksEnabled(false);
                if (logoutButton) {
                    logoutButton.style.display = 'none';
                    logoutButton.removeEventListener('click', handleLogout);
                }
                if (contentFrame) {
                    contentFrame.style.display = 'none';
                }
                if (bannedMessage) bannedMessage.style.display = 'block';
                if (accessDeniedMessage) accessDeniedMessage.style.display = 'none';
                if (googleAppsButton) {
                    googleAppsButton.style.pointerEvents = 'none';
                    googleAppsButton.style.opacity = '0.6';
                }
                if (googleAppsPopup) googleAppsPopup.style.display = 'none';
                if (newsButton) newsButton.style.display = 'none';
                if (newsCenterPopup) newsCenterPopup.style.display = 'none';
            } else {
                if (logoutButton) logoutButton.style.display = 'inline-block';
                setNavLinksEnabled(true);
                if (bannedMessage) bannedMessage.style.display = 'none';
                if (accessDeniedMessage) accessDeniedMessage.style.display = 'none';
                if (googleAppsButton) {
                    googleAppsButton.style.pointerEvents = 'auto';
                    googleAppsButton.style.opacity = '1';
                }
                if (newsButton) newsButton.style.display = 'inline-block';
                await loadAndApplyUserAppsCSS(user.uid);
            }
        } else {
            currentUser = null;
            if (userInfo) userInfo.textContent = '';
            if (loginGoogleButton) loginGoogleButton.style.display = 'inline-block';
            if (loginGitHubButton) loginGitHubButton.style.display = 'inline-block';
            if (logoutButton) logoutButton.style.display = 'none';
            isCurrentUserBanned = false;
            if (bannedMessage) bannedMessage.style.display = 'none';
            setNavLinksEnabled(false);
            if (contentFrame) contentFrame.style.display = 'none';
            if (accessDeniedMessage) accessDeniedMessage.style.display = 'none';
            if (userProfilePic) {
                userProfilePic.style.display = 'none';
                userProfilePic.src = '';
            }
            if (googleAppsButton) googleAppsButton.style.display = 'none';
            if (userInfoContainer) userInfoContainer.style.display = 'none';
            if (googleAppsPopup) googleAppsPopup.style.display = 'none';
            if (customAppCssStyleTag) customAppCssStyleTag.innerHTML = '';
            if (contentFrame) contentFrame.style.display = 'block';
            if (newsButton) newsButton.style.display = 'none';
            if (newsCenterPopup) newsCenterPopup.style.display = 'none';
            hideNewsPopup();
        }
        if (componentHandler) {
            componentHandler.upgradeDom();
        }
    });

    // --- Captura e exibe erros do console ---
    window._wzzmErrorLog = [];
    window.addEventListener('error', function(e) { window._wzzmErrorLog.push(`[${new Date().toLocaleTimeString()}] ${e.message} (${e.filename}:${e.lineno})`); });
    window.addEventListener('unhandledrejection', function(e) { window._wzzmErrorLog.push(`[${new Date().toLocaleTimeString()}] Unhandled Promise: ${e.reason}`); });
    (function() {
        const originalError = console.error;
        console.error = function(...args) {
            window._wzzmErrorLog.push(`[${new Date().toLocaleTimeString()}] console.error: ${args.join(' ')}`);
            originalError.apply(console, args);
        };
    })();

    // --- Event Listeners e Carregamento de dados ---
    document.addEventListener('DOMContentLoaded', () => {
        // Carrega configurações do Firebase em tempo real
        const docId = 'configuracoes';
        firestore.collection('configuracoes').doc(docId).onSnapshot(docSnapshot => {
            if (docSnapshot.exists) {
                const data = docSnapshot.data();
                applyConfigData(data);
                console.log("Configurações carregadas do Firebase (em tempo real):", data);
            } else {
                console.warn(`Documento de configuração '${docId}' não encontrado. Usando valores padrão.`);
                applyConfigData({});
            }
        }, error => {
            console.error("Erro ao carregar configurações do Firebase:", error);
            applyConfigData({});
        });

        // Carrega o menu do arquivo JSON
        fetch('menu.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(menuItems => {
                const drawerMenu = document.getElementById('drawer-menu');
                if (!drawerMenu) return;
                drawerMenu.innerHTML = '';
                menuItems.forEach(item => {
                    const a = document.createElement('a');
                    a.className = 'mdl-navigation__link';
                    a.href = '#';
                    a.textContent = item.name;
                    a.setAttribute('onclick', `loadPage('${item.url}', ${item.requiresAuth || false})`);
                    if (item.requiresAuth) {
                        a.setAttribute('data-requires-auth', 'true');
                    }
                    drawerMenu.appendChild(a);
                });
                if (componentHandler) {
                    componentHandler.upgradeDom();
                }
                setNavLinksEnabled(!!currentUser);
            })
            .catch(error => {
                console.error('Erro ao carregar menu.json:', error);
            });

        // Adiciona event listeners para botões e popups
        const googleAppsButton = document.getElementById('google-apps-button');
        const googleAppsPopup = document.getElementById('google-apps-popup');
        const navLinks = document.querySelectorAll('.mdl-navigation__link');
        const newsButton = document.getElementById('news-button');
        const newsCenterPopup = document.getElementById('news-center-popup');
        const closeNewsPopupButton = document.getElementById('close-news-popup-button');
        const viewAllNewsButton = document.getElementById('view-all-news-button');

        if (googleAppsButton) {
            googleAppsButton.addEventListener('click', (event) => {
                event.stopPropagation();
                if (googleAppsPopup.style.display === 'block') {
                    googleAppsPopup.style.display = 'none';
                } else {
                    googleAppsPopup.style.display = 'block';
                    const appGrid = document.getElementById('app-grid');
                    appGrid.innerHTML = '';
                    const wzzmServices = [
                        { name: 'Office WZZM', url: 'https://office.wzzm.org', iconUrl: 'https://wzzm.org/iconmagic.png' },
                        { name: 'Escolar WZZM', url: 'https://escolar.wzzm.org', iconUrl: 'https://wzzm.org/iconmagic.png' },
                        { name: 'Minha Persona WZZM', url: 'https://minhapersona.wzzm.org', iconUrl: 'https://wzzm.org/iconmagic.png' },
                        { name: 'Wiki Zero', url: 'https://wikizero.wzzm.org/', iconUrl: 'https://wzzm.org/iconmagic.png' },
                        { name: 'UWG Wikidot', url: 'https://uwg.wikidot.com', iconUrl: 'https://uwg.wikidot.png' },
                        { name: 'Wiki Metro SP', url: 'https://wikimetrosp.miraheze.org', iconUrl: 'https://wikimetrosp.miraheze.org/logo.png' }
                    ];
                    wzzmServices.forEach(app => {
                        const appItem = document.createElement('div');
                        appItem.classList.add('app-item');
                        appItem.innerHTML = `<img src="${app.iconUrl}" alt="${app.name}"> <span>${app.name}</span>`;
                        appItem.addEventListener('click', () => {
                            loadInMainFrame(app.url);
                            googleAppsPopup.style.display = 'none';
                        });
                        appGrid.appendChild(appItem);
                    });
                }
            });
        }
        if (newsButton) {
            newsButton.addEventListener('click', (event) => {
                event.stopPropagation();
                if (newsCenterPopup.style.display === 'flex') {
                    hideNewsPopup();
                } else {
                    showNewsPopup();
                }
            });
        }
        if (closeNewsPopupButton) {
            closeNewsPopupButton.addEventListener('click', () => { hideNewsPopup(); });
        }
        if (viewAllNewsButton) {
            viewAllNewsButton.addEventListener('click', () => {
                loadInMainFrame('visualizarnoticias.html');
                hideNewsPopup();
            });
        }
        document.addEventListener('click', (event) => {
            if (googleAppsPopup && googleAppsPopup.style.display === 'block' && !googleAppsButton.contains(event.target) && !googleAppsPopup.contains(event.target)) {
                googleAppsPopup.style.display = 'none';
            }
            if (newsCenterPopup && newsCenterPopup.style.display === 'flex' && !newsButton.contains(event.target) && !newsCenterPopup.contains(event.target)) {
                newsCenterPopup.style.display = 'none';
            }
        });
        navLinks.forEach(link => {
            link.addEventListener('click', function(event) {
                const pageSrc = this.getAttribute('onclick');
                let actualPageSrc = '';
                let requiresAuth = false;
                if (pageSrc && pageSrc.includes("loadPage(")) {
                    const match = pageSrc.match(/loadPage\('([^']*)', (true|false)\)/);
                    if (match) {
                        actualPageSrc = match[1];
                        requiresAuth = match[2] === 'true';
                    }
                }
                if (isCurrentUserBanned && !actualPageSrc.includes('POL%C3%8DTICAS%20GERAIS%20DO%20WIKI%20ZONE%20ZERO%20MOD.pdf')) {
                    event.preventDefault();
                    return;
                }
                if (this.classList.contains('disabled') && !actualPageSrc.includes('POL%C3%8DTICAS%20GERAIS%20DO%20WIKI%20ZONE%20ZERO%20MOD.pdf')) {
                    event.preventDefault();
                    return;
                }
                if (actualPageSrc.includes('POL%C3%8DTICAS%20GERAIS%20DO%20WIKI%20ZONE%20ZERO%20MOD.pdf')) {
                    window.open(actualPageSrc, '_blank');
                    event.preventDefault();
                    return;
                }
                event.preventDefault();
                loadInMainFrame(actualPageSrc);
                if (document.querySelector('.mdl-layout__drawer.is-visible')) {
                    document.querySelector('.mdl-layout__obfuscator').classList.remove('is-visible');
                    document.querySelector('.mdl-layout__drawer').classList.remove('is-visible');
                }
            });
        });
        if (componentHandler) {
            componentHandler.upgradeDom();
        }

        var btn = document.getElementById('error-log-button');
        if (!btn) return;
        btn.addEventListener('click', function() {
            var logList = document.getElementById('error-log-list');
            logList.innerHTML = '';
            if (window._wzzmErrorLog.length === 0) {
                logList.innerHTML = '<li style="color:green;">Nenhum erro registrado nesta sessão.</li>';
            } else {
                window._wzzmErrorLog.slice(-100).forEach(function(msg) {
                    var li = document.createElement('li');
                    li.textContent = msg;
                    logList.appendChild(li);
                });
            }
            document.getElementById('error-log-popup').style.display = 'block';
        });
    });
</script>
</body>
</html>
