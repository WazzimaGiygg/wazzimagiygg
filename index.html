<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wiki Not Pedia WZZM</title>
    <link rel="icon" href="favicom.png" type="image/x-icon">
    <style>
        body {
            margin: 0;
            /* SEU PLANO DE FUNDO EST√Å DEFINIDO AQUI: */
            background: url('condedmonddant√®s.png') center/cover no-repeat;
            font-family: 'Segoe UI', sans-serif;
            height: 100vh;
            overflow: hidden;
        }

        /* Barra de tarefas */
        .taskbar {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 40px;
            background: rgba(20, 20, 20, 0.8);
            display: flex;
            align-items: center;
            /* Adicionado espa√ßo entre elementos na taskbar */
            justify-content: space-between; 
            padding: 0 10px;
            color: white;
            box-sizing: border-box;
        }

        /* Container dos bot√µes Iniciar, Admin e Ferramentas */
        .taskbar-left { /* Alterado para incluir o novo bot√£o */
            display: flex;
            align-items: center;
        }
        
        /* Estilo para o rel√≥gio na direita */
        #clock {
            padding: 0 10px;
            text-align: right;
            line-height: 1.2;
            font-size: 0.85em;
        }

        .start-button {
            background: rgba(40, 40, 40, 0.9);
            border: none;
            color: white;
            padding: 5px 15px;
            margin-right: 10px;
            border-radius: 6px;
            cursor: pointer;
        }

        .menu {
            position: absolute;
            bottom: 40px;
            left: 10px;
            background: rgba(30, 30, 30, 0.95);
            color: white;
            border-radius: 8px;
            padding: 10px;
            width: 280px;
            display: none;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 6px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .menu-item img {
            width: 20px;
            height: 20px;
            margin-right: 8px;
        }

        .window {
            position: absolute;
            top: 60px;
            left: 60px;
            width: 800px;
            height: 500px;
            background: white;
            border: 1px solid #666;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            resize: both;
            overflow: hidden;
            border-radius: 8px;
            z-index: 100; /* Garante que a janela fique sobre os menus */
        }

        .window-header {
            background: #0078d7;
            color: white;
            padding: 6px 10px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .window-controls button {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-weight: bold;
            margin-left: 5px;
        }

        .window iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Tela de login */
        #login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 9999;
        }

        #login-screen h2 {
            /* T√≠tulo alterado no HTML */
        }

        #login-screen p {
            /* Par√°grafo alterado no HTML */
        }

        #login-screen button {
            padding: 10px 20px;
            background: #0078d7;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 15px;
        }

        /* Popup admin e novo popup ferramentas */
        .admin-popup, .tools-popup { /* Adicionado .tools-popup */
            position: absolute;
            bottom: 50px;
            /* Ajuste o left para posicionar os menus de forma coerente */
            left: 100px; /* Ser√° ajustado para o tools-popup no JS */
            width: 320px;
            background: rgba(40, 40, 40, 0.95);
            color: white;
            border-radius: 8px;
            padding: 10px;
            display: none;
        }
        
        /* NOVO: Estilo para o menu de ferramentas para garantir que os links se pare√ßam com itens de menu */
        .tools-popup a {
            display: block;
            color: white;
            padding: 6px;
            border-radius: 6px;
            text-decoration: none;
            margin-bottom: 2px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .tools-popup a:hover {
            background: rgba(255, 255, 255, 0.15);
        }
    </style>
</head>
<body>

    <div id="login-screen">
        <h2>Bem-vindo(a) ao Wiki Not Pedia WZZM</h2>
        <p>Fa√ßa login para acessar a √°rea de trabalho</p>
        <button id="loginBtn">Entrar com Google</button>
    </div>

    <div id="desktop">
        <div class="taskbar">
            <div class="taskbar-left">
                <button class="start-button" id="startBtn">Iniciar</button>
                <button class="start-button" id="adminBtn">Wiki Not P√©dia</button>
                <button class="start-button" id="toolsBtn">Ferramentas</button>
            </div>
            <div id="clock"></div>
        </div>

        <div class="menu" id="startMenu"></div>
        <div class="admin-popup" id="adminMenu"></div>
        <div class="admin-popup tools-popup" id="toolsMenu"></div>
    </div>

    <script type="module">
    // üîπ Firebase Auth Config
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0", // Chave de API removida por seguran√ßa
        authDomain: "wzzm-ce3fc.firebaseapp.com",
        projectId: "wzzm-ce3fc",
        storageBucket: "wzzm-ce3fc.appspot.com",
        messagingSenderId: "249427877153",
        appId: "1:249427877153:web:0e4297294794a5aadeb260",
        measurementId: "G-PLKNZNFCQ8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // ‚ùå REMOVIDO: adminUIDs n√£o √© mais necess√°rio
    // const adminUIDs = [ "6aPqWVh8JVYL5NqEb78iDGPD7dH3", "sZxfMuOBPbXdR8nttVPXIN8QOOl1" ];


    const loginScreen = document.getElementById("login-screen");
    const loginBtn = document.getElementById("loginBtn");
    const desktop = document.getElementById("desktop");
    const startMenu = document.getElementById("startMenu");
    const adminMenu = document.getElementById("adminMenu");
    // ‚úÖ NOVO: Elemento do Menu de Ferramentas
    const toolsMenu = document.getElementById("toolsMenu");
    const clockElement = document.getElementById("clock");

    loginBtn.addEventListener("click", () => {
        signInWithPopup(auth, provider);
    });

    // ‚úÖ L√≥gica Alterada: Qualquer usu√°rio logado (user) ter√° acesso
    onAuthStateChanged(auth, (user) => {
        if (user) {
            // Se houver um usu√°rio logado (qualquer um), exibe o desktop
            loginScreen.style.display = "none";
            desktop.style.display = "block";
            updateClock(); 
        } else {
            // Se n√£o houver usu√°rio logado, exibe a tela de login
            loginScreen.style.display = "flex";
            desktop.style.display = "none";
        }
    });

    // üîπ Itens do menu principal (com a op√ß√£o Logoff)
    const links = [
        { name: 'Termos de Servi√ßo', url: 'Termos%20de%20Servi%C3%A7o.pdf', iconUrl: 'iconmagic.png' },
        { name: 'Pol√≠tica de Privacidade', url: 'Pol%C3%ADtica%20de%20Privacidade.pdf', iconUrl: 'iconmagic.png' },
        { name: 'Area do colaborador', url: 'html/?uid=CKWtV1wmyHKNw6ie7qAh', iconUrl: 'iconmagic.png' },  
        { name: 'Area escolar', url: 'escolar/', iconUrl: 'iconmagic.png' },  
        { name: 'Manual de Pol√≠ticas de direito de privacidade ', url: 'html/?uid=F5CmMQDbrTpipTZoqd2x', iconUrl: 'iconmagic.png' },
        { name: 'Direito de privacidade sobre Wiki Not Pedia', url: 'html/?uid=ik1hWPxqHKLjA13MIqVW', iconUrl: 'iconmagic.png' }, 
        { name: 'Quem somos n√≥s?', url: 'html/?uid=84TOyGBBxrsuzjWLyLwU', iconUrl: 'iconmagic.png' }, 
        { name: 'Blog Leia e Compreenda', url: 'https://leiacompreenda.blogspot.com/', iconUrl: 'iconmagic.png' },
        { name: 'Fale com a Administra√ß√£o', url: 'contato/', iconUrl: 'iconmagic.png' },
        { name: 'Wiki Not Pedia', url: 'wnpx.html', iconUrl: 'iconmagic.png' },
        { name: 'Logoff (Sair)', action: 'logout', iconUrl: 'iconmagic.png' } //
    ];

    // üîπ Menu admin separado
    const adminLinks = [
        { label: "P√°gina inicial", href: "admin/recepcao.html" },
        { label: "Espa√ßo Cliente", href: "cw22.html" },
        { label: "Chat (Contato)", href: "contato.html" },
        { label: "Acess√≥rios", href: "tools/" }
    ];

    // ‚úÖ NOVO: Lista de links para o menu de Ferramentas (filtrados no JS)
    const rawToolLinks = [
        { name: 'Procurar Artigos', url: 'recepcao.html' },
        { name: 'Espa√ßo Cliente', url: './cw22.html' },
        { name: 'Chat (Contato)', url: 'contato.html' },
        { name: 'Buscar Artigos WNP', url: 'ferramentasuteis.html' },
        { name: 'Acess√≥rios', url: './tools/' },
        { name: 'Adicionar novo Artigo Wiki Not P√©dia', url: 'adicaoavancada/' },
        { name: 'Editar artigos', url: 'alt/' },
        { name: 'Editor na Base 44', url: 'https://wiki-zone-zero-mod-copy-2a26f6a1.base44.app' },
        { name: 'Novo artigo cientifico', url: 'novoartigo/' },
        { name: 'Abrir canal antifake news', url: 'https://veritas-ai-f7c564f8.base44.app/' },
        { name: 'Abrir canal de relat√≥rios sobre investiga√ß√µes', url: 'https://sentinela-09d29cc0.base44.app/Dashboard/' },
        { name: 'Abrir canal de investiga√ß√µes relacionadas a Wiki dominante', url: 'https://wiki-watch-c9ef4323.base44.app/' },
        { name: 'Padroniza√ß√£o ABNT', url: 'https://quali-track-de9a4ada.base44.app/' },
        { name: 'Investiga√ß√£o de veritas na Internet ', url: 'https://veritas-d7781517.base44.app/' },
        { name: 'Registro de ocorr√™ncias em geral ', url: 'https://event-guard-4eee598e.base44.app/' },
        { name: 'Verificador externo de pl√°gio ', url: 'https://originality-guard-ef12748b.base44.app' },
        { name: 'Editor de Artigo HTML ', url: 'https://app--wiki-zone-zero-mod-e98820b7.base44.app/' },
        { name: 'Preview Workspace', url: 'https://app.base44.com/apps/68e9a4aa3b54569260c4df7c/editor/preview/Workspace' }
    ];

    // ‚úÖ NOVO: Filtrar links, removendo aqueles com 'base44.app' ou 'base44.com'
    const filteredToolLinks = rawToolLinks.filter(link => 
        !link.url.includes('base44.app') && !link.url.includes('base44.com')
    );

    // ‚úÖ NOVO: Fun√ß√£o para preencher o menu de ferramentas
    function populateToolsMenu() {
        toolsMenu.innerHTML = ''; // Limpa o menu primeiro
        filteredToolLinks.forEach(link => {
            const a = document.createElement("a");
            a.textContent = link.name;
            a.href = link.url; // Embora n√£o use, √© bom ter no elemento <a>
            a.onclick = (e) => {
                e.preventDefault(); 
                openWindow(link.name, link.url); 
                toolsMenu.style.display = "none"; 
            };
            toolsMenu.appendChild(a);
        });
    }

    // Preenche o menu de ferramentas ao carregar
    populateToolsMenu();

    // üîπ Preenche o Menu Iniciar
    links.forEach(item => {
        const div = document.createElement("div");
        div.className = "menu-item";
        div.innerHTML = `<img src="${item.iconUrl}" alt="icon"> ${item.name}`;
        
        div.onclick = () => {
            if (item.action === 'logout') {
                handleLogout(); 
            } else {
                openWindow(item.name, item.url);
            }
            startMenu.style.display = "none"; 
        };
        startMenu.appendChild(div);
    });

    // üîπ Preenche o Menu Admin
    adminLinks.forEach(link => {
        const a = document.createElement("a");
        a.textContent = link.label;
        a.style.cursor = 'pointer'; 
        a.onclick = (e) => {
            e.preventDefault(); 
            openWindow(link.label, link.href); 
            adminMenu.style.display = "none"; 
        };
        adminMenu.appendChild(a);
    });

    const startBtn = document.getElementById("startBtn");
    const adminBtn = document.getElementById("adminBtn");
    // ‚úÖ NOVO: Bot√£o Ferramentas
    const toolsBtn = document.getElementById("toolsBtn");

    startBtn.onclick = () => {
        startMenu.style.display = startMenu.style.display === "block" ? "none" : "block";
        adminMenu.style.display = "none";
        toolsMenu.style.display = "none"; // Garante que o menu de ferramentas feche
    };

    adminBtn.onclick = () => {
        adminMenu.style.display = adminMenu.style.display === "block" ? "none" : "block";
        startMenu.style.display = "none";
        toolsMenu.style.display = "none"; // Garante que o menu de ferramentas feche
    };

    // ‚úÖ NOVO: L√≥gica de clique para o bot√£o Ferramentas
    toolsBtn.onclick = () => {
        // Posi√ß√£o para o toolsMenu (exemplo: ao lado do adminMenu)
        const adminBtnWidth = adminBtn.offsetWidth;
        toolsMenu.style.left = `${10 + startBtn.offsetWidth + adminBtnWidth + 10}px`; 

        toolsMenu.style.display = toolsMenu.style.display === "block" ? "none" : "block";
        startMenu.style.display = "none";
        adminMenu.style.display = "none"; 
    };

    function handleLogout() {
        signOut(auth).then(() => {
            // O onAuthStateChanged listener cuidar√° de mostrar a tela de login
        }).catch((error) => {
            console.error("Erro ao sair:", error);
            alert("Erro ao tentar fazer logoff.");
        });
    }

    // Fun√ß√£o para atualizar o rel√≥gio 
    function updateClock() {
        const now = new Date();
        
        // Formato da hora (HH:MM)
        const timeString = now.toLocaleTimeString('pt-BR', { 
            hour: '2-digit', 
            minute: '2-digit', 
            hour12: false // Formato 24h
        });
        
        // Formato da data (DD/MM)
        const dateString = now.toLocaleDateString('pt-BR', { 
            day: '2-digit', 
            month: '2-digit' 
        });

        // Atualiza o conte√∫do do elemento #clock
        clockElement.innerHTML = `<span>${timeString}</span><br><span>${dateString}</span>`;

        // Agenda a pr√≥xima atualiza√ß√£o em 1 segundo
        setTimeout(updateClock, 1000);
    }


    function openWindow(title, url) {
        const win = document.createElement("div");
        win.className = "window";
        win.innerHTML = `
            <div class="window-header">
                <span>${title}</span>
                <div class="window-controls">
                    <button class="minimize">‚Äî</button>
                    <button class="maximize">‚¨ú</button>
                    <button class="close">‚úñ</button>
                </div>
            </div>
            <iframe src="${url}"></iframe>
        `;
        document.body.appendChild(win);

        // ... (c√≥digo de drag, resize e controles da janela) ...
        const header = win.querySelector(".window-header");
        // const iframe = win.querySelector("iframe"); // N√£o usado diretamente, removido
        let isDragging = false;
        let offsetX, offsetY;
        let maximized = false;
        let prev = { top: 0, left: 0, width: 0, height: 0 };

        header.addEventListener("mousedown", (e) => {
            isDragging = true;
            offsetX = e.clientX - win.offsetLeft;
            offsetY = e.clientY - win.offsetTop;
        });

        document.addEventListener("mousemove", (e) => {
            if (isDragging && !maximized) {
                win.style.left = e.clientX - offsetX + "px";
                win.style.top = e.clientY - offsetY + "px";
            }
        });

        document.addEventListener("mouseup", () => isDragging = false);

        win.querySelector(".close").onclick = () => win.remove();
        win.querySelector(".minimize").onclick = () => win.style.display = "none";
        win.querySelector(".maximize").onclick = () => {
            if (!maximized) {
                prev = { top: win.offsetTop, left: win.offsetLeft, width: win.offsetWidth, height: win.offsetHeight };
                win.style.top = "0";
                win.style.left = "0";
                win.style.width = "100%";
                win.style.height = "calc(100% - 40px)";
                maximized = true;
            } else {
                win.style.top = prev.top + "px";
                win.style.left = prev.left + "px";
                win.style.width = prev.width + "px";
                win.style.height = prev.height + "px";
                maximized = false;
            }
        };
    }
    </script>

</body>
</html>
