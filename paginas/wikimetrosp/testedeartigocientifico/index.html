<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Artigo Científico - WZZM</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-lite/1.3.0/material.indigo-pink.min.css">
    <style>
        :root {
            --primary-color: #3f51b5;
            --secondary-color: #2196f3;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --light-bg: #f5f5f5;
            --dark-text: #333;
            --light-text: #666;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', 'Helvetica', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark-text);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
        }

        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: #f0f4ff;
            border-radius: 20px;
            font-size: 14px;
        }

        .user-info i {
            color: var(--primary-color);
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--error-color);
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
        }

        .logout-btn:hover {
            opacity: 0.8;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #303f9f;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        h1 {
            color: var(--primary-color);
            font-weight: 500;
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            padding-bottom: 15px;
        }

        h1:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 2px;
        }

        .editor-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .editor-container {
                grid-template-columns: 1fr;
            }
        }

        .editor-panel, .preview-panel {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
            height: fit-content;
        }

        .preview-panel {
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }

        .section-title {
            font-size: 20px;
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--dark-text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Roboto', sans-serif;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary-color);
            background: white;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
            line-height: 1.6;
        }

        .formatting-tools {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .format-btn {
            padding: 8px 12px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: var(--dark-text);
            transition: all 0.2s ease;
        }

        .format-btn:hover {
            background: #f0f0f0;
            border-color: var(--secondary-color);
        }

        .format-btn.active {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .format-group {
            display: flex;
            gap: 5px;
            border-right: 1px solid #ddd;
            padding-right: 10px;
        }

        .format-group:last-child {
            border-right: none;
            padding-right: 0;
        }

        .word-count {
            font-size: 13px;
            color: var(--light-text);
            text-align: right;
            margin-top: 5px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 180px;
            justify-content: center;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #303f9f;
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background: #0d8bf2;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #3d8b40;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background: #e68900;
        }

        .btn-error {
            background: var(--error-color);
            color: white;
        }

        .btn-error:hover {
            background: #d32f2f;
        }

        /* Preview Styles */
        .preview-title {
            font-size: 28px;
            font-weight: 500;
            margin-bottom: 20px;
            color: var(--dark-text);
            line-height: 1.3;
        }

        .author-info {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .authors-label {
            font-size: 14px;
            color: var(--light-text);
            margin-bottom: 10px;
            display: block;
        }

        .authors-list {
            font-size: 16px;
            color: var(--dark-text);
        }

        .abstract-box {
            background: #e8f5e9;
            border-left: 4px solid var(--success-color);
            padding: 20px;
            margin: 30px 0;
            border-radius: 8px;
        }

        .keywords {
            font-style: italic;
            color: var(--light-text);
            margin: 20px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .content-section {
            margin: 30px 0;
        }

        .content-section h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--primary-color);
            font-weight: 500;
        }

        .article-body {
            font-size: 16px;
            line-height: 1.8;
            color: var(--dark-text);
        }

        .article-body p {
            margin-bottom: 20px;
            text-align: justify;
        }

        .article-body.text-left p { text-align: left; }
        .article-body.text-center p { text-align: center; }
        .article-body.text-right p { text-align: right; }
        .article-body.text-justify p { text-align: justify; }

        .article-body h2, .article-body h3, .article-body h4 {
            margin: 30px 0 15px 0;
            color: var(--primary-color);
        }

        .article-body ul, .article-body ol {
            margin-left: 20px;
            margin-bottom: 20px;
        }

        .article-body li {
            margin-bottom: 10px;
        }

        .references-section {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .references-label {
            font-size: 16px;
            color: var(--primary-color);
            margin-bottom: 15px;
            font-weight: 500;
        }

        .reference-item {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .reference-item:before {
            content: '•';
            color: var(--primary-color);
            font-size: 20px;
            position: absolute;
            left: 0;
        }

        .reference-item a {
            color: var(--secondary-color);
            text-decoration: none;
        }

        .reference-item a:hover {
            text-decoration: underline;
        }

        .article-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            font-size: 14px;
            color: var(--light-text);
        }

        .stats-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Link Dialog */
        .link-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .link-dialog-content {
            background-color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow);
        }

        .link-dialog h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .link-dialog input {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            background: #fafafa;
        }

        .link-dialog input:focus {
            outline: none;
            border-color: var(--secondary-color);
            background: white;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .dialog-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .dialog-buttons button {
            padding: 10px 20px;
            min-width: 100px;
        }

        /* Loading and Error States */
        .loading {
            text-align: center;
            padding: 100px 20px;
        }

        .loading i {
            font-size: 60px;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .loading p {
            font-size: 18px;
            color: var(--light-text);
        }

        .error {
            text-align: center;
            padding: 100px 20px;
            color: var(--error-color);
        }

        .error i {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .error h2 {
            margin-bottom: 20px;
            color: var(--error-color);
        }

        /* Save/Load Dialog */
        .save-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }

        .save-dialog-content {
            background-color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            box-shadow: var(--shadow);
            max-height: 80vh;
            overflow-y: auto;
        }

        .save-dialog h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .articles-list {
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .article-item {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .article-item:hover {
            background: #f5f5f5;
        }

        .article-item:last-child {
            border-bottom: none;
        }

        .article-item-title {
            font-weight: 500;
            margin-bottom: 5px;
            color: var(--dark-text);
        }

        .article-item-meta {
            font-size: 13px;
            color: var(--light-text);
            display: flex;
            gap: 15px;
        }

        .article-item-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        .article-item-btn {
            padding: 5px 10px;
            font-size: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Login Screen */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 40px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
        }

        .login-container h1 {
            margin-bottom: 30px;
        }

        .login-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 15px 30px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            background: #303f9f;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .login-btn i {
            font-size: 20px;
        }

        /* Empty Preview State */
        .empty-preview {
            text-align: center;
            padding: 80px 20px;
            color: var(--light-text);
        }

        .empty-preview i {
            font-size: 60px;
            margin-bottom: 20px;
            color: #bdbdbd;
        }

        .empty-preview p {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .empty-preview .hint {
            font-size: 14px;
            color: #9e9e9e;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--success-color);
            color: white;
            border-radius: 8px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1002;
            animation: slideIn 0.3s ease;
            display: none;
        }

        .toast.error {
            background: var(--error-color);
        }

        .toast.warning {
            background: var(--warning-color);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            header, .editor-panel, .preview-panel {
                padding: 20px;
            }
            
            .user-info {
                position: static;
                margin-bottom: 15px;
                justify-content: center;
            }
            
            .preview-title {
                font-size: 24px;
            }
            
            .header-top {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .action-btn {
                min-width: 100%;
            }
            
            .formatting-tools {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .format-group {
                flex-wrap: wrap;
                border-right: none;
                padding-right: 0;
                border-bottom: 1px solid #ddd;
                padding-bottom: 10px;
                margin-bottom: 10px;
                width: 100%;
            }
            
            .format-group:last-child {
                border-bottom: none;
                margin-bottom: 0;
                padding-bottom: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container" style="display: none;">
        <h1><i class="material-icons">lock</i> Login Necessário</h1>
        <p>Para usar o editor de artigos, faça login com sua conta Google.</p>
        <button id="loginBtn" class="login-btn">
            <i class="material-icons">login</i>
            Login com Google
        </button>
        <div style="margin-top: 30px; color: var(--light-text); font-size: 14px;">
            <i class="material-icons">info</i>
            Seus artigos serão salvos na sua conta pessoal.
        </div>
    </div>

    <!-- Main Editor -->
    <div id="editorScreen" class="container" style="display: none;">
        <header>
            <div class="user-info" id="userInfo">
                <i class="material-icons">account_circle</i>
                <span id="userEmail">Carregando...</span>
                <button class="logout-btn" id="logoutBtn">
                    <i class="material-icons">logout</i>
                    Sair
                </button>
            </div>
            
            <div class="header-top">
                <button class="back-btn" onclick="goBack()">
                    <i class="material-icons">arrow_back</i>
                    Voltar
                </button>
                <h1>Editor de Artigo Científico</h1>
                <div style="width: 100px;"></div> <!-- Espaçador -->
            </div>
        </header>

        <div class="editor-container">
            <!-- Painel de Edição -->
            <div class="editor-panel">
                <h2 class="section-title"><i class="material-icons">edit</i> Editar Artigo</h2>
                
                <div class="form-group">
                    <label class="form-label" for="articleTitle">
                        <i class="material-icons">title</i>
                        Título do Artigo
                    </label>
                    <input type="text" id="articleTitle" class="form-control" placeholder="Digite o título do artigo">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="authorName">
                        <i class="material-icons">person</i>
                        Autor(es)
                    </label>
                    <input type="text" id="authorName" class="form-control" placeholder="Nome do(s) autor(es), separados por vírgula">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="institution">
                        <i class="material-icons">business</i>
                        Instituição
                    </label>
                    <input type="text" id="institution" class="form-control" placeholder="Instituição de origem">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="abstract">
                        <i class="material-icons">description</i>
                        Resumo
                    </label>
                    <textarea id="abstract" class="form-control" placeholder="Digite o resumo do artigo aqui..."></textarea>
                    <div class="word-count" id="abstractCount">0 palavras</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="keywords">
                        <i class="material-icons">label</i>
                        Palavras-chave
                    </label>
                    <input type="text" id="keywords" class="form-control" placeholder="ex: estudo morfológico, arcos dentários, crânios">
                </div>
                
                <!-- Introdução -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="material-icons">assignment</i>
                        Introdução
                    </label>
                    <div class="formatting-tools" id="introTools">
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="bold" data-target="introduction" title="Negrito">
                                <i class="material-icons">format_bold</i>
                            </button>
                            <button type="button" class="format-btn" data-format="italic" data-target="introduction" title="Itálico">
                                <i class="material-icons">format_italic</i>
                            </button>
                            <button type="button" class="format-btn" data-format="underline" data-target="introduction" title="Sublinhado">
                                <i class="material-icons">format_underlined</i>
                            </button>
                        </div>
                        
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="alignLeft" data-target="introduction" title="Alinhar à Esquerda">
                                <i class="material-icons">format_align_left</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignCenter" data-target="introduction" title="Centralizar">
                                <i class="material-icons">format_align_center</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignRight" data-target="introduction" title="Alinhar à Direita">
                                <i class="material-icons">format_align_right</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignJustify" data-target="introduction" title="Justificar Texto">
                                <i class="material-icons">format_align_justify</i>
                            </button>
                        </div>
                        
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="insertLink" data-target="introduction" title="Inserir Link">
                                <i class="material-icons">insert_link</i>
                            </button>
                            <button type="button" class="format-btn" data-format="clearFormat" data-target="introduction" title="Limpar Formatação">
                                <i class="material-icons">format_clear</i>
                            </button>
                        </div>
                    </div>
                    <textarea id="introduction" class="form-control" placeholder="Digite a introdução do artigo aqui..."></textarea>
                    <div class="word-count" id="introCount">0 palavras</div>
                </div>
                
                <!-- Metodologia -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="material-icons">science</i>
                        Metodologia
                    </label>
                    <div class="formatting-tools" id="methodologyTools">
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="bold" data-target="methodology" title="Negrito">
                                <i class="material-icons">format_bold</i>
                            </button>
                            <button type="button" class="format-btn" data-format="italic" data-target="methodology" title="Itálico">
                                <i class="material-icons">format_italic</i>
                            </button>
                        </div>
                        
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="alignLeft" data-target="methodology" title="Alinhar à Esquerda">
                                <i class="material-icons">format_align_left</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignCenter" data-target="methodology" title="Centralizar">
                                <i class="material-icons">format_align_center</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignRight" data-target="methodology" title="Alinhar à Direita">
                                <i class="material-icons">format_align_right</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignJustify" data-target="methodology" title="Justificar Texto">
                                <i class="material-icons">format_align_justify</i>
                            </button>
                        </div>
                        
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="insertLink" data-target="methodology" title="Inserir Link">
                                <i class="material-icons">insert_link</i>
                            </button>
                            <button type="button" class="format-btn" data-format="clearFormat" data-target="methodology" title="Limpar Formatação">
                                <i class="material-icons">format_clear</i>
                            </button>
                        </div>
                    </div>
                    <textarea id="methodology" class="form-control" placeholder="Descreva a metodologia utilizada no estudo..."></textarea>
                    <div class="word-count" id="methodCount">0 palavras</div>
                </div>
                
                <!-- Resultados -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="material-icons">bar_chart</i>
                        Resultados
                    </label>
                    <div class="formatting-tools" id="resultsTools">
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="bold" data-target="results" title="Negrito">
                                <i class="material-icons">format_bold</i>
                            </button>
                            <button type="button" class="format-btn" data-format="italic" data-target="results" title="Itálico">
                                <i class="material-icons">format_italic</i>
                            </button>
                        </div>
                        
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="alignLeft" data-target="results" title="Alinhar à Esquerda">
                                <i class="material-icons">format_align_left</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignCenter" data-target="results" title="Centralizar">
                                <i class="material-icons">format_align_center</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignRight" data-target="results" title="Alinhar à Direita">
                                <i class="material-icons">format_align_right</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignJustify" data-target="results" title="Justificar Texto">
                                <i class="material-icons">format_align_justify</i>
                            </button>
                        </div>
                        
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="insertLink" data-target="results" title="Inserir Link">
                                <i class="material-icons">insert_link</i>
                            </button>
                            <button type="button" class="format-btn" data-format="clearFormat" data-target="results" title="Limpar Formatação">
                                <i class="material-icons">format_clear</i>
                            </button>
                        </div>
                    </div>
                    <textarea id="results" class="form-control" placeholder="Apresente os resultados obtidos..."></textarea>
                    <div class="word-count" id="resultsCount">0 palavras</div>
                </div>
                
                <!-- Discussão -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="material-icons">forum</i>
                        Discussão
                    </label>
                    <div class="formatting-tools" id="discussionTools">
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="bold" data-target="discussion" title="Negrito">
                                <i class="material-icons">format_bold</i>
                            </button>
                            <button type="button" class="format-btn" data-format="italic" data-target="discussion" title="Itálico">
                                <i class="material-icons">format_italic</i>
                            </button>
                        </div>
                        
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="alignLeft" data-target="discussion" title="Alinhar à Esquerda">
                                <i class="material-icons">format_align_left</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignCenter" data-target="discussion" title="Centralizar">
                                <i class="material-icons">format_align_center</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignRight" data-target="discussion" title="Alinhar à Direita">
                                <i class="material-icons">format_align_right</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignJustify" data-target="discussion" title="Justificar Texto">
                                <i class="material-icons">format_align_justify</i>
                            </button>
                        </div>
                        
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="insertLink" data-target="discussion" title="Inserir Link">
                                <i class="material-icons">insert_link</i>
                            </button>
                            <button type="button" class="format-btn" data-format="clearFormat" data-target="discussion" title="Limpar Formatação">
                                <i class="material-icons">format_clear</i>
                            </button>
                        </div>
                    </div>
                    <textarea id="discussion" class="form-control" placeholder="Discuta os resultados e suas implicações..."></textarea>
                    <div class="word-count" id="discussionCount">0 palavras</div>
                </div>
                
                <!-- Conclusão -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="material-icons">check_circle</i>
                        Conclusão
                    </label>
                    <div class="formatting-tools" id="conclusionTools">
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="bold" data-target="conclusion" title="Negrito">
                                <i class="material-icons">format_bold</i>
                            </button>
                            <button type="button" class="format-btn" data-format="italic" data-target="conclusion" title="Itálico">
                                <i class="material-icons">format_italic</i>
                            </button>
                        </div>
                        
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="alignLeft" data-target="conclusion" title="Alinhar à Esquerda">
                                <i class="material-icons">format_align_left</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignCenter" data-target="conclusion" title="Centralizar">
                                <i class="material-icons">format_align_center</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignRight" data-target="conclusion" title="Alinhar à Direita">
                                <i class="material-icons">format_align_right</i>
                            </button>
                            <button type="button" class="format-btn" data-format="alignJustify" data-target="conclusion" title="Justificar Texto">
                                <i class="material-icons">format_align_justify</i>
                            </button>
                        </div>
                        
                        <div class="format-group">
                            <button type="button" class="format-btn" data-format="insertLink" data-target="conclusion" title="Inserir Link">
                                <i class="material-icons">insert_link</i>
                            </button>
                            <button type="button" class="format-btn" data-format="clearFormat" data-target="conclusion" title="Limpar Formatação">
                                <i class="material-icons">format_clear</i>
                            </button>
                        </div>
                    </div>
                    <textarea id="conclusion" class="form-control" placeholder="Apresente as conclusões do estudo..."></textarea>
                    <div class="word-count" id="conclusionCount">0 palavras</div>
                </div>
                
                <!-- Referências -->
                <div class="form-group">
                    <label class="form-label" for="references">
                        <i class="material-icons">library_books</i>
                        Referências Bibliográficas
                    </label>
                    <textarea id="references" class="form-control" placeholder="Insira as referências, uma por linha. Exemplo:
BADIM, J.; BADIM, J. M. D. Temporomandibular joint (TMJ) dysfunction. Revista da Sociedade Brasileira de Cirurgia Plástica, v. 17, n. 1, p. 51-9, 2002. Disponível em: https://exemplo.com/artigo
BARBOSA, A. C. Alterações da oclusão dentaria. In: ARAÚJO, R. B. (Org.). Fonoaudiologia atual. Rio de Janeiro: Revinter, 1997. p. 163-9." rows="5"></textarea>
                </div>
                
                <div class="button-group">
                    <button class="action-btn btn-primary" id="generateBtn">
                        <i class="material-icons">visibility</i>
                        Gerar Prévia
                    </button>
                    <button class="action-btn btn-success" id="saveBtn">
                        <i class="material-icons">save</i>
                        Salvar Artigo
                    </button>
                    <button class="action-btn btn-secondary" id="loadBtn">
                        <i class="material-icons">folder_open</i>
                        Carregar Artigo
                    </button>
                    <button class="action-btn btn-warning" id="printBtn">
                        <i class="material-icons">print</i>
                        Imprimir
                    </button>
                    <button class="action-btn btn-error" id="clearBtn">
                        <i class="material-icons">delete_sweep</i>
                        Limpar
                    </button>
                </div>
            </div>
            
            <!-- Painel de Visualização -->
            <div class="preview-panel">
                <h2 class="section-title"><i class="material-icons">preview</i> Pré-visualização</h2>
                <div id="articlePreview" class="empty-preview">
                    <i class="material-icons">edit_note</i>
                    <p>Preencha os campos ao lado</p>
                    <p class="hint">Clique em "Gerar Prévia" para ver o resultado aqui</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Diálogo para Inserir Links -->
    <div class="link-dialog" id="linkDialog">
        <div class="link-dialog-content">
            <h3><i class="material-icons">insert_link</i> Inserir Link</h3>
            <label class="form-label" for="linkText">Texto do Link:</label>
            <input type="text" id="linkText" placeholder="Texto visível do link">
            
            <label class="form-label" for="linkUrl">URL:</label>
            <input type="text" id="linkUrl" placeholder="https://exemplo.com">
            
            <div class="dialog-buttons">
                <button class="action-btn btn-warning" id="cancelLinkBtn">Cancelar</button>
                <button class="action-btn btn-success" id="insertLinkBtn">Inserir</button>
            </div>
        </div>
    </div>

    <!-- Diálogo para Salvar/Carregar Artigos -->
    <div class="save-dialog" id="saveDialog">
        <div class="save-dialog-content">
            <h3><i class="material-icons" id="dialogIcon">save</i> <span id="dialogTitle">Salvar Artigo</span></h3>
            
            <div id="saveForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label" for="saveArticleName">
                        <i class="material-icons">title</i>
                        Nome para salvar
                    </label>
                    <input type="text" id="saveArticleName" class="form-control" placeholder="Digite um nome para identificar este artigo">
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="material-icons">visibility</i>
                        Visibilidade
                    </label>
                    <div style="display: flex; gap: 15px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="radio" name="visibility" value="private" checked>
                            <span>Privado (somente você)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="radio" name="visibility" value="public">
                            <span>Público (todos podem ver)</span>
                        </label>
                    </div>
                </div>
                
                <div class="dialog-buttons">
                    <button class="action-btn btn-warning" id="cancelSaveBtn">Cancelar</button>
                    <button class="action-btn btn-success" id="confirmSaveBtn">Salvar</button>
                </div>
            </div>
            
            <div id="loadForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">
                        <i class="material-icons">search</i>
                        Meus Artigos Salvos
                    </label>
                    <div class="articles-list" id="articlesList">
                        <!-- Artigos serão carregados aqui -->
                    </div>
                </div>
                
                <div class="dialog-buttons">
                    <button class="action-btn btn-warning" id="cancelLoadBtn">Fechar</button>
                    <button class="action-btn btn-secondary" id="newArticleBtn">
                        <i class="material-icons">add</i>
                        Novo Artigo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="material-icons" id="toastIcon">check_circle</i>
        <span id="toastMessage">Operação realizada com sucesso!</span>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0",
            authDomain: "wzzm-ce3fc.firebaseapp.com",
            projectId: "wzzm-ce3fc",
            storageBucket: "wzzm-ce3fc.appspot.com",
            messagingSenderId: "249427877153",
            appId: "1:249427877153:web:0e4297294794a5aadeb260",
            measurementId: "G-PLKNZNFCQ8"
        };

        // Inicializar Firebase
        let app;
        if (!firebase.apps.length) {
            app = firebase.initializeApp(firebaseConfig);
        } else {
            app = firebase.app();
        }
        
        const auth = firebase.auth();
        const firestore = firebase.firestore();

        // Elementos DOM
        const loginScreen = document.getElementById('loginScreen');
        const editorScreen = document.getElementById('editorScreen');
        const userInfo = document.getElementById('userInfo');
        const userEmail = document.getElementById('userEmail');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        
        const articleTitle = document.getElementById('articleTitle');
        const authorName = document.getElementById('authorName');
        const institution = document.getElementById('institution');
        const abstract = document.getElementById('abstract');
        const keywords = document.getElementById('keywords');
        const introduction = document.getElementById('introduction');
        const methodology = document.getElementById('methodology');
        const results = document.getElementById('results');
        const discussion = document.getElementById('discussion');
        const conclusion = document.getElementById('conclusion');
        const references = document.getElementById('references');
        
        const generateBtn = document.getElementById('generateBtn');
        const saveBtn = document.getElementById('saveBtn');
        const loadBtn = document.getElementById('loadBtn');
        const printBtn = document.getElementById('printBtn');
        const clearBtn = document.getElementById('clearBtn');
        const articlePreview = document.getElementById('articlePreview');
        
        // Diálogos
        const linkDialog = document.getElementById('linkDialog');
        const saveDialog = document.getElementById('saveDialog');
        const linkTextInput = document.getElementById('linkText');
        const linkUrlInput = document.getElementById('linkUrl');
        const insertLinkBtn = document.getElementById('insertLinkBtn');
        const cancelLinkBtn = document.getElementById('cancelLinkBtn');
        
        // Elementos do diálogo de salvar/carregar
        const saveForm = document.getElementById('saveForm');
        const loadForm = document.getElementById('loadForm');
        const dialogTitle = document.getElementById('dialogTitle');
        const dialogIcon = document.getElementById('dialogIcon');
        const saveArticleName = document.getElementById('saveArticleName');
        const articlesList = document.getElementById('articlesList');
        const cancelSaveBtn = document.getElementById('cancelSaveBtn');
        const confirmSaveBtn = document.getElementById('confirmSaveBtn');
        const cancelLoadBtn = document.getElementById('cancelLoadBtn');
        const newArticleBtn = document.getElementById('newArticleBtn');
        
        // Toast
        const toast = document.getElementById('toast');
        const toastIcon = document.getElementById('toastIcon');
        const toastMessage = document.getElementById('toastMessage');
        
        // Variáveis para controle
        let currentUser = null;
        let currentArticleId = null;
        let currentTextarea = null;
        
        // Contadores de palavras
        const wordCountElements = {
            abstract: document.getElementById('abstractCount'),
            introduction: document.getElementById('introCount'),
            methodology: document.getElementById('methodCount'),
            results: document.getElementById('resultsCount'),
            discussion: document.getElementById('discussionCount'),
            conclusion: document.getElementById('conclusionCount')
        };
        
        // Função para mostrar notificação
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            toastIcon.textContent = type === 'success' ? 'check_circle' : 
                                   type === 'error' ? 'error' : 'warning';
            
            toast.className = 'toast';
            toast.classList.add(type);
            
            toast.style.display = 'flex';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
        
        // Funções de formatação
        function clearFormatting(textareaId) {
            const textarea = document.getElementById(textareaId);
            let text = textarea.value;
            
            text = text.replace(/<[^>]*>/g, '');
            text = text.replace(/class="[^"]*"/g, '');
            
            textarea.value = text;
            updateWordCount(textareaId);
        }
        
        function updateWordCount(textareaId) {
            const textarea = document.getElementById(textareaId);
            const text = textarea.value.replace(/<[^>]*>/g, '');
            const wordCount = text.trim().split(/\s+/).filter(word => word.length > 0).length;
            
            if (wordCountElements[textareaId]) {
                wordCountElements[textareaId].textContent = `${wordCount} palavras`;
            }
        }
        
        // Event listeners para contadores de palavras
        abstract.addEventListener('input', () => updateWordCount('abstract'));
        introduction.addEventListener('input', () => updateWordCount('introduction'));
        methodology.addEventListener('input', () => updateWordCount('methodology'));
        results.addEventListener('input', () => updateWordCount('results'));
        discussion.addEventListener('input', () => updateWordCount('discussion'));
        conclusion.addEventListener('input', () => updateWordCount('conclusion'));
        
        // Sistema de formatação
        document.querySelectorAll('.format-btn').forEach(button => {
            button.addEventListener('click', function() {
                const format = this.getAttribute('data-format');
                const targetId = this.getAttribute('data-target');
                const textarea = document.getElementById(targetId);
                
                currentTextarea = textarea;
                
                const start = textarea.selectionStart;
                const end = textarea.selectionEnd;
                const selectedText = textarea.value.substring(start, end);
                
                let formattedText = '';
                
                switch(format) {
                    case 'bold':
                        formattedText = '<strong>' + selectedText + '</strong>';
                        insertFormattedText(textarea, start, end, formattedText);
                        break;
                        
                    case 'italic':
                        formattedText = '<em>' + selectedText + '</em>';
                        insertFormattedText(textarea, start, end, formattedText);
                        break;
                        
                    case 'underline':
                        formattedText = '<u>' + selectedText + '</u>';
                        insertFormattedText(textarea, start, end, formattedText);
                        break;
                        
                    case 'alignLeft':
                        formattedText = '<div class="text-left">' + selectedText + '</div>';
                        insertFormattedText(textarea, start, end, formattedText);
                        updateAlignButtons(this, targetId);
                        break;
                        
                    case 'alignCenter':
                        formattedText = '<div class="text-center">' + selectedText + '</div>';
                        insertFormattedText(textarea, start, end, formattedText);
                        updateAlignButtons(this, targetId);
                        break;
                        
                    case 'alignRight':
                        formattedText = '<div class="text-right">' + selectedText + '</div>';
                        insertFormattedText(textarea, start, end, formattedText);
                        updateAlignButtons(this, targetId);
                        break;
                        
                    case 'alignJustify':
                        formattedText = '<div class="text-justify">' + selectedText + '</div>';
                        insertFormattedText(textarea, start, end, formattedText);
                        updateAlignButtons(this, targetId);
                        break;
                        
                    case 'insertLink':
                        openLinkDialog(textarea, start, end, selectedText);
                        break;
                        
                    case 'clearFormat':
                        clearFormatting(targetId);
                        break;
                }
                
                updateWordCount(targetId);
            });
        });
        
        function insertFormattedText(textarea, start, end, formattedText) {
            const beforeText = textarea.value.substring(0, start);
            const afterText = textarea.value.substring(end);
            
            textarea.value = beforeText + formattedText + afterText;
            
            const newPosition = start + formattedText.length;
            textarea.setSelectionRange(newPosition, newPosition);
            textarea.focus();
        }
        
        function updateAlignButtons(clickedButton, targetId) {
            const toolsId = targetId + 'Tools';
            const formattingTools = document.getElementById(toolsId);
            
            if (formattingTools) {
                formattingTools.querySelectorAll('.format-btn[data-format^="align"]').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                clickedButton.classList.add('active');
            }
        }
        
        // Sistema de diálogo para links
        function openLinkDialog(textarea, start, end, selectedText) {
            linkTextInput.value = selectedText || 'Clique aqui';
            linkUrlInput.value = 'https://';
            
            linkDialog.style.display = 'flex';
            currentTextarea = textarea;
            
            currentTextarea.selectionStart = start;
            currentTextarea.selectionEnd = end;
            
            linkTextInput.focus();
        }
        
        insertLinkBtn.addEventListener('click', function() {
            const linkText = linkTextInput.value.trim();
            const linkUrl = linkUrlInput.value.trim();
            
            if (!linkText || !linkUrl) {
                showToast('Preencha ambos os campos: texto do link e URL.', 'error');
                return;
            }
            
            if (!linkUrl.startsWith('http://') && !linkUrl.startsWith('https://')) {
                showToast('Insira uma URL válida começando com http:// ou https://', 'error');
                return;
            }
            
            const linkHtml = `<a href="${linkUrl}" target="_blank">${linkText}</a>`;
            
            if (currentTextarea) {
                const start = currentTextarea.selectionStart;
                const end = currentTextarea.selectionEnd;
                insertFormattedText(currentTextarea, start, end, linkHtml);
                
                const targetId = currentTextarea.id;
                updateWordCount(targetId);
            }
            
            linkDialog.style.display = 'none';
            showToast('Link inserido com sucesso!');
        });
        
        cancelLinkBtn.addEventListener('click', function() {
            linkDialog.style.display = 'none';
        });
        
        linkDialog.addEventListener('click', function(e) {
            if (e.target === linkDialog) {
                linkDialog.style.display = 'none';
            }
        });
        
        // Gerar prévia do artigo
        generateBtn.addEventListener('click', function() {
            const referencesArray = references.value.split('\n').filter(ref => ref.trim() !== '');
            let referencesHtml = '';
            
            referencesArray.forEach(ref => {
                const urlRegex = /(https?:\/\/[^\s]+)/g;
                const refWithLinks = ref.replace(urlRegex, '<a href="$1" target="_blank">$1</a>');
                referencesHtml += `<div class="reference-item">${refWithLinks}</div>`;
            });
            
            const articleHTML = `
                <h1 class="preview-title">${articleTitle.value || 'Artigo sem título'}</h1>
                
                <div class="author-info">
                    <span class="authors-label">Autores:</span>
                    <div class="authors-list">
                        ${authorName.value ? authorName.value.split(',').map(author => 
                            `<span style="display: inline-block; margin-right: 10px;">${author.trim()}</span>`
                        ).join('') : 'Não especificado'}
                    </div>
                </div>
                
                <div class="author-info">
                    <span class="authors-label">Instituição:</span>
                    <div class="authors-list">${institution.value || 'Não especificada'}</div>
                </div>
                
                <div class="abstract-box">
                    <h3>RESUMO</h3>
                    <div class="article-body text-justify">
                        <p>${abstract.value || 'Resumo não fornecido.'}</p>
                    </div>
                    <div class="keywords">
                        <strong>Palavras-chave:</strong> ${keywords.value || 'palavra-chave1, palavra-chave2'}
                    </div>
                </div>
                
                <div class="content-section">
                    <h3>1. INTRODUÇÃO</h3>
                    <div class="article-body">
                        ${introduction.value || 'Introdução não fornecida.'}
                    </div>
                </div>
                
                <div class="content-section">
                    <h3>2. METODOLOGIA</h3>
                    <div class="article-body">
                        ${methodology.value || 'Metodologia não fornecida.'}
                    </div>
                </div>
                
                <div class="content-section">
                    <h3>3. RESULTADOS</h3>
                    <div class="article-body">
                        ${results.value || 'Resultados não fornecidos.'}
                    </div>
                </div>
                
                <div class="content-section">
                    <h3>4. DISCUSSÃO</h3>
                    <div class="article-body">
                        ${discussion.value || 'Discussão não fornecida.'}
                    </div>
                </div>
                
                <div class="content-section">
                    <h3>5. CONCLUSÃO</h3>
                    <div class="article-body">
                        ${conclusion.value || 'Conclusão não fornecida.'}
                    </div>
                </div>
                
                <div class="references-section">
                    <div class="references-label">REFERÊNCIAS BIBLIOGRÁFICAS</div>
                    <div class="references-list">
                        ${referencesHtml || '<p>Nenhuma referência adicionada.</p>'}
                    </div>
                </div>
                
                <div class="article-stats">
                    <div class="stats-item">
                        <i class="material-icons">update</i>
                        Gerado em: ${new Date().toLocaleDateString('pt-BR', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        })}
                    </div>
                    <div class="stats-item">
                        <i class="material-icons">text_fields</i>
                        Palavras: ${calculateTotalWords()}
                    </div>
                </div>
            `;
            
            articlePreview.innerHTML = articleHTML;
            articlePreview.classList.remove('empty-preview');
            showToast('Prévia gerada com sucesso!');
        });
        
        function calculateTotalWords() {
            const fields = [abstract, introduction, methodology, results, discussion, conclusion];
            let total = 0;
            
            fields.forEach(field => {
                const text = field.value.replace(/<[^>]*>/g, '');
                total += text.trim().split(/\s+/).filter(word => word.length > 0).length;
            });
            
            return total;
        }
        
        // Salvar artigo no Firebase
        async function saveArticleToFirebase(articleName) {
            try {
                if (!currentUser) {
                    showToast('Você precisa estar logado para salvar artigos.', 'error');
                    return false;
                }
                
                const articleData = {
                    title: articleTitle.value,
                    authors: authorName.value,
                    institution: institution.value,
                    abstract: abstract.value,
                    keywords: keywords.value,
                    introduction: introduction.value,
                    methodology: methodology.value,
                    results: results.value,
                    discussion: discussion.value,
                    conclusion: conclusion.value,
                    references: references.value,
                    
                    // Metadados
                    articleName: articleName,
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    visibility: document.querySelector('input[name="visibility"]:checked').value,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    wordCount: calculateTotalWords()
                };
                
                let savePromise;
                
                if (currentArticleId) {
                    // Atualizar artigo existente
                    savePromise = firestore.collection('testedeartigocientifico')
                        .doc(currentArticleId)
                        .update({
                            ...articleData,
                            updatedAt: new Date().toISOString()
                        });
                } else {
                    // Criar novo artigo
                    savePromise = firestore.collection('testedeartigocientifico')
                        .add(articleData)
                        .then(docRef => {
                            currentArticleId = docRef.id;
                            return docRef;
                        });
                }
                
                await savePromise;
                return true;
                
            } catch (error) {
                console.error('Erro ao salvar artigo:', error);
                showToast(`Erro ao salvar: ${error.message}`, 'error');
                return false;
            }
        }
        
        // Carregar artigo do Firebase
        async function loadArticleFromFirebase(articleId) {
            try {
                const doc = await firestore.collection('testedeartigocientifico')
                    .doc(articleId)
                    .get();
                
                if (!doc.exists) {
                    showToast('Artigo não encontrado.', 'error');
                    return false;
                }
                
                const articleData = doc.data();
                
                // Verificar se o usuário tem permissão
                if (articleData.userId !== currentUser.uid && articleData.visibility === 'private') {
                    showToast('Você não tem permissão para acessar este artigo.', 'error');
                    return false;
                }
                
                // Preencher os campos
                articleTitle.value = articleData.title || '';
                authorName.value = articleData.authors || '';
                institution.value = articleData.institution || '';
                abstract.value = articleData.abstract || '';
                keywords.value = articleData.keywords || '';
                introduction.value = articleData.introduction || '';
                methodology.value = articleData.methodology || '';
                results.value = articleData.results || '';
                discussion.value = articleData.discussion || '';
                conclusion.value = articleData.conclusion || '';
                references.value = articleData.references || '';
                
                currentArticleId = articleId;
                
                // Atualizar contadores
                updateWordCount('abstract');
                updateWordCount('introduction');
                updateWordCount('methodology');
                updateWordCount('results');
                updateWordCount('discussion');
                updateWordCount('conclusion');
                
                return true;
                
            } catch (error) {
                console.error('Erro ao carregar artigo:', error);
                showToast(`Erro ao carregar: ${error.message}`, 'error');
                return false;
            }
        }
        
        // Listar artigos do usuário
        async function loadUserArticles() {
            try {
                articlesList.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--light-text);"><i class="material-icons">hourglass_empty</i><p>Carregando artigos...</p></div>';
                
                const querySnapshot = await firestore.collection('testedeartigocientifico')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('updatedAt', 'desc')
                    .get();
                
                if (querySnapshot.empty) {
                    articlesList.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--light-text);"><i class="material-icons">note_add</i><p>Nenhum artigo salvo ainda.</p></div>';
                    return;
                }
                
                let articlesHtml = '';
                
                querySnapshot.forEach(doc => {
                    const article = doc.data();
                    const date = new Date(article.updatedAt).toLocaleDateString('pt-BR');
                    
                    articlesHtml += `
                        <div class="article-item" data-id="${doc.id}">
                            <div class="article-item-title">${article.articleName || 'Artigo sem nome'}</div>
                            <div class="article-item-meta">
                                <span><i class="material-icons" style="font-size: 14px;">update</i> ${date}</span>
                                <span><i class="material-icons" style="font-size: 14px;">text_fields</i> ${article.wordCount || 0} palavras</span>
                                <span><i class="material-icons" style="font-size: 14px;">visibility</i> ${article.visibility === 'public' ? 'Público' : 'Privado'}</span>
                            </div>
                            <div class="article-item-actions">
                                <button class="article-item-btn" style="background: var(--secondary-color); color: white;" onclick="handleLoadArticle('${doc.id}')">
                                    <i class="material-icons" style="font-size: 14px;">open_in_browser</i>
                                    Abrir
                                </button>
                                <button class="article-item-btn" style="background: var(--error-color); color: white;" onclick="handleDeleteArticle('${doc.id}', '${article.articleName}')">
                                    <i class="material-icons" style="font-size: 14px;">delete</i>
                                    Excluir
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                articlesList.innerHTML = articlesHtml;
                
            } catch (error) {
                console.error('Erro ao carregar artigos:', error);
                articlesList.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--error-color);"><i class="material-icons">error</i><p>Erro ao carregar artigos</p></div>';
            }
        }
        
        // Handlers para carregar/excluir artigos
        window.handleLoadArticle = async function(articleId) {
            const success = await loadArticleFromFirebase(articleId);
            if (success) {
                saveDialog.style.display = 'none';
                showToast('Artigo carregado com sucesso!');
                
                // Gerar prévia automaticamente
                setTimeout(() => {
                    generateBtn.click();
                }, 500);
            }
        };
        
        window.handleDeleteArticle = async function(articleId, articleName) {
            if (!confirm(`Tem certeza que deseja excluir o artigo "${articleName}"?`)) {
                return;
            }
            
            try {
                await firestore.collection('testedeartigocientifico').doc(articleId).delete();
                showToast('Artigo excluído com sucesso!');
                
                if (currentArticleId === articleId) {
                    currentArticleId = null;
                }
                
                loadUserArticles();
                
            } catch (error) {
                console.error('Erro ao excluir artigo:', error);
                showToast(`Erro ao excluir: ${error.message}`, 'error');
            }
        };
        
        // Abrir diálogo de salvar
        saveBtn.addEventListener('click', function() {
            if (!currentUser) {
                showToast('Faça login para salvar artigos.', 'error');
                return;
            }
            
            if (!articleTitle.value.trim()) {
                showToast('Digite um título para o artigo antes de salvar.', 'warning');
                return;
            }
            
            dialogTitle.textContent = currentArticleId ? 'Atualizar Artigo' : 'Salvar Artigo';
            dialogIcon.textContent = currentArticleId ? 'update' : 'save';
            
            // Preencher nome do artigo se não tiver
            if (!saveArticleName.value) {
                saveArticleName.value = articleTitle.value || `Artigo ${new Date().toLocaleDateString('pt-BR')}`;
            }
            
            saveForm.style.display = 'block';
            loadForm.style.display = 'none';
            saveDialog.style.display = 'flex';
            saveArticleName.focus();
        });
        
        // Abrir diálogo de carregar
        loadBtn.addEventListener('click', async function() {
            if (!currentUser) {
                showToast('Faça login para carregar artigos.', 'error');
                return;
            }
            
            dialogTitle.textContent = 'Meus Artigos';
            dialogIcon.textContent = 'folder_open';
            
            saveForm.style.display = 'none';
            loadForm.style.display = 'block';
            saveDialog.style.display = 'flex';
            
            await loadUserArticles();
        });
        
        // Confirmar salvamento
        confirmSaveBtn.addEventListener('click', async function() {
            const articleName = saveArticleName.value.trim();
            
            if (!articleName) {
                showToast('Digite um nome para o artigo.', 'error');
                return;
            }
            
            const success = await saveArticleToFirebase(articleName);
            
            if (success) {
                saveDialog.style.display = 'none';
                showToast(currentArticleId ? 'Artigo atualizado com sucesso!' : 'Artigo salvo com sucesso!');
            }
        });
        
        // Cancelar salvamento/carregamento
        cancelSaveBtn.addEventListener('click', function() {
            saveDialog.style.display = 'none';
        });
        
        cancelLoadBtn.addEventListener('click', function() {
            saveDialog.style.display = 'none';
        });
        
        // Novo artigo
        newArticleBtn.addEventListener('click', function() {
            saveDialog.style.display = 'none';
            clearBtn.click();
        });
        
        // Fechar diálogo ao clicar fora
        saveDialog.addEventListener('click', function(e) {
            if (e.target === saveDialog) {
                saveDialog.style.display = 'none';
            }
        });
        
        // Imprimir artigo
        printBtn.addEventListener('click', function() {
            if (articlePreview.classList.contains('empty-preview')) {
                showToast('Gere a prévia primeiro antes de imprimir.', 'warning');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>${articleTitle.value || 'Artigo Científico'}</title>
                        <style>
                            body { 
                                font-family: 'Times New Roman', Times, serif; 
                                line-height: 1.6; 
                                padding: 2cm; 
                                color: #333;
                            }
                            h1 { 
                                text-align: center; 
                                border-bottom: 3px double #000; 
                                padding-bottom: 15px;
                                font-size: 24px;
                            }
                            h2 { 
                                border-bottom: 1px solid #000; 
                                padding-bottom: 5px; 
                                margin-top: 30px;
                                font-size: 18px;
                            }
                            h3 {
                                font-size: 16px;
                                margin-top: 25px;
                            }
                            .abstract { 
                                background-color: #f5f5f5; 
                                padding: 15px; 
                                margin-bottom: 20px; 
                                border-left: 4px solid #4caf50;
                            }
                            .keywords { 
                                font-style: italic; 
                                margin: 15px 0; 
                                padding: 10px;
                                background-color: #f9f9f9;
                            }
                            .reference-item { 
                                margin-bottom: 8px; 
                                font-size: 14px;
                            }
                            .text-left { text-align: left !important; }
                            .text-center { text-align: center !important; }
                            .text-right { text-align: right !important; }
                            .text-justify { text-align: justify !important; }
                            @media print {
                                body { padding: 1.5cm; }
                                a { color: #000; text-decoration: underline; }
                            }
                        </style>
                    </head>
                    <body>
                        ${articlePreview.innerHTML}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
            }, 500);
        });
        
        // Limpar todos os campos
        clearBtn.addEventListener('click', function() {
            if (confirm('Tem certeza que deseja limpar todos os campos? As alterações não salvas serão perdidas.')) {
                articleTitle.value = '';
                authorName.value = '';
                institution.value = '';
                abstract.value = '';
                keywords.value = '';
                introduction.value = '';
                methodology.value = '';
                results.value = '';
                discussion.value = '';
                conclusion.value = '';
                references.value = '';
                
                // Resetar contadores
                Object.values(wordCountElements).forEach(el => {
                    el.textContent = '0 palavras';
                });
                
                // Resetar botões de alinhamento
                document.querySelectorAll('.format-btn.active').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Resetar prévia
                articlePreview.innerHTML = `
                    <i class="material-icons">edit_note</i>
                    <p>Preencha os campos ao lado</p>
                    <p class="hint">Clique em "Gerar Prévia" para ver o resultado aqui</p>
                `;
                articlePreview.classList.add('empty-preview');
                
                currentArticleId = null;
                saveArticleName.value = '';
                
                showToast('Campos limpos com sucesso!');
            }
        });
        
        // Sistema de autenticação
        loginBtn.addEventListener('click', async function() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('profile');
                provider.addScope('email');
                
                await auth.signInWithPopup(provider);
                
            } catch (error) {
                console.error('Erro no login:', error);
                showToast(`Erro no login: ${error.message}`, 'error');
            }
        });
        
        logoutBtn.addEventListener('click', async function() {
            try {
                await auth.signOut();
                showToast('Logout realizado com sucesso!');
            } catch (error) {
                console.error('Erro no logout:', error);
                showToast(`Erro no logout: ${error.message}`, 'error');
            }
        });
        
        // Monitorar estado de autenticação
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                // Usuário logado
                currentUser = user;
                userEmail.textContent = user.email;
                
                loginScreen.style.display = 'none';
                editorScreen.style.display = 'block';
                
                // Carregar dados de exemplo se for novo usuário
                if (!currentArticleId) {
                    loadExampleData();
                }
                
            } else {
                // Usuário não logado
                currentUser = null;
                currentArticleId = null;
                
                loginScreen.style.display = 'block';
                editorScreen.style.display = 'none';
            }
        });
        
        // Carregar dados de exemplo
        function loadExampleData() {
            articleTitle.value = '';
            authorName.value = 'Collei Grigory Ludwig';
            institution.value = 'wazzimagiygg.com';
            abstract.value = '';
            keywords.value = '';
            
            updateWordCount('abstract');
        }
        
        // Atalhos de teclado
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'b' && document.activeElement.type === 'textarea') {
                e.preventDefault();
                const textarea = document.activeElement;
                const formatBtn = document.querySelector(`.format-btn[data-format="bold"][data-target="${textarea.id}"]`);
                if (formatBtn) formatBtn.click();
            }
            
            if (e.ctrlKey && e.key === 'i' && document.activeElement.type === 'textarea') {
                e.preventDefault();
                const textarea = document.activeElement;
                const formatBtn = document.querySelector(`.format-btn[data-format="italic"][data-target="${textarea.id}"]`);
                if (formatBtn) formatBtn.click();
            }
            
            if (e.ctrlKey && e.key === 'l' && document.activeElement.type === 'textarea') {
                e.preventDefault();
                const textarea = document.activeElement;
                const formatBtn = document.querySelector(`.format-btn[data-format="insertLink"][data-target="${textarea.id}"]`);
                if (formatBtn) formatBtn.click();
            }
            
            if (e.ctrlKey && e.key === 's' && !e.shiftKey) {
                e.preventDefault();
                saveBtn.click();
            }
            
            if (e.ctrlKey && e.key === 'o' && !e.shiftKey) {
                e.preventDefault();
                loadBtn.click();
            }
        });
        
        // Voltar para página anterior
        function goBack() {
            if (confirm('Tem certeza que deseja sair? Todas as alterações não salvas serão perdidas.')) {
                window.history.back();
            }
        }
        
        // Inicializar quando a página carregar
        document.addEventListener('DOMContentLoaded', function() {
            // A verificação de autenticação já acontece no auth.onAuthStateChanged
            console.log('Editor de Artigo Científico carregado com Firebase.');
        });
    </script>
</body>
</html>
