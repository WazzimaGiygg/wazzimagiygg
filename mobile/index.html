<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wiki Zone Zero Mod - Mobile</title>
    <!-- Inclui Tailwind CSS para estilização e responsividade -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Material Design Lite (MDL) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <!-- Firebase SDKs (compat version para manter compatibilidade com seu código original) -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-analytics-compat.js"></script>

    <style>
        /* Estilos globais e de sobreposição para garantir a fonte Inter e arredondamento */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Cor de fundo suave */
            display: flex; /* Necessário para o layout MDL */
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
        }
        /* Garantir que elementos MDL também tenham bordas arredondadas e fonte Inter */
        .mdl-layout__drawer, .mdl-navigation__link, .mdl-card {
            border-radius: 0.5rem; /* Tailwind 'rounded-lg' */
        }
        .mdl-layout__header, .mdl-layout__drawer-button {
            border-radius: 0.5rem; /* Tailwind 'rounded-lg' */
        }
        .mdl-layout__drawer .mdl-navigation .mdl-navigation__link {
            font-family: 'Inter', sans-serif;
            color: #e0e0e0; /* Cor para links do drawer */
            transition: background-color 0.2s, color 0.2s;
        }
        .mdl-layout__drawer .mdl-navigation .mdl-navigation__link:hover {
            background-color: #4a5568; /* gray-700 */
            color: white;
        }
        .mdl-layout__drawer .mdl-navigation .mdl-navigation__link[data-requires-auth="true"] {
            color: #9e9e9e; /* Cor para links que requerem auth e estão desabilitados */
            pointer-events: none; /* Desabilita cliques */
        }

        /* Estilos para o acordeão */
        .accordion-item {
            margin-bottom: 0.75rem; /* mt-3 */
            border-radius: 0.5rem; /* rounded-lg */
            overflow: hidden; /* Garante que o conteúdo arredondado não vaze */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); /* shadow-md */
        }

        .accordion-header {
            background-color: #6366f1; /* indigo-500 */
            color: white;
            padding: 1rem 1.5rem; /* py-4 px-6 */
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600; /* font-semibold */
            border-radius: 0.5rem 0.5rem 0 0; /* rounded-t-lg */
        }

        .accordion-header.active {
            border-radius: 0.5rem 0.5rem 0 0; /* Permanece arredondado no topo */
        }

        .accordion-content {
            background-color: #ffffff; /* bg-white */
            padding: 1rem 1.5rem; /* p-6 */
            display: none; /* Escondido por padrão */
            border-radius: 0 0 0.5rem 0.5rem; /* rounded-b-lg */
            color: #374151; /* gray-700 */
            line-height: 1.6;
        }

        .accordion-content p {
            margin-bottom: 0.5rem;
        }

        /* Estilos para o login dinâmico */
        .login-container {
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            margin-top: 1.5rem;
        }
        .login-form input {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem; /* rounded-md */
        }
        .login-form button {
            width: 100%;
            padding: 0.75rem;
            background-color: #10b981; /* emerald-500 */
            color: white;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .login-form button:hover {
            background-color: #059669; /* emerald-600 */
        }
        .user-status {
            font-weight: 500;
            color: #4b5563;
            margin-top: 0.5rem;
        }

        /* Estilos para o popup de erro (do seu HTML original) */
        #error-log-popup {
            display: none;
            position: fixed;
            top: 60px;
            right: 30px;
            width: 400px;
            max-height: 60vh;
            overflow-y: auto;
            background: #fff;
            border: 2px solid #e53935;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 2000;
            padding: 16px;
        }
        #error-log-popup button {
            background: #e53935;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Estilos para o popup de apps */
        #google-apps-button {
            display: none; /* Controlado por JS */
        }
        #google-apps-popup {
            display: none;
            position: absolute;
            top: 48px; /* Altura do header */
            right: 0;
            width: 300px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            padding: 10px;
            box-sizing: border-box;
        }
        #google-apps-popup h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #3f51b5;
            text-align: center;
        }
        #app-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 10px;
        }
        .app-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .app-item:hover {
            background-color: #f0f0f0;
        }
        .app-item img {
            width: 48px;
            height: 48px;
            margin-bottom: 5px;
        }
        .app-item span {
            font-size: 0.8em;
            color: #555;
        }

        /* Mensagens de acesso/banimento */
        #access-denied-message, #banned-message {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #ffe0b2;
            border: 1px solid #ffb74d;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            text-align: center;
            color: #e65100;
            font-weight: bold;
            z-index: 1001;
        }

        /* Estilos para Notícias Popup */
        #news-button {
            margin-right: 8px;
            display: none; /* Controlado por JS */
        }
        #news-center-popup {
            display: none;
            position: absolute;
            top: 48px;
            right: 0;
            width: 300px; /* Ajustado para mobile */
            max-height: 80vh;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 998;
            flex-direction: column;
            overflow: hidden;
        }
        #news-popup-header {
            background-color: #3f51b5;
            color: white;
            padding: 10px 15px;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: bold;
            font-size: 16px;
        }
        #news-popup-header .close-button {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
        }
        #news-popup-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
        }
        .news-popup-item {
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 1px 1px 0 rgba(0,0,0,.08);
        }
        .news-popup-item h3 {
            margin-top: 0;
            color: #5c6bc0;
        }
        .news-popup-item p {
            color: #555;
            line-height: 1.5;
        }
        .news-popup-item small {
            font-size: 0.8em;
            color: #888;
            display: block;
            margin-top: 10px;
        }
        .news-popup-item img {
            max-width: 100%;
            height: auto;
            margin-top: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body class="mdl-demo mdl-base">
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-drawer">
        <!-- Cabeçalho -->
        <header class="mdl-layout__header bg-indigo-600 text-white shadow-md rounded-b-lg">
            <div class="mdl-layout__header-row flex justify-between items-center px-4 py-2">
                <span class="mdl-layout-title text-lg font-bold">Wiki Zone Zero Mod</span>
                <!-- Botões de Ação no Cabeçalho -->
                <nav class="mdl-navigation flex items-center">
                    <!-- Botão de Erros -->
                    <button class="mdl-button mdl-js-button mdl-button--icon text-white" id="error-log-button" title="Ver Erros">
                        <i class="material-icons">bug_report</i>
                    </button>
                    <!-- Botão de Notícias -->
                    <button class="mdl-button mdl-js-button mdl-button--icon text-white" id="news-button" style="display: none;">
                        <i class="material-icons">article</i>
                    </button>
                    <!-- Botão de Apps -->
                    <button class="mdl-button mdl-js-button mdl-button--icon text-white" id="google-apps-button" style="display: none;">
                        <i class="material-icons">widgets</i>
                    </button>
                    <!-- Info do Usuário / Botões de Login -->
                    <div id="user-info-container" class="flex items-center ml-2" style="display: none;">
                        <span id="user-info" class="text-white text-sm mr-2"></span>
                        <img id="user-profile-pic" src="" alt="Profile Pic" class="w-8 h-8 rounded-full hidden">
                        <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored bg-red-500 hover:bg-red-600 text-white rounded-md shadow-md ml-2" id="logout-button" style="display: none;">Sair</button>
                    </div>
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored bg-blue-500 hover:bg-blue-600 text-white rounded-md shadow-md ml-2" id="login-google">Login Google</button>
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored bg-gray-700 hover:bg-gray-800 text-white rounded-md shadow-md ml-2" id="login-github">Login GitHub</button>
                </nav>
            </div>
        </header>

        <!-- Menu Lateral (Drawer) -->
        <div class="mdl-layout__drawer bg-gray-800 text-white p-4 rounded-r-lg">
            <span class="mdl-layout-title text-xl font-semibold mb-4 block">Navegação</span>
            <nav class="mdl-navigation" id="drawer-menu">
                <!-- Itens de menu serão carregados aqui via JS -->
            </nav>
        </div>

        <!-- Conteúdo Principal -->
        <main class="mdl-layout__content p-4 sm:p-6 lg:p-8 flex-grow">
            <div class="page-content max-w-4xl mx-auto w-full">
                <!-- Área para o formulário de login dinâmico (no lugar das janelas) -->
                <div id="login-section" class="login-container hidden">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Acesso ao Wiki</h2>
                    <form id="login-form" class="login-form">
                        <input type="email" id="email" placeholder="Seu e-mail" required class="focus:ring-indigo-500 focus:border-indigo-500">
                        <input type="password" id="password" placeholder="Sua senha" required class="focus:ring-indigo-500 focus:border-indigo-500">
                        <button type="submit">Entrar</button>
                    </form>
                    <p id="user-status" class="user-status text-center mt-4"></p>
                </div>

                <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-6 mt-4">Tópicos do Wiki</h1>

                <!-- Seção de Acordeão para Conteúdo -->
                <div id="accordion-container">
                    <!-- Itens do acordeão serão gerados aqui -->
                </div>

                <!-- Conteúdo de página carregado dinamicamente (para simular o loadPage) -->
                <div id="dynamic-page-content" class="mt-8 p-6 bg-white rounded-lg shadow-md hidden">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Conteúdo da Página Carregada</h2>
                    <p>Este é um espaço para o conteúdo que seria carregado dinamicamente, como as páginas individuais do seu wiki.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Popups e Mensagens (Mantidos e estilizados com Tailwind) -->
    <div id="google-apps-popup" class="absolute bg-white rounded-lg shadow-lg p-4 right-4 top-16 z-10 hidden">
        <h4 class="text-center text-indigo-700 font-semibold mb-3">Serviços WZZM</h4>
        <div id="app-grid" class="grid grid-cols-3 gap-3"></div>
    </div>

    <div id="news-center-popup" class="absolute bg-white rounded-lg shadow-lg right-4 top-16 z-10 hidden flex-col">
        <div id="news-popup-header" class="bg-indigo-600 text-white p-3 rounded-t-lg flex justify-between items-center">
            <span class="font-bold">Últimas Notícias</span>
            <button class="close-button text-white text-xl" id="close-news-popup-button">×</button>
        </div>
        <div id="news-popup-content" class="p-4 overflow-y-auto max-h-64">
            <p>Carregando últimas notícias...</p>
        </div>
        <div class="p-3 border-t border-gray-200 text-center">
            <button id="view-all-news-button" class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent w-full bg-pink-500 hover:bg-pink-600 text-white rounded-md">
                Ver todas as Notícias
            </button>
        </div>
    </div>

    <div id="error-log-popup" class="fixed top-16 right-4 w-96 max-h-96 overflow-y-auto bg-white border-2 border-red-500 rounded-lg shadow-xl z-20 hidden p-4">
        <div class="flex justify-between items-center mb-3">
            <span class="font-bold text-red-600">Erros do Console</span>
            <button onclick="document.getElementById('error-log-popup').style.display='none'" class="bg-none border-none text-red-600 text-xl cursor-pointer">×</button>
        </div>
        <ul id="error-log-list" class="mt-3 text-red-800 text-sm list-disc pl-5"></ul>
    </div>

    <div id="access-denied-message" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-orange-100 border border-orange-400 p-5 rounded-lg shadow-lg text-center text-orange-700 font-bold z-30 hidden">
        <p>Acesso negado. Por favor, faça login para ver este conteúdo.</p>
    </div>

    <div id="banned-message" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-red-100 border border-red-400 p-5 rounded-lg shadow-lg text-center text-red-700 font-bold z-30 hidden">
        <p>Sua conta foi banida. Você não pode acessar o conteúdo.</p>
        <p>Para mais informações, contate o suporte.</p>
    </div>

    <script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script>
        // Variáveis globais para simular o ambiente Canvas
        const __app_id = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const __firebase_config = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "YOUR_API_KEY", // Substitua pela sua chave REAL do Firebase
            authDomain: "your-project-id.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID",
            measurementId: "YOUR_MEASUREMENT_ID"
        };
        const __initial_auth_token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : undefined;

        // Inicialize Firebase
        const app = firebase.initializeApp(__firebase_config);
        const auth = firebase.auth();
        const firestore = firebase.firestore();
        firebase.analytics();

        // Variáveis globais para estado do usuário
        let currentUser = null;
        let isCurrentUserBanned = false;

        // Mock de dados do menu para simular menu.json
        // Você deve ter um arquivo menu.json real no seu servidor
        const mockMenuData = [
            { label: 'Início', href: 'home.html', requiresAuth: false },
            { label: 'Personagens', href: 'characters.html', requiresAuth: false },
            { label: 'Armas', href: 'weapons.html', requiresAuth: false },
            { label: 'Missões (Auth)', href: 'missions.html', requiresAuth: true },
            { label: 'Configurações (Auth)', href: 'settings.html', requiresAuth: true },
            { label: 'Políticas Gerais', href: 'POLÍTICAS GERAIS DO WIKI ZONE ZERO MOD.pdf', requiresAuth: false }
        ];

        // Mock de dados para o conteúdo do acordeão (agora com IDs e conteúdo mais detalhado)
        const accordionContentData = [
            {
                id: 'intro-wiki',
                title: 'Introdução ao Wiki',
                content: `
                    <p>Bem-vindo ao Wiki Zone Zero Mod, o seu guia definitivo para o universo de <strong>Zenless Zone Zero</strong>! Este wiki é uma comunidade dedicada a coletar, organizar e compartilhar informações sobre tudo o que envolve o jogo: desde os intrincados detalhes da lore e dos personagens, até as estratégias de combate mais eficazes e os segredos escondidos em cada canto de New Eridu. Nosso objetivo é ser a fonte mais completa e confiável para jogadores de todos os níveis, ajudando-os a desvendar os mistérios dos Hollows e a dominar cada Proxy.</p>
                    <p>Aqui você encontrará perfis detalhados de todos os agentes jogáveis, descrições de suas habilidades, equipamentos recomendados e dicas para maximizar seu potencial em batalha. Explore as seções dedicadas às facções, aos inimigos que você enfrentará, e aos diversos tipos de armas e modificadores que podem virar o jogo a seu favor. Mergulhe na rica narrativa do jogo, compreendendo as motivações dos personagens e os eventos que moldaram este mundo pós-apocalíptico vibrante e perigoso.</p>
                    <p>Este wiki está em constante evolução, com novas informações sendo adicionadas regularmente pela nossa comunidade apaixonada. Convidamos você a contribuir com seu conhecimento, seja corrigindo informações, adicionando novos dados ou expandindo artigos existentes. Juntos, podemos construir o recurso mais abrangente para todos os fãs de Zenless Zone Zero!</p>
                `
            },
            {
                id: 'main-characters',
                title: 'Personagens Principais',
                content: `
                    <p>Os personagens de Zenless Zone Zero são a espinha dorsal da sua equipe, cada um com um estilo de combate único, habilidades especiais e uma personalidade cativante. Conhecer a fundo cada um deles é crucial para montar a equipe perfeita e superar os desafios mais difíceis nos Hollows.</p>
                    <h4 class="font-semibold mt-4 mb-2">Principais Agentes e suas Funções:</h4>
                    <ul class="list-disc pl-5">
                        <li><strong>Nicole Demara (Cunning Hares):</strong> Uma líder carismática e estrategista, Nicole se destaca em combate de médio alcance com suas habilidades de suporte e controle de grupo. Ideal para iniciar combos e proteger aliados.</li>
                        <li><strong>Billy Kid (Cunning Hares):</strong> O atirador de elite da equipe, Billy é especialista em causar dano massivo a um único alvo a longa distância. Sua precisão é incomparável, tornando-o essencial contra chefes e inimigos de alta prioridade.</li>
                        <li><strong>Corin Wickes (Victoria Housekeeping):</strong> Uma combatente corpo a corpo robusta, Corin é a linha de frente perfeita. Sua alta defesa e habilidades de contra-ataque a tornam uma parede impenetrável, absorvendo dano e protegendo seus companheiros.</li>
                        <li><strong>Anby Demara (Cunning Hares):</strong> Ágil e rápida, Anby é uma especialista em combate rápido e desorientação de inimigos. Suas habilidades de movimento e ataques consecutivos a tornam ideal para flanquear e eliminar alvos prioritários rapidamente.</li>
                        <li><strong>Ben Bigger (Victoria Housekeeping):</strong> Um urso polar com uma serra elétrica, Ben é puro poder bruto. Ele se destaca em combate de área, limpando grupos de inimigos com ataques devastadores. Perfeito para situações de controle de multidão.</li>
                    </ul>
                    <p class="mt-4">Cada personagem possui um conjunto de habilidades ativas e passivas, além de um sistema de "Builds" que permite personalizar seus equipamentos (Discos de Áudio e Decoders) para otimizar seu desempenho. Experimente diferentes combinações para descobrir sinergias poderosas!</p>
                `
            },
            {
                id: 'weapon-types',
                title: 'Tipos de Armas',
                content: `
                    <p>O arsenal em Zenless Zone Zero é tão diversificado quanto os perigos de New Eridu. Cada tipo de arma oferece uma abordagem tática diferente e se encaixa melhor com certos personagens e estilos de jogo. Dominar a variedade de armamentos é crucial para adaptar-se a qualquer situação de combate.</p>
                    <h4 class="font-semibold mt-4 mb-2">Categorias de Armas:</h4>
                    <ul class="list-disc pl-5">
                        <li><strong>Armas Brancas (Melee):</strong> Incluem espadas, lâminas, machados e garras. São ideais para combate corpo a corpo, permitindo combos rápidos e dano contínuo. Personagens ágeis e tanques geralmente se beneficiam mais dessas armas.</li>
                        <li><strong>Armas de Fogo (Ranged):</strong> Pistolas, submetralhadoras, rifles e espingardas compõem esta categoria. Oferecem a capacidade de atacar inimigos à distância, mantendo uma posição segura. Essenciais para personagens de suporte de dano e atiradores.</li>
                        <li><strong>Armas Pesadas (Heavy):</strong> Lança-mísseis, martelos gigantes e serras elétricas (como a de Ben) são exemplos. Essas armas causam dano massivo em área ou a alvos únicos, mas geralmente têm uma velocidade de ataque mais lenta. Perfeitas para limpar grupos de inimigos ou quebrar a guarda de chefes.</li>
                        <li><strong>Armas Elementais/Especiais:</strong> Algumas armas possuem afinidade elemental ou mecânicas únicas que as diferenciam. Elas podem aplicar status negativos aos inimigos ou oferecer bônus de dano específicos, adicionando uma camada extra de estratégia ao combate.</li>
                    </ul>
                    <p class="mt-4">Além do tipo, cada arma possui atributos base, bônus de estatísticas e, mais importante, "Sub-stats" que podem ser aprimorados. A combinação certa de arma e personagem pode desbloquear um potencial de dano surpreendente.</p>
                `
            },
            {
                id: 'missions-events',
                title: 'Missões e Eventos',
                content: `
                    <p>Em Zenless Zone Zero, as missões e eventos são a principal forma de progredir na história, obter recursos valiosos e testar suas habilidades em combate. Existem diversos tipos de atividades, cada uma com seus próprios desafios e recompensas.</p>
                    <h4 class="font-semibold mt-4 mb-2">Tipos de Missões:</h4>
                    <ul class="list-disc pl-5">
                        <li><strong>Missões da História Principal:</strong> Avançam a narrativa do jogo, revelando mais sobre o mundo de New Eridu, os Hollows e os personagens. São essenciais para desbloquear novas áreas e funcionalidades.</li>
                        <li><strong>Missões Secundárias:</strong> Oferecem histórias adicionais e aprofundam o lore de personagens específicos ou de facções. Geralmente recompensam com itens de aprimoramento e moedas.</li>
                        <li><strong>Missões de Desafio (Hollows):</strong> Expedições aos Hollows, onde você enfrenta ondas de inimigos, chefes e desafios ambientais. São a principal fonte de materiais para aprimorar personagens e equipamentos.</li>
                        <li><strong>Missões Diárias/Semanais:</strong> Tarefas rotineiras que fornecem pequenas quantidades de recursos e experiência, incentivando o engajamento diário.</li>
                    </ul>
                    <h4 class="font-semibold mt-4 mb-2">Eventos Especiais:</h4>
                    <p>Periodicamente, o jogo apresenta eventos por tempo limitado com mecânicas únicas, inimigos especiais e recompensas exclusivas. Participar desses eventos é crucial para obter itens raros, skins e moedas premium. Fique atento aos anúncios no jogo para não perder nenhum!</p>
                    <p class="mt-4">Preparar sua equipe adequadamente para cada tipo de missão é a chave para o sucesso. Analise os tipos de inimigos, os elementos recomendados e as condições de vitória antes de mergulhar na ação.</p>
                `
            },
            {
                id: 'advanced-tips',
                title: 'Dicas e Truques Avançados',
                content: `
                    <p>Para se destacar em Zenless Zone Zero e dominar os desafios mais complexos, é preciso ir além do básico. Aqui estão algumas dicas e truques avançados que podem elevar seu gameplay a um novo nível:</p>
                    <h4 class="font-semibold mt-4 mb-2">Estratégias de Combate:</h4>
                    <ul class="list-disc pl-5">
                        <li><strong>Gerenciamento de Energia:</strong> Cada personagem tem uma barra de energia que alimenta suas habilidades. Aprenda a usar ataques básicos para gerar energia rapidamente e desferir habilidades poderosas nos momentos certos.</li>
                        <li><strong>Quebra de Postura (Stagger/Break):</strong> Inimigos e chefes possuem uma barra de postura. Ataques específicos ou combos podem quebrar essa postura, deixando-os vulneráveis a ataques massivos. Foque em personagens que se destacam nisso.</li>
                        <li><strong>Troca Rápida de Personagens:</strong> A troca instantânea entre personagens não é apenas para evitar dano, mas também para encadear habilidades e combos. Pratique transições suaves para maximizar seu DPS (dano por segundo).</li>
                        <li><strong>Posicionamento:</strong> Em ambientes com muitos inimigos ou chefes com ataques de área, o posicionamento é vital. Use o ambiente a seu favor para evitar ataques e flanquear inimigos.</li>
                    </ul>
                    <h4 class="font-semibold mt-4 mb-2">Otimização de Builds:</h4>
                    <ul class="list-disc pl-5">
                        <li><strong>Sinergia de Elementos:</strong> Monte equipes com elementos complementares para explorar as fraquezas dos inimigos.</li>
                        <li><strong>Decoders e Discos de Áudio:</strong> Não se limite a equipar os itens de maior raridade. Entenda as sub-estatísticas e os bônus de conjunto. Às vezes, um item de menor raridade com as sub-estatísticas certas pode ser mais eficaz.</li>
                        <li><strong>Priorize os Aprimoramentos:</strong> Concentre seus recursos nos personagens e armas que você mais usa. Aprimorar um personagem ao máximo é mais eficaz do que espalhar recursos por muitos personagens medianos.</li>
                    </ul>
                    <p class="mt-4">A prática leva à perfeição. Experimente diferentes composições de equipe, estilos de jogo e builds para encontrar o que melhor se adapta ao seu estilo e aos desafios que você enfrenta.</p>
                `
            }
        ];

        // Função para ativar/desativar links de navegação com base no status de login
        function setNavLinksEnabled(enabled) {
            const navLinks = document.querySelectorAll('.mdl-navigation__link[data-requires-auth="true"]');
            navLinks.forEach(link => {
                if (enabled) {
                    link.style.pointerEvents = 'auto';
                    link.style.color = '#e0e0e0'; /* Cor padrão para links habilitados no drawer */
                } else {
                    link.style.pointerEvents = 'none';
                    link.style.color = '#9e9e9e'; /* Cor para links desabilitados */
                }
            });
        }

        // Função para criar/atualizar o documento do perfil do usuário no Firestore
        async function createUserProfileDocument(user) {
            if (!user) return;
            const userRef = firestore.doc(`users/${user.uid}`);
            const snapshot = await userRef.get();

            if (!snapshot.exists) {
                const { displayName, email, photoURL } = user;
                const createdAt = new Date();

                try {
                    await userRef.set({
                        displayName,
                        email,
                        photoURL,
                        createdAt,
                        isAdmin: false,
                        isBan: false
                    });
                    console.log("Perfil do usuário criado no Firestore.");
                } catch (error) {
                    console.error("Erro ao criar perfil do usuário:", error);
                }
            }
        }

        // Função para carregar e aplicar CSS de aplicativos específicos do usuário (mantida, mas sem custom-app-css tag no mobile)
        async function loadAndApplyUserAppsCSS(userId) {
            // No mobile, não estamos injetando CSS dinâmico diretamente para simplificar.
            // Esta função pode ser adaptada para outras finalidades ou removida se não for usada.
            console.log("loadAndApplyUserAppsCSS chamado no mobile, mas não implementado para injeção de CSS.");
        }

        // --- FUNÇÕES PARA O POPUP DE NOTÍCIAS ---
        function showNewsPopup() {
            const newsCenterPopup = document.getElementById('news-center-popup');
            if (newsCenterPopup) {
                newsCenterPopup.style.display = 'flex';
                fetchLatestNews(); // Busca notícias ao abrir o popup
            }
        }

        function hideNewsPopup() {
            const newsCenterPopup = document.getElementById('news-center-popup');
            if (newsCenterPopup) {
                newsCenterPopup.style.display = 'none';
            }
        }

        // Função para buscar as últimas notícias e exibi-las no popup
        async function fetchLatestNews() {
            const newsPopupContent = document.getElementById('news-popup-content');
            newsPopupContent.innerHTML = '<p>Carregando últimas notícias...</p>';
            try {
                const newsSnapshot = await firestore.collection('news')
                    .orderBy('createdAt', 'desc')
                    .limit(5) // Limita a 5 notícias para o popup
                    .get();
                if (newsSnapshot.empty) {
                    newsPopupContent.innerHTML = '<p>Nenhuma notícia encontrada.</p>';
                    return;
                }

                newsPopupContent.innerHTML = '';
                newsSnapshot.forEach(doc => {
                    const news = doc.data();
                    const newsItem = document.createElement('div');
                    newsItem.classList.add('news-popup-item');

                    const timestampDate = news.createdAt ? news.createdAt.toDate() : new Date();
                    const timeString = timestampDate.toLocaleString([], {
                        year: 'numeric', month: 'numeric', day: 'numeric',
                        hour: '2-digit', minute: '2-digit'
                    });

                    newsItem.innerHTML = `
                        <h3>${news.title}</h3>
                        <p>${news.description}</p>
                        <small>Categoria: ${news.category}</small><br> ${news.tags && news.tags.length > 0 ? `<small>Tags: ${news.tags.join(', ')}</small><br>` : ''}
                        <small>Publicado em: ${timeString}</small>
                        ${news.imageUrl ? `<img src="${news.imageUrl}" alt="Imagem da Notícia">` : ''} `;
                    newsPopupContent.appendChild(newsItem);
                });

            } catch (error) {
                console.error("Erro ao buscar últimas notícias para o popup:", error);
                newsPopupContent.innerHTML = `<p style="color: red;">Erro ao carregar notícias: ${error.message}</p>`;
            }
        }

        // --- Funções de Autenticação ---
        const providerGoogle = new firebase.auth.GoogleAuthProvider();
        const providerGitHub = new firebase.auth.GithubAuthProvider();

        document.getElementById('login-google').addEventListener('click', () => {
            auth.signInWithPopup(providerGoogle)
                .catch(error => {
                    console.error("Erro no login com Google:", error);
                });
        });
        document.getElementById('login-github').addEventListener('click', () => {
            auth.signInWithPopup(providerGitHub)
                .catch(error => {
                    console.error("Erro no login com GitHub:", error);
                });
        });
        function handleLogout() {
            auth.signOut().then(() => {
                console.log("Usuário deslogado.");
            }).catch((error) => {
                console.error("Erro ao deslogar:", error);
            });
        }
        const logoutButton = document.getElementById('logout-button');
        if (logoutButton) {
            logoutButton.addEventListener('click', handleLogout);
        }

        // --- Gerenciamento de Estado de Autenticação ---
        auth.onAuthStateChanged(async (user) => {
            currentUser = user; // Define o currentUser globalmente
            const userInfo = document.getElementById('user-info');
            const loginGoogleButton = document.getElementById('login-google');
            const loginGitHubButton = document.getElementById('login-github');
            const logoutButton = document.getElementById('logout-button');
            const userProfilePic = document.getElementById('user-profile-pic');
            const googleAppsButton = document.getElementById('google-apps-button');
            const userInfoContainer = document.getElementById('user-info-container');
            const googleAppsPopup = document.getElementById('google-apps-popup');
            const accessDeniedMessage = document.getElementById('access-denied-message');
            const bannedMessage = document.getElementById('banned-message');
            const newsButton = document.getElementById('news-button');
            const newsCenterPopup = document.getElementById('news-center-popup');

            // Lógica para o botão de login/logout dinâmico no cabeçalho
            const headerLoginToggleButton = document.getElementById('loginToggleButton');
            const loginSection = document.getElementById('login-section');
            const userStatusElement = document.getElementById('user-status');

            if (user) {
                if (userInfo) userInfo.textContent = `Olá, ${user.displayName || user.email}!`;
                if (loginGoogleButton) loginGoogleButton.style.display = 'none';
                if (loginGitHubButton) loginGitHubButton.style.display = 'none';
                if (user.photoURL) {
                    if (userProfilePic) {
                        userProfilePic.src = user.photoURL;
                        userProfilePic.style.display = 'inline-block';
                    }
                } else {
                    if (userProfilePic) userProfilePic.style.display = 'none';
                }
                if (googleAppsButton) googleAppsButton.style.display = 'inline-block';
                if (userInfoContainer) userInfoContainer.style.display = 'flex';
                if (logoutButton) logoutButton.style.display = 'inline-block';

                headerLoginToggleButton.textContent = 'Logout';
                userStatusElement.textContent = `Bem-vindo, ${user.email}!`;


                await createUserProfileDocument(user);

                let isUserBanned = false;
                try {
                    const userProfileRef = firestore.collection('users').doc(user.uid);
                    const doc = await userProfileRef.get();

                    if (doc.exists && doc.data()) {
                        isUserBanned = doc.data().isBan || false;
                    }
                } catch (error) {
                    console.error("Erro ao verificar perfil de usuário ou status de banimento:", error);
                    isUserBanned = false;
                }

                isCurrentUserBanned = isUserBanned;
                if (isUserBanned) {
                    console.warn(`Usuário ${user.uid} está banido.`);
                    setNavLinksEnabled(false);
                    if (logoutButton) {
                        logoutButton.style.display = 'none';
                        logoutButton.removeEventListener('click', handleLogout);
                    }
                    if (bannedMessage) bannedMessage.style.display = 'block';
                    if (accessDeniedMessage) accessDeniedMessage.style.display = 'none';

                    if (googleAppsButton) {
                        googleAppsButton.style.pointerEvents = 'none';
                        googleAppsButton.style.opacity = '0.6';
                    }
                    if (googleAppsPopup) googleAppsPopup.style.display = 'none';
                    if (newsButton) newsButton.style.display = 'none';
                    if (newsCenterPopup) newsCenterPopup.style.display = 'none';

                    // Esconde a seção de login se o usuário for banido
                    loginSection.classList.add('hidden');
                } else { // User is not banned
                    setNavLinksEnabled(true); // Habilita todos os links se não banido
                    if (bannedMessage) bannedMessage.style.display = 'none';
                    if (accessDeniedMessage) accessDeniedMessage.style.display = 'none';

                    if (googleAppsButton) {
                        googleAppsButton.style.pointerEvents = 'auto';
                        googleAppsButton.style.opacity = '1';
                    }
                    if (newsButton) newsButton.style.display = 'inline-block';

                    await loadAndApplyUserAppsCSS(user.uid);
                    // Garante que o formulário de login esteja escondido após o login bem-sucedido
                    loginSection.classList.add('hidden');
                }

            } else { // Usuário deslogado
                currentUser = null;
                if (userInfo) userInfo.textContent = '';
                if (loginGoogleButton) loginGoogleButton.style.display = 'inline-block';
                if (loginGitHubButton) loginGitHubButton.style.display = 'inline-block';
                if (logoutButton) logoutButton.style.display = 'none';
                isCurrentUserBanned = false;
                if (bannedMessage) bannedMessage.style.display = 'none';
                setNavLinksEnabled(false);

                if (userProfilePic) {
                    userProfilePic.style.display = 'none';
                    userProfilePic.src = '';
                }
                if (googleAppsButton) googleAppsButton.style.display = 'none';
                if (userInfoContainer) userInfoContainer.style.display = 'none';
                if (googleAppsPopup) googleAppsPopup.style.display = 'none';
                if (newsButton) newsButton.style.display = 'none';
                if (newsCenterPopup) newsCenterPopup.style.display = 'none';
                hideNewsPopup();

                headerLoginToggleButton.textContent = 'Login';
                userStatusElement.textContent = 'Nenhum usuário logado.';
                // Garante que o formulário de login esteja visível se o usuário deslogar
                loginSection.classList.remove('hidden');
            }
            if (componentHandler) {
                componentHandler.upgradeDom();
            }
        });

        // --- Event Listeners DOMContentLoaded ---
        document.addEventListener('DOMContentLoaded', () => {
            const googleAppsButton = document.getElementById('google-apps-button');
            const googleAppsPopup = document.getElementById('google-apps-popup');
            const navLinks = document.querySelectorAll('.mdl-navigation__link');
            const newsButton = document.getElementById('news-button');
            const newsCenterPopup = document.getElementById('news-center-popup');
            const closeNewsPopupButton = document.getElementById('close-news-popup-button');
            const viewAllNewsButton = document.getElementById('view-all-news-button');
            const loginSection = document.getElementById('login-section'); // Referência à seção de login
            const dynamicContentDiv = document.getElementById('dynamic-page-content'); // Referência ao conteúdo dinâmico

            // --- Lógica do Botão de Login/Logout no Cabeçalho ---
            document.getElementById('loginToggleButton').addEventListener('click', () => {
                if (currentUser) {
                    // Se o usuário está logado, o clique no botão é para fazer logout
                    handleLogout();
                    // Após o logout, a seção de login será mostrada pelo onAuthStateChanged
                } else {
                    // Se o usuário não está logado, o clique no botão é para mostrar o formulário de login
                    loginSection.classList.toggle('hidden');
                    // Esconde o conteúdo dinâmico se o formulário de login for exibido
                    if (!loginSection.classList.contains('hidden')) {
                        dynamicContentDiv.classList.add('hidden');
                    }
                }
            });

            // Simulação de login (formulário)
            document.getElementById('login-form').addEventListener('submit', (event) => {
                event.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                if (email === 'test@example.com' && password === 'password123') {
                    // Simula login bem-sucedido
                    currentUser = { email: email, displayName: 'Usuário Teste' };
                    document.getElementById('user-status').textContent = 'Login bem-sucedido!';
                    setTimeout(() => {
                        loginSection.classList.add('hidden'); // Esconde o formulário
                        updateLoginStatus(); // Atualiza o status e o menu
                    }, 1000);
                } else {
                    document.getElementById('user-status').textContent = 'Credenciais inválidas.';
                }
            });


            // Botão Google Apps
            if (googleAppsButton) {
                googleAppsButton.addEventListener('click', (event) => {
                    event.stopPropagation();
                    if (googleAppsPopup.style.display === 'block') {
                        googleAppsPopup.style.display = 'none';
                    } else {
                        googleAppsPopup.style.display = 'block';
                        const appGrid = document.getElementById('app-grid');
                        appGrid.innerHTML = '';

                        const wzzmServices = [
                            { name: 'Office WZZM', url: 'https://office.wzzm.org', iconUrl: 'https://wzzm.org/iconmagic.png' },
                            { name: 'Escolar WZZM', url: 'https://escolar.wzzm.org', iconUrl: 'https://wzzm.org/iconmagic.png' },
                            { name: 'Minha Persona WZZM', url: 'https://minhapersona.wzzm.org', iconUrl: 'https://wzzm.org/iconmagic.png' },
                            { name: 'Wiki Zero', url: 'https://wikizero.wzzm.org/', iconUrl: 'https://wzzm.org/iconmagic.png' },
                            { name: 'UWG Wikidot', url: 'https://uwg.wikidot.com', iconUrl: 'https://uwg.wikidot.com/favicon.ico' },
                            { name: 'Wiki Metro SP', url: 'https://wikimetrosp.miraheze.org', iconUrl: 'https://wikimetrosp.miraheze.org/favicon.ico' }
                        ];
                        wzzmServices.forEach(app => {
                            const appItem = document.createElement('div');
                            appItem.classList.add('app-item');
                            appItem.innerHTML = `<img src="${app.iconUrl}" onerror="this.onerror=null;this.src='https://placehold.co/48x48/cccccc/ffffff?text=App';" alt="${app.name}"> <span>${app.name}</span>`;
                            appItem.addEventListener('click', () => {
                                window.open(app.url, '_blank');
                                googleAppsPopup.style.display = 'none';
                            });
                            appGrid.appendChild(appItem);
                        });
                    }
                });
            }

            // Event Listeners for News Button and Popup
            if (newsButton) {
                newsButton.addEventListener('click', (event) => {
                    event.stopPropagation();
                    if (newsCenterPopup.style.display === 'flex') {
                        hideNewsPopup();
                    } else {
                        showNewsPopup();
                    }
                });
            }

            if (closeNewsPopupButton) {
                closeNewsPopupButton.addEventListener('click', () => {
                    hideNewsPopup();
                });
            }

            if (viewAllNewsButton) {
                viewAllNewsButton.addEventListener('click', () => {
                    // Para mobile, podemos carregar notícias em um acordeão ou nova seção
                    // Por simplicidade, vamos injetar aqui ou redirecionar para uma página de notícias se existir
                    dynamicContentDiv.innerHTML = `
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Todas as Notícias</h2>
                        <p>Conteúdo completo das notícias seria carregado aqui.</p>
                        <!-- Aqui você pode adicionar um loop para todas as notícias ou carregar de um arquivo -->
                    `;
                    dynamicContentDiv.classList.remove('hidden');
                    hideNewsPopup();
                });
            }

            // Listener global para fechar popups ao clicar fora
            document.addEventListener('click', (event) => {
                if (googleAppsPopup && googleAppsPopup.style.display === 'block' &&
                    !googleAppsButton.contains(event.target) &&
                    !googleAppsPopup.contains(event.target)) {
                    googleAppsPopup.style.display = 'none';
                }
                if (newsCenterPopup && newsCenterPopup.style.display === 'flex' &&
                    !newsButton.contains(event.target) &&
                    !newsCenterPopup.contains(event.target)) {
                    newsCenterPopup.style.display = 'none';
                }
            });

            // Adiciona event listener para links de navegação no drawer
            navLinks.forEach(link => {
                link.addEventListener('click', function(event) {
                    const pageUrl = this.getAttribute('onclick').match(/loadPage\('([^']*)', (true|false)\)/)[1];
                    const requiresAuth = this.getAttribute('onclick').match(/loadPage\('([^']*)', (true|false)\)/)[2] === 'true';

                    // Esconde o formulário de login e o conteúdo dinâmico ao clicar em um link do menu
                    loginSection.classList.add('hidden');
                    dynamicContentDiv.classList.add('hidden');

                    if (isCurrentUserBanned && pageUrl !== 'POLÍTICAS GERAIS DO WIKI ZONE ZERO MOD.pdf') {
                        event.preventDefault();
                        document.getElementById('banned-message').style.display = 'block';
                        return;
                    }

                    if (requiresAuth && !currentUser) {
                        event.preventDefault();
                        document.getElementById('access-denied-message').style.display = 'block';
                        return;
                    }

                    if (pageUrl === 'POLÍTICAS GERAIS DO WIKI ZONE ZERO MOD.pdf') {
                        window.open(pageUrl, '_blank');
                        event.preventDefault();
                        return;
                    }

                    event.preventDefault(); // Previne a navegação padrão
                    loadPage(pageUrl, requiresAuth); // Usa a função loadPage para carregar conteúdo

                    // Fecha o drawer do MDL se estiver aberto
                    const layout = document.querySelector('.mdl-layout');
                    if (layout.MaterialLayout.drawer_.classList.contains('is-visible')) {
                        layout.MaterialLayout.toggleDrawer();
                    }
                });
            });

            // Inicializa componentes MDL
            if (componentHandler) {
                componentHandler.upgradeDom();
            }
        });

        // Função para carregar páginas (agora injeta conteúdo diretamente)
        function loadPage(pageUrl, requiresAuth) {
            const dynamicContentDiv = document.getElementById('dynamic-page-content');
            const accordionContainer = document.getElementById('accordion-container');
            const accessDeniedMessage = document.getElementById('access-denied-message');
            const bannedMessage = document.getElementById('banned-message');

            // Esconde mensagens de acesso/banimento
            accessDeniedMessage.style.display = 'none';
            bannedMessage.style.display = 'none';

            // Esconde todos os acordeões ao carregar uma nova página
            document.querySelectorAll('.accordion-content').forEach(c => {
                c.style.display = 'none';
                c.previousElementSibling.classList.remove('active');
                c.previousElementSibling.querySelector('.material-icons').textContent = 'expand_more';
            });

            // Lógica de autenticação e banimento (duplicada do onAuthStateChanged, mas para cliques em links)
            if (isCurrentUserBanned && pageUrl !== 'POLÍTICAS GERAIS DO WIKI ZONE ZERO MOD.pdf') {
                dynamicContentDiv.classList.add('hidden');
                bannedMessage.style.display = 'block';
                return;
            }
            if (requiresAuth && !currentUser) {
                dynamicContentDiv.classList.add('hidden');
                accessDeniedMessage.style.display = 'block';
                return;
            }

            // Lógica para carregar conteúdo na área dinâmica ou ativar acordeão
            let contentHtml = '';
            let foundInAccordion = false;

            // Tenta encontrar a página no conteúdo do acordeão
            accordionContentData.forEach(item => {
                // Simplesmente compara o nome do arquivo da URL com o título do acordeão
                // Você pode precisar de uma lógica mais robusta aqui se os nomes não forem 1:1
                const fileName = pageUrl.split('/').pop().split('.')[0].replace(/%20/g, ' ');
                if (item.title.toLowerCase().includes(fileName.toLowerCase()) || pageUrl === 'home.html' && item.title.includes('Introdução')) {
                    contentHtml = `
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">${item.title}</h2>
                        ${item.content}
                        <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored bg-purple-500 hover:bg-purple-600 text-white rounded-md shadow-md mt-4" onclick="summarizeArticle('${item.id}')">
                            ✨ Resumir Artigo
                        </button>
                        <div id="summary-output-${item.id}" class="mt-4 p-4 bg-gray-100 rounded-md text-gray-800 hidden">
                            <p class="font-semibold mb-2">Resumo:</p>
                            <div class="summary-content"></div>
                            <div class="loading-spinner text-center mt-2 hidden">
                                <div class="mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active"></div>
                            </div>
                        </div>
                    `;
                    dynamicContentDiv.innerHTML = contentHtml;
                    dynamicContentDiv.classList.remove('hidden');
                    accordionContainer.classList.add('hidden'); // Esconde acordeões se conteúdo dinâmico for exibido
                    foundInAccordion = true;
                }
            });

            if (!foundInAccordion) {
                // Se não encontrou no acordeão, exibe conteúdo genérico ou específico para URLs conhecidas
                if (pageUrl === 'missions.html' && currentUser) {
                    contentHtml = `
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Missões Secretas de Zone Zero</h2>
                        <p>Parabéns, Agente! Você tem acesso às missões confidenciais. Escolha sua próxima operação:</p>
                        <ul class="list-disc pl-5 mt-4 text-gray-700">
                            <li>**Operação Aurora:** Infiltrar a base inimiga e resgatar dados.</li>
                            <li>**Desafio do Vácuo:** Sobreviver a ondas de inimigos no setor proibido.</li>
                            <li>**Resgate Alfa:** Localizar e extrair o cientista desaparecido.</li>
                            <li>**Reconhecimento Noturno:** Mapear áreas inexploradas para futuras operações.</li>
                        </ul>
                        <p class="mt-4 text-sm text-gray-500">Lembre-se: estas missões são altamente classificadas. Mantenha a discrição.</p>
                        <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored bg-purple-500 hover:bg-purple-600 text-white rounded-md shadow-md mt-4" onclick="generateMissionBriefing()">
                            ✨ Gerar Briefing de Missão
                        </button>
                        <div id="mission-briefing-output" class="mt-4 p-4 bg-gray-100 rounded-md text-gray-800 hidden">
                            <p class="font-semibold mb-2">Briefing Gerado:</p>
                            <div class="briefing-content"></div>
                            <div class="loading-spinner text-center mt-2 hidden">
                                <div class="mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active"></div>
                            </div>
                        </div>
                    `;
                } else {
                    contentHtml = `<h2 class="text-xl font-semibold text-gray-800 mb-4">Conteúdo de ${pageUrl}</h2><p>Este é o conteúdo simulado para a página ${pageUrl}.</p>`;
                }
                dynamicContentDiv.innerHTML = contentHtml;
                dynamicContentDiv.classList.remove('hidden');
                accordionContainer.classList.add('hidden'); // Esconde acordeões se conteúdo dinâmico for exibido
            } else {
                // Se encontrou e exibiu o conteúdo do acordeão, os acordeões devem estar visíveis
                accordionContainer.classList.remove('hidden');
                dynamicContentDiv.classList.add('hidden'); // Esconde a área de conteúdo dinâmico
            }
             // Atualiza os componentes MDL para os novos elementos injetados
            if (componentHandler) {
                componentHandler.upgradeDom();
            }
        }


        // Lógica do Acordeão
        document.addEventListener('DOMContentLoaded', () => {
            const accordionContainer = document.getElementById('accordion-container');

            accordionContentData.forEach((item, index) => {
                const accordionItem = document.createElement('div');
                accordionItem.className = 'accordion-item';
                accordionItem.setAttribute('data-id', item.id); // Adiciona o ID ao item do acordeão

                const header = document.createElement('div');
                header.className = 'accordion-header';
                header.innerHTML = `<h3>${item.title}</h3><i class="material-icons">expand_more</i>`; // Ícone para indicar expansão

                const content = document.createElement('div');
                content.className = 'accordion-content';
                content.innerHTML = item.content + `
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored bg-purple-500 hover:bg-purple-600 text-white rounded-md shadow-md mt-4" onclick="summarizeArticle('${item.id}')">
                        ✨ Resumir Artigo
                    </button>
                    <div id="summary-output-${item.id}" class="mt-4 p-4 bg-gray-100 rounded-md text-gray-800 hidden">
                        <p class="font-semibold mb-2">Resumo:</p>
                        <div class="summary-content"></div>
                        <div class="loading-spinner text-center mt-2 hidden">
                            <div class="mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active"></div>
                        </div>
                    </div>
                `;

                header.addEventListener('click', () => {
                    // Fecha todos os outros acordeões
                    document.querySelectorAll('.accordion-content').forEach(c => {
                        if (c !== content && c.style.display === 'block') {
                            c.style.display = 'none';
                            c.previousElementSibling.classList.remove('active');
                            c.previousElementSibling.querySelector('.material-icons').textContent = 'expand_more';
                        }
                    });

                    // Alterna o acordeão clicado
                    if (content.style.display === 'block') {
                        content.style.display = 'none';
                        header.classList.remove('active');
                        header.querySelector('.material-icons').textContent = 'expand_more';
                    } else {
                        content.style.display = 'block';
                        header.classList.add('active');
                        header.querySelector('.material-icons').textContent = 'expand_less';
                    }
                    // Esconde a área de conteúdo dinâmico quando um acordeão é aberto
                    document.getElementById('dynamic-page-content').classList.add('hidden');
                     // Atualiza os componentes MDL para os novos elementos injetados
                    if (componentHandler) {
                        componentHandler.upgradeDom();
                    }
                });

                accordionItem.appendChild(header);
                accordionItem.appendChild(content);
                accordionContainer.appendChild(accordionItem);
            });
             // Atualiza os componentes MDL para os elementos do acordeão
            if (componentHandler) {
                componentHandler.upgradeDom();
            }
        });

        // ✨ Função LLM: Resumir Artigo
        async function summarizeArticle(articleId) {
            const articleData = accordionContentData.find(item => item.id === articleId);
            if (!articleData) {
                console.error('Artigo não encontrado para o ID:', articleId);
                return;
            }

            const summaryOutputDiv = document.getElementById(`summary-output-${articleId}`);
            const summaryContentDiv = summaryOutputDiv.querySelector('.summary-content');
            const loadingSpinner = summaryOutputDiv.querySelector('.loading-spinner');

            summaryContentDiv.innerHTML = ''; // Limpa qualquer resumo anterior
            summaryOutputDiv.classList.remove('hidden'); // Mostra a área de resumo
            loadingSpinner.classList.remove('hidden'); // Mostra o spinner

            const prompt = `Por favor, resuma o seguinte artigo do wiki de Zenless Zone Zero de forma concisa e clara, focando nos pontos principais. O resumo deve ter no máximo 100 palavras:\n\n${articleData.content.replace(/<[^>]*>/g, '')}`; // Remove HTML tags

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            const payload = { contents: chatHistory };
            const apiKey = ""; // A chave API será fornecida pelo ambiente Canvas
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    summaryContentDiv.innerHTML = `<p>${text}</p>`;
                } else {
                    summaryContentDiv.innerHTML = '<p class="text-red-500">Não foi possível gerar o resumo. Tente novamente.</p>';
                }
            } catch (error) {
                console.error("Erro ao chamar a API Gemini para resumir:", error);
                summaryContentDiv.innerHTML = `<p class="text-red-500">Erro ao comunicar com o servidor: ${error.message}</p>`;
            } finally {
                loadingSpinner.classList.add('hidden'); // Esconde o spinner
            }
        }

        // ✨ Função LLM: Gerar Briefing de Missão (para a página de Missões)
        async function generateMissionBriefing() {
            const missionOutputDiv = document.getElementById('mission-briefing-output');
            const briefingContentDiv = missionOutputDiv.querySelector('.briefing-content');
            const loadingSpinner = missionOutputDiv.querySelector('.loading-spinner');

            missionOutputDiv.classList.remove('hidden');
            briefingContentDiv.innerHTML = '';
            loadingSpinner.classList.remove('hidden');

            const prompt = `Crie um breve briefing de missão para uma das Missões Secretas de Zone Zero. Escolha uma missão aleatória das seguintes: "Operação Aurora", "Desafio do Vácuo", "Resgate Alfa", "Reconhecimento Noturno". Inclua um objetivo principal, um desafio esperado e uma dica tática. O briefing deve ser conciso.`;

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            const payload = { contents: chatHistory };
            const apiKey = ""; // A chave API será fornecida pelo ambiente Canvas
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    briefingContentDiv.innerHTML = `<p>${text}</p>`;
                } else {
                    briefingContentDiv.innerHTML = '<p class="text-red-500">Não foi possível gerar o briefing. Tente novamente.</p>';
                }
            } catch (error) {
                console.error("Erro ao chamar a API Gemini para gerar briefing:", error);
                briefingContentDiv.innerHTML = `<p class="text-red-500">Erro ao comunicar com o servidor: ${error.message}</p>`;
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        }


        // Captura de erros do console para o popup
        window._wzzmErrorLog = [];
        window.addEventListener('error', function(e) {
            window._wzzmErrorLog.push(`[${new Date().toLocaleTimeString()}] ${e.message} (${e.filename}:${e.lineno})`);
        });
        window.addEventListener('unhandledrejection', function(e) {
            window._wzzmErrorLog.push(`[${new Date().toLocaleTimeString()}] Unhandled Promise: ${e.reason}`);
        });
        (function() {
            const originalError = console.error;
            console.error = function(...args) {
                window._wzzmErrorLog.push(`[${new Date().toLocaleTimeString()}] console.error: ${args.join(' ')}`);
                originalError.apply(console, args);
            };
        })();
        document.addEventListener('DOMContentLoaded', function() {
            var btn = document.getElementById('error-log-button');
            if (!btn) return;
            btn.addEventListener('click', function() {
                var logList = document.getElementById('error-log-list');
                logList.innerHTML = '';
                if (window._wzzmErrorLog.length === 0) {
                    logList.innerHTML = '<li style="color:green;">Nenhum erro registrado nesta sessão.</li>';
                } else {
                    window._wzzmErrorLog.slice(-100).forEach(function(msg) {
                        var li = document.createElement('li');
                        li.textContent = msg;
                        logList.appendChild(li);
                    });
                }
                document.getElementById('error-log-popup').style.display = 'block';
            });
        });

        // Carregar o menu (simulando menu.json)
        document.addEventListener('DOMContentLoaded', function () {
            // Tenta carregar menu.json, se falhar, usa mockMenuData
            fetch('menu.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('menu.json não encontrado ou erro de rede');
                    }
                    return response.json();
                })
                .then(menuItems => {
                    populateDrawerMenu(menuItems);
                })
                .catch(err => {
                    console.warn('Erro ao carregar menu.json, usando dados mockados:', err);
                    populateDrawerMenu(mockMenuData);
                });

            function populateDrawerMenu(menuItems) {
                const drawerMenu = document.getElementById('drawer-menu');
                if (!drawerMenu) return;
                drawerMenu.innerHTML = ''; // Limpa itens antigos, se houver

                menuItems.forEach(item => {
                    const a = document.createElement('a');
                    a.className = 'mdl-navigation__link text-gray-200 hover:bg-indigo-700 hover:text-white rounded-md px-4 py-2 mb-2 transition-colors duration-200';
                    a.href = '#'; // A navegação será controlada pelo onclick
                    a.setAttribute('onclick', `loadPage('${item.href}', ${item.requiresAuth})`);
                    if (item.requiresAuth) {
                        a.setAttribute('data-requires-auth', 'true');
                    }
                    a.textContent = item.label;
                    drawerMenu.appendChild(a);
                });
                updateLoginStatus(); // Atualiza o status inicial do login e menu
            }
        });
    </script>
</body>
</html>
