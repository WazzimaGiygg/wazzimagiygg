<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebOS - Explorador de Subdomínios</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        /* ==================================== */
        /* GERAL & DESKTOP */
        /* ==================================== */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0078D4;
            overflow: hidden;
        }

        #desktop {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 48px; /* Espaço para a Taskbar */
        }

        /* Ícones do Desktop */
        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
            margin: 10px;
            padding: 8px;
            text-align: center;
            color: white;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.1s;
            border-radius: 4px;
        }
        .desktop-icon i { font-size: 32px; margin-bottom: 5px; }
        .desktop-icon span { font-size: 12px; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); }
        .desktop-icon:hover {
            background-color: rgba(255, 255, 255, 0.2);
            outline: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        /* ==================================== */
        /* TASKBAR & ÍCONE DO MENU */
        /* ==================================== */
        #taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 48px;
            background-color: #2b2b2b;
            color: white;
            display: flex;
            justify-content: flex-start; /* Alinha o Menu e ícones à esquerda */
            align-items: center;
            padding: 0 10px;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        #menu-button { /* Botão Menu "Iniciar" */
            margin-right: 10px;
            padding: 0 10px;
            height: 40px;
            width: auto;
            border-radius: 4px;
        }
        #menu-button i {
            font-size: 24px;
            color: #00BFFF; /* Cor do logo */
        }

        #taskbar-icons {
            display: flex;
            gap: 5px;
            flex-grow: 1; /* Permite crescer */
            justify-content: flex-start; /* Alinha ícones à esquerda, após o menu */
        }
        
        #taskbar-clock {
            margin-left: auto; /* Empurra para a direita */
            padding: 0 10px;
            line-height: 48px;
            font-size: 14px;
            cursor: default;
        }

        .taskbar-icon {
            background: none;
            border: none;
            padding: 5px 8px;
            cursor: pointer;
            height: 40px;
            width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            border-radius: 4px;
            transition: background-color 0.1s;
        }
        .taskbar-icon i { font-size: 20px; }
        .taskbar-icon:hover { background-color: rgba(255, 255, 255, 0.15); }
        .taskbar-icon.active-app {
            background-color: rgba(255, 255, 255, 0.1);
            border-bottom: 3px solid #00BFFF;
        }
        
        /* ==================================== */
        /* MENU DE APLICATIVOS (Menu Inicial) */
        /* ==================================== */
        #app-menu {
            position: fixed;
            bottom: 48px; /* Acima da taskbar */
            left: 10px; /* Alinhado ao botão Menu */
            width: 300px;
            background-color: #f7f7f7;
            border: 1px solid #ccc;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 6px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 999;
            display: none; /* Escondido por padrão */
        }

        #app-menu a {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 5px;
            background-color: white;
            border-radius: 4px;
            text-decoration: none;
            color: #333;
            transition: background-color 0.1s;
        }
        #app-menu a:hover {
            background-color: #e0f0ff;
        }
        #app-menu a i {
            margin-right: 10px;
            font-size: 18px;
            color: #0078D4;
        }

        /* ==================================== */
        /* JANELAS (Inclui Browser/iFrame) */
        /* ==================================== */
        .window {
            position: absolute;
            background-color: #f0f0f0;
            border: 1px solid #aaa;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            resize: both;
            overflow: hidden; /* Importante para o iFrame */
            min-width: 250px;
            min-height: 150px;
            z-index: 10;
            border-radius: 6px;
        }
        .window-content {
            height: calc(100% - 35px);
            overflow: auto;
            box-sizing: border-box;
            background-color: white;
        }
        /* Estilo para o iFrame do Navegador */
        .window-content iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }

        /* [Estilos do Header e Explorer mantidos do exemplo anterior...] */
        .window.minimized { display: none; }
        .window-header {
            height: 35px; background-color: #0078D4; color: white; padding: 0 5px;
            display: flex; align-items: center; cursor: move; user-select: none;
            border-top-left-radius: 6px; border-top-right-radius: 6px;
        }
        .window-controls button {
            background: none; border: none; color: white; font-size: 16px;
            height: 35px; width: 40px; cursor: pointer; transition: background-color 0.1s;
        }
        .close-btn:hover { background-color: #e81123; }
        .minimize-btn:hover, .maximize-btn:hover { background-color: rgba(255, 255, 255, 0.2); }
        .explorer-toolbar { /* Barra de menu no explorador */
            display: flex; align-items: center; gap: 10px; padding: 5px 10px;
            background-color: #e6e6e6; border-bottom: 1px solid #ccc;
        }
        .explorer-toolbar button {
            background: none; border: none; padding: 5px 8px; cursor: pointer;
            font-size: 14px; display: flex; align-items: center; border-radius: 4px;
        }
        .explorer-toolbar i { margin-right: 5px; font-size: 16px; color: #333; }
        .explorer-path { padding: 5px 10px; background-color: #f7f7f7; border-bottom: 1px solid #ddd; }
        .explorer-list { flex-grow: 1; list-style: none; padding: 0; margin: 0; background-color: white; }
        .explorer-item { padding: 8px 10px; cursor: pointer; display: flex; align-items: center; transition: background-color 0.1s; }
        .explorer-item:hover { background-color: #e0f0ff; }
        .explorer-item i { margin-right: 10px; font-size: 16px; color: #0078D4; }
    </style>
</head>
<body>

    <div id="desktop">
        <div class="desktop-icon" data-app="explorer" data-title="Explorador de Arquivos">
            <i class="fas fa-folder-open"></i>
            <span>Explorador</span>
        </div>
    </div>

    <div id="taskbar">
        <button id="menu-button" class="taskbar-icon" title="Menu de Aplicativos">
            <i class="fas fa-th-large"></i>
        </button>

        <div id="taskbar-icons">
            <button id="explorer-icon" class="taskbar-icon" data-app="explorer" data-title="Explorador de Arquivos">
                <i class="fas fa-folder"></i>
            </button>
        </div>
        
        <div id="taskbar-clock">
            <span id="current-time"></span>
        </div>
    </div>

    <div id="app-menu">
        </div>

    <div id="window-area">
        </div>

    <template id="window-template">
        <div class="window" style="width: 700px; height: 500px; top: 50px; left: 50px;">
            <div class="window-header">
                <span class="window-title">Título da Janela</span>
                <div class="window-controls">
                    <button class="minimize-btn" title="Minimizar"><i class="fas fa-window-minimize"></i></button>
                    <button class="maximize-btn" title="Maximizar"><i class="far fa-window-maximize"></i></button>
                    <button class="close-btn" title="Fechar"><i class="fas fa-times"></i></button>
                </div>
            </div>
            <div class="window-content">
                </div>
        </div>
    </template>

    <script>
// --- Dados Simulado do menu.json ---
const appMenuData = [
    { "label": "Mudanças Recentes", "href": "./wikinotpedia/", "requiresAuth": true, "icon": "fas fa-history" },
    { "label": "Procurar artigo WNPX", "href": "simplearticles/", "requiresAuth": true, "icon": "fas fa-search" },
    { "label": "Chat Online interno", "href": "chat/", "requiresAuth": true, "icon": "fas fa-comments" },
    { "label": "Upload de Imagem", "href": "uploadimagem/", "requiresAuth": true, "icon": "fas fa-upload" },
    { "label": "Upload PDF", "href": "uploadpdf.html", "requiresAuth": true, "icon": "fas fa-file-pdf" },
    { "label": "Hub de Aplicativos", "href": "forumapplication/", "requiresAuth": true, "icon": "fas fa-cube" },
    { "label": "Ferramentas adicionais", "href": "menu.html", "requiresAuth": true, "icon": "fas fa-tools" }
];

// --- Estrutura de Arquivos Simulado ---
const fileSystem = { /* ... (Mantido do exemplo anterior) ... */
    'subdominio-web': {
        type: 'folder',
        content: {
            'index.html': { type: 'file', content: 'Conteúdo do Index HTML.' },
            'assets': {
                type: 'folder',
                content: {
                    'style.css': { type: 'file', content: 'Conteúdo CSS de estilo.' },
                    'logo.png': { type: 'file', content: 'Imagem Binária (simulação).' }
                }
            },
            'docs': {
                type: 'folder',
                content: {
                    'readme.md': { type: 'file', content: 'Documentação do projeto.' }
                }
            }
        }
    },
    'blog-pessoal': {
        type: 'folder',
        content: {
            'post1.html': { type: 'file', content: 'Primeiro post do blog.' },
            'post2.html': { type: 'file', content: 'Segundo post do blog.' }
        }
    },
    'config.json': { type: 'file', content: '{ "version": "1.0" }' }
};

// --- Controle de Janelas ---
let windowZIndex = 10;
let windowCounter = 0;
let activeWindows = {}; 

document.addEventListener('DOMContentLoaded', () => {
    const desktop = document.getElementById('desktop');
    const taskbarIcons = document.getElementById('taskbar-icons');
    const windowArea = document.getElementById('window-area');
    const windowTemplate = document.getElementById('window-template');
    const appMenu = document.getElementById('app-menu');
    const menuButton = document.getElementById('menu-button');

    // Inicializa o relógio
    updateTime();
    setInterval(updateTime, 1000);

    // 1. Inicializa o Menu de Aplicativos
    renderAppMenu();

    // 2. Evento para abrir/fechar o Menu
    menuButton.addEventListener('click', () => {
        appMenu.style.display = appMenu.style.display === 'block' ? 'none' : 'block';
    });

    // Fecha o menu se clicar fora
    document.addEventListener('mousedown', (e) => {
        if (appMenu.style.display === 'block' && !appMenu.contains(e.target) && !menuButton.contains(e.target)) {
            appMenu.style.display = 'none';
        }
    });

    // 3. Eventos para abrir apps no Desktop e Ícones Fixos
    document.querySelectorAll('[data-app]').forEach(element => {
        element.addEventListener('dblclick', (e) => {
            if (element.classList.contains('desktop-icon')) {
                openApp(element.getAttribute('data-app'), element.getAttribute('data-title'));
            }
        });
        element.addEventListener('click', (e) => {
            const appId = element.getAttribute('data-app');
            if (element.id.includes('icon')) {
                toggleWindow(appId);
            }
        });
    });

    // --- Funções de Renderização ---

    function renderAppMenu() {
        appMenu.innerHTML = '';
        appMenuData.forEach((item, index) => {
            // Cria um ID único para a aplicação baseada no index
            const appId = `browser-app-${index}`; 
            
            const link = document.createElement('a');
            link.href = '#'; // Previne o comportamento padrão de navegação
            link.innerHTML = `<i class="${item.icon || 'fas fa-external-link-alt'}"></i> ${item.label}`;
            link.title = item.href;
            
            link.addEventListener('click', (e) => {
                e.preventDefault();
                openBrowserWindow(item.href, item.label, appId);
                appMenu.style.display = 'none'; // Fecha o menu ao clicar
            });
            appMenu.appendChild(link);
        });
    }

    /**
     * Abre uma janela que simula um navegador com um iFrame.
     * @param {string} url - A URL a ser carregada (href).
     * @param {string} title - O rótulo/título do menu.
     * @param {string} appId - ID único para rastrear a janela.
     */
    function openBrowserWindow(url, title, appId) {
        // Usa a URL como ID da aplicação para que múltiplos links do menu abram janelas separadas
        const uniqueAppId = appId; 

        if (activeWindows[uniqueAppId]) {
            focusWindow(activeWindows[uniqueAppId].element);
            return;
        }

        // 1. Cria a Janela
        const newWindow = windowTemplate.content.cloneNode(true).querySelector('.window');
        const windowId = `window-${windowCounter++}`;
        newWindow.id = windowId;
        newWindow.setAttribute('data-app-id', uniqueAppId);
        
        newWindow.style.zIndex = ++windowZIndex;
        newWindow.querySelector('.window-title').textContent = title;
        newWindow.style.top = `${Math.floor(Math.random() * 50) + 100}px`;
        newWindow.style.left = `${Math.floor(Math.random() * 50) + 100}px`;

        // 2. Adiciona o iFrame (simulando um navegador)
        // Nota: Substituímos a URL pela URL real do seu repositório/subdomínio se for o caso
        // Se a URL for externa, ela PODE ser bloqueada pelo navegador (CORS/X-Frame-Options).
        // Usamos a URL de destino (href) do seu JSON no src do iFrame.
        
        // CORREÇÃO DE URL: Se for um link relativo, precisamos de um host (simulação)
        let finalUrl = url;
        if (!url.startsWith('http')) {
            // Se estiver em GitHub Pages (ex: user.github.io/repo), a URL deve ser resolvida
            // Usaremos 'about:blank' para evitar erros em navegadores sem um servidor de origem correto
            // Use window.location.origin + '/' + url para testar em um servidor
            finalUrl = 'about:blank'; 
        }

        newWindow.querySelector('.window-content').innerHTML = `
            <iframe src="${finalUrl}" title="${title} Content"></iframe>
        `;

        // 3. Adiciona ao DOM e foca
        windowArea.appendChild(newWindow);
        focusWindow(newWindow);
        
        // 4. Cria e Adiciona o Ícone na Taskbar
        let taskIcon = document.createElement('button');
        taskIcon.id = `task-icon-${uniqueAppId}`;
        taskIcon.className = 'taskbar-icon active-app';
        taskIcon.setAttribute('data-app', uniqueAppId);
        
        // Pega o ícone do JSON para a taskbar
        const itemIconClass = appMenuData.find(item => item.label === title)?.icon || 'fas fa-external-link-alt';
        taskIcon.innerHTML = `<i class="${itemIconClass}"></i>`;
        
        taskbarIcons.appendChild(taskIcon);
        taskIcon.addEventListener('click', () => toggleWindow(uniqueAppId));

        // 5. Adiciona Eventos
        addWindowEvents(newWindow);

        // 6. Atualiza o estado
        activeWindows[uniqueAppId] = { element: newWindow, state: 'open', taskIcon: taskIcon };
    }

    /**
     * Abre ou foca um aplicativo padrão (como o explorador).
     */
    function openApp(appId, title) {
        // ... (A lógica de openApp e renderExplorer foi mantida do exemplo anterior) ...
        if (activeWindows[appId] && activeWindows[appId].state === 'open') {
            focusWindow(activeWindows[appId].element);
            return;
        }

        const newWindow = windowTemplate.content.cloneNode(true).querySelector('.window');
        const windowId = `window-${windowCounter++}`;
        newWindow.id = windowId;
        newWindow.setAttribute('data-app-id', appId);
        
        newWindow.style.zIndex = ++windowZIndex;
        newWindow.querySelector('.window-title').textContent = title;
        newWindow.style.top = `${Math.floor(Math.random() * 50) + 100}px`; 
        newWindow.style.left = `${Math.floor(Math.random() * 50) + 100}px`;

        if (appId === 'explorer') {
            renderExplorer(newWindow.querySelector('.window-content'), fileSystem, 'Raiz do Repositório');
        } else {
             newWindow.querySelector('.window-content').innerHTML = `<div style="padding: 20px;"><h1>App Padrão</h1><p>Conteúdo.</p></div>`;
        }
        
        windowArea.appendChild(newWindow);
        focusWindow(newWindow);
        addWindowEvents(newWindow);

        let taskIcon = document.getElementById(`${appId}-icon`);
        if (taskIcon) {
            taskIcon.classList.add('active-app');
        } else {
            // Cria um ícone dinâmico se não for um dos fixos
            taskIcon = document.createElement('button');
            taskIcon.id = `task-icon-${appId}`;
            taskIcon.className = 'taskbar-icon active-app';
            taskIcon.setAttribute('data-app', appId);
            taskIcon.innerHTML = `<i class="fas fa-cube"></i>`; // Ícone padrão
            taskbarIcons.appendChild(taskIcon);
            taskIcon.addEventListener('click', () => toggleWindow(appId));
        }

        activeWindows[appId] = { element: newWindow, state: 'open', taskIcon: taskIcon };
    }


    /**
     * Foca uma janela (traz para frente e marca na taskbar).
     */
    function focusWindow(windowElement) {
        document.querySelectorAll('.window').forEach(win => win.style.border = '1px solid #aaa');
        windowElement.style.zIndex = ++windowZIndex;
        windowElement.style.border = '1px solid #0078D4';

        document.querySelectorAll('.taskbar-icon').forEach(icon => icon.classList.remove('active-app'));
        const appId = windowElement.getAttribute('data-app-id');
        
        // Foca o ícone fixo ou o dinâmico
        let taskIcon = document.getElementById(`${appId}-icon`) || document.getElementById(`task-icon-${appId}`);
        if (taskIcon) {
            taskIcon.classList.add('active-app');
        }
    }

    /**
     * Alterna o estado (minimizar/restaurar) da janela.
     */
    function toggleWindow(appId) {
        const appState = activeWindows[appId];
        if (!appState) return;

        const win = appState.element;

        if (win.classList.contains('minimized')) {
            win.classList.remove('minimized');
            appState.state = 'open';
            focusWindow(win);
        } else {
            win.classList.add('minimized');
            appState.state = 'minimized';
            appState.taskIcon.classList.remove('active-app');
        }
    }

    /**
     * Adiciona eventos de arrastar, redimensionar e controle.
     */
    function addWindowEvents(windowElement) {
        const header = windowElement.querySelector('.window-header');
        const appId = windowElement.getAttribute('data-app-id');
        
        windowElement.addEventListener('mousedown', () => focusWindow(windowElement));

        windowElement.querySelector('.minimize-btn').addEventListener('click', () => {
            windowElement.classList.add('minimized');
            activeWindows[appId].state = 'minimized';
            let taskIcon = document.getElementById(`${appId}-icon`) || document.getElementById(`task-icon-${appId}`);
            if (taskIcon) taskIcon.classList.remove('active-app');
        });

        windowElement.querySelector('.close-btn').addEventListener('click', () => {
            windowElement.remove();
            let taskIcon = document.getElementById(`${appId}-icon`) || document.getElementById(`task-icon-${appId}`);
            if (taskIcon) taskIcon.remove();
            delete activeWindows[appId];
            
            const remainingApps = Object.keys(activeWindows);
            if (remainingApps.length > 0) {
                focusWindow(activeWindows[remainingApps[0]].element);
            }
        });

        // Lógica de arrastar (mantida)
        let isDragging = false;
        let offset = { x: 0, y: 0 };

        header.addEventListener('mousedown', (e) => {
            isDragging = true;
            offset.x = e.clientX - windowElement.offsetLeft;
            offset.y = e.clientY - windowElement.offsetTop;
            windowElement.style.zIndex = ++windowZIndex;
            windowElement.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            let newX = e.clientX - offset.x;
            let newY = e.clientY - offset.y;
            newX = Math.max(0, newX);
            newY = Math.max(0, Math.min(newY, window.innerHeight - 48 - windowElement.offsetHeight)); 
            windowElement.style.left = `${newX}px`;
            windowElement.style.top = `${newY}px`;
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            windowElement.style.cursor = 'default';
        });
    }

    // --- Lógica do Explorador de Arquivos (Mantida) ---
    function renderExplorer(container, currentDir, currentPath) {
        container.innerHTML = `
            <div class="explorer-view">
                <div class="explorer-toolbar">
                    <button onclick="console.log('Voltar')"><i class="fas fa-arrow-left"></i> Voltar</button>
                    <button onclick="console.log('Novo')"><i class="fas fa-plus"></i> Novo</button>
                    <button onclick="alert('Visualização não implementada.')"><i class="fas fa-eye"></i> Visualizar</button>
                </div>
                <div class="explorer-path">Caminho: <span>${currentPath}</span></div>
                <ul class="explorer-list"></ul>
            </div>
        `;
        
        const listContainer = container.querySelector('.explorer-list');

        if (currentPath !== 'Raiz do Repositório') {
            const backItem = document.createElement('li');
            backItem.className = 'explorer-item folder';
            backItem.innerHTML = '<i class="fas fa-level-up-alt"></i> .. (Voltar)';
            backItem.addEventListener('click', () => {
                renderExplorer(container, fileSystem, 'Raiz do Repositório');
            });
            listContainer.appendChild(backItem);
        }

        for (const name in currentDir) {
            const item = currentDir[name];
            const listItem = document.createElement('li');
            listItem.className = `explorer-item ${item.type}`;

            let iconClass = item.type === 'folder' ? 'fas fa-folder' : 'fas fa-file';
            if (name.endsWith('.html') || name.endsWith('.css')) iconClass = 'fas fa-file-code';
            
            listItem.innerHTML = `<i class="${iconClass}"></i> ${name}`;

            if (item.type === 'folder') {
                listItem.addEventListener('click', () => {
                    renderExplorer(container, item.content, `${currentPath}/${name}`);
                });
            } else if (item.type === 'file') {
                listItem.addEventListener('dblclick', () => {
                    alert(`Conteúdo do arquivo ${name}:\n\n${item.content.substring(0, 100)}...`);
                });
            }

            listContainer.appendChild(listItem);
        }
    }

    // --- Utilidades ---
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        const dateString = now.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
        document.getElementById('current-time').textContent = `${timeString} ${dateString}`;
    }

});
    </script>
</body>
</html>
