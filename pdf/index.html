<!DOCTYPE html>
<html lang="pt-BR">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Visualizar PDF - WZZM</title>
ย ย <link rel="icon" href="favicom.png" type="image/x-icon">
ย ย <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans">
ย ย <style>
ย ย ย ย body {
ย ย ย ย ย ย font-family: 'Noto Sans', sans-serif;
ย ย ย ย ย ย line-height: 1.6;
ย ย ย ย ย ย margin: 2em;
ย ย ย ย ย ย background-color: #f8f9fa;
ย ย ย ย }
ย ย ย ย .container {
ย ย ย ย ย ย max-width: 1000px;
ย ย ย ย ย ย margin: auto;
ย ย ย ย ย ย background-color: #fff;
ย ย ย ย ย ย padding: 2em;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
ย ย ย ย ย ย text-align: center;
ย ย ย ย }
ย ย ย ย h1 {
ย ย ย ย ย ย color: #000;
ย ย ย ย ย ย font-size: 2em;
ย ย ย ย ย ย border-bottom: 1px solid #a2a9b1;
ย ย ย ย ย ย padding-bottom: 0.5em;
ย ย ย ย }
ย ย ย ย .file-name-display {
ย ย ย ย ย ย font-size: 0.8em;
ย ย ย ย ย ย font-style: italic;
ย ย ย ย ย ย color: #72777d;
ย ย ย ย ย ย margin-top: 0.5em;
ย ย ย ย }
ย ย ย ย .pdf-frame {
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย height: 800px;
ย ย ย ย ย ย border: 1px solid #ddd;
ย ย ย ย ย ย margin-top: 1em;
ย ย ย ย }
ย ย ย ย .print-buttons {
ย ย ย ย ย ย text-align: right;
ย ย ย ย ย ย margin-bottom: 20px;
ย ย ย ย }
ย ย ย ย @media print {
ย ย ย ย ย ย body {
ย ย ย ย ย ย ย ย margin: 0;
ย ย ย ย ย ย }
ย ย ย ย ย ย .print-buttons {
ย ย ย ย ย ย ย ย display: none;
ย ย ย ย ย ย }
ย ย ย ย ย ย .container {
ย ย ย ย ย ย ย ย box-shadow: none;
ย ย ย ย ย ย ย ย padding: 0;
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย /* Estilo para os novos elementos de metadados */
ย ย ย ย .metadata-container {
ย ย ย ย ย ย text-align: left;
ย ย ย ย ย ย margin-top: 1em;
ย ย ย ย ย ย padding: 1.5em;
ย ย ย ย ย ย background-color: #f1f3f5;
ย ย ย ย ย ย border-radius: 6px;
ย ย ย ย ย ย margin-bottom: 2em;
ย ย ย ย }
ย ย ย ย .metadata-group {
ย ย ย ย ย ย margin-bottom: 0.5em;
ย ย ย ย ย ย word-wrap: break-word;
ย ย ย ย }
ย ย ย ย .metadata-group strong {
ย ย ย ย ย ย color: #444;
ย ย ย ย }

ย ย ย ย /* Botรตes de Aรงรฃo */
ย ย ย ย .action-buttons {
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย margin-bottom: 20px;
ย ย ย ย }
ย ย ย ย #downloadButton {
ย ย ย ย ย ย background-color: #3498db;
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย padding: 10px 20px;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย border-radius: 5px;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย font-size: 1em;
ย ย ย ย }
ย ย ย ย #downloadButton:hover {
ย ย ย ย ย ย background-color: #2980b9;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* Estilo para o Pop-up (Modal) de Aviso */
ย ย ย ย .modal {
ย ย ย ย ย ย display: none;
ย ย ย ย ย ย position: fixed;
ย ย ย ย ย ย z-index: 1;
ย ย ย ย ย ย left: 0;
ย ย ย ย ย ย top: 0;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย height: 100%;
ย ย ย ย ย ย overflow: auto;
ย ย ย ย ย ย background-color: rgba(0,0,0,0.4);
ย ย ย ย ย ย padding-top: 60px;
ย ย ย ย }
ย ย ย ย .modal-content {
ย ย ย ย ย ย background-color: #fefefe;
ย ย ย ย ย ย margin: 5% auto;
ย ย ย ย ย ย padding: 20px;
ย ย ย ย ย ย border: 1px solid #888;
ย ย ย ย ย ย width: 80%;
ย ย ย ย ย ย max-width: 500px;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย text-align: left;
ย ย ย ย ย ย position: relative;
ย ย ย ย }
ย ย ย ย .close-button {
ย ย ย ย ย ย color: #aaa;
ย ย ย ย ย ย float: right;
ย ย ย ย ย ย font-size: 28px;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย }
ย ย ย ย .close-button:hover, .close-button:focus {
ย ย ย ย ย ย color: #000;
ย ย ย ย ย ย text-decoration: none;
ย ย ย ย }
ย ย ย ย .modal h2 {
ย ย ย ย ย ย border-bottom: 1px solid #ccc;
ย ย ย ย ย ย padding-bottom: 10px;
ย ย ย ย ย ย margin-bottom: 20px;
ย ย ย ย }
ย ย ย ย #confirmDownload {
ย ย ย ย ย ย background-color: #27ae60;
ย ย ย ย ย ย margin-top: 20px;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย display: block;
ย ย ย ย }
ย ย ย ย #confirmDownload:hover {
ย ย ย ย ย ย background-color: #229954;
ย ย ย ย }
ย ย </style>
</head>
<body>
ย ย <div class="container">
ย ย ย ย <div class="print-buttons">
ย ย ย ย ย ย <button onclick="window.print()">Imprimir</button>
ย ย ย ย </div>
ย ย ย ย <div id="pdf-container">
ย ย ย ย ย ย <p style="text-align: center; color: #666;">Carregando PDF...</p>
ย ย ย ย </div>
ย ย </div>

ย ย <div id="download-alert-popup" class="modal">
ย ย ย ย <div class="modal-content">
ย ย ย ย ย ย <span class="close-button" onclick="closeDownloadAlert()">โ</span>
ย ย ย ย ย ย <h2>Aviso sobre Direitos Autorais e Plรกgio</h2>
ย ย ย ย ย ย <p>Ao fazer o download deste arquivo, vocรช concorda em utilizรก-lo apenas para fins educativos e de referรชncia. A reproduรงรฃo ou distribuiรงรฃo sem a devida permissรฃo do autor ou fonte รฉ estritamente proibida.</p>
ย ย ย ย ย ย <p>Certifique-se de citar corretamente o autor e a fonte (se aplicรกvel) em qualquer trabalho acadรชmico ou pesquisa para evitar plรกgio.</p>
ย ย ย ย ย ย <button id="confirmDownload">Estou ciente, fazer o download</button>
ย ย ย ย </div>
ย ย </div>

ย ย <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
ย ย <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
ย ย <script>
ย ย ย ย const firebaseConfig = {
ย ย ย ย ย ย apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0",
ย ย ย ย ย ย authDomain: "wzzm-ce3fc.firebaseapp.com",
ย ย ย ย ย ย projectId: "wzzm-ce3fc",
ย ย ย ย ย ย storageBucket: "wzzm-ce3fc.appspot.com",
ย ย ย ย ย ย messagingSenderId: "249427877153",
ย ย ย ย ย ย appId: "1:249427877153:web:0e4297294794a5aadeb260",
ย ย ย ย ย ย measurementId: "G-PLKNZNFCQ8"
ย ย ย ย };
ย ย ย ย firebase.initializeApp(firebaseConfig);
ย ย ย ย const db = firebase.firestore();

ย ย ย ย const pdfContainer = document.getElementById('pdf-container');
ย ย ย ย const downloadButton = document.getElementById('downloadButton');
ย ย ย ย const downloadAlertPopup = document.getElementById('download-alert-popup');
ย ย ย ย const confirmDownloadButton = document.getElementById('confirmDownload');
ย ย ย ยย
ย ย ย ย // Elementos para exibir metadados
ย ย ย ย let metadataContainer; // Variรกvel para o container
ย ย ย ย let metadataDescription, metadataAuthors, metadataDoi, metadataSource, metadataOrigin, metadataUid;

ย ย ย ย function closeDownloadAlert() {
ย ย ย ย ย ย downloadAlertPopup.style.display = 'none';
ย ย ย ย }

ย ย ย ย async function buscarEExibirPdf() {
ย ย ย ย ย ย const urlParams = new URLSearchParams(window.location.search);
ย ย ย ย ย ย const fileName = urlParams.get('uid');

ย ย ย ย ย ย if (!fileName) {
ย ย ย ย ย ย ย ย pdfContainer.innerHTML = '<p style="text-align: center; color: #e74c3c;">Nome do arquivo nรฃo fornecido na URL.</p>';
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }

ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const querySnapshot = await db.collection('pdfcode').where('file_name', '==', fileName).limit(1).get();

ย ย ย ย ย ย ย ย if (!querySnapshot.empty) {
ย ย ย ย ย ย ย ย ย ย const doc = querySnapshot.docs[0];
ย ย ย ย ย ย ย ย ย ย const pdfData = doc.data();
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Constrรณi o HTML dinamicamente para garantir a ordem correta
ย ย ย ย ย ย ย ย ย ย pdfContainer.innerHTML = `
ย ย ย ย ย ย ย ย ย ย ย ย <h1>${pdfData.file_name}</h1>
ย ย ย ย ย ย ย ย ย ย ย ย <p class="file-name-display">Nome do Arquivo: ${pdfData.file_name}</p>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <hr style="margin: 1.5em 0; border: 0; border-top: 1px solid #a2a9b1;">

ย ย ย ย ย ย ย ย ย ย ย ย <div class="metadata-container">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="metadata-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <strong>Descriรงรฃo:</strong>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span id="metadata-description"></span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="metadata-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <strong>Autores:</strong>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span id="metadata-authors"></span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="metadata-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <strong>DOI:</strong>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span id="metadata-doi"></span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="metadata-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <strong>Fonte:</strong>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span id="metadata-source"></span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="metadata-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <strong>Origem:</strong>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span id="metadata-origin"></span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="metadata-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <strong>UID do Usuรกrio:</strong>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span id="metadata-uid"></span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย <div class="action-buttons">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button id="downloadButton">๐ฅ Fazer Download</button>
ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย <iframe class="pdf-frame" src="${pdfData.base64_code}"></iframe>
ย ย ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Associa os elementos depois que eles sรฃo criados
ย ย ย ย ย ย ย ย ย ย const metadataDescription = document.getElementById('metadata-description');
ย ย ย ย ย ย ย ย ย ย const metadataAuthors = document.getElementById('metadata-authors');
ย ย ย ย ย ย ย ย ย ย const metadataDoi = document.getElementById('metadata-doi');
ย ย ย ย ย ย ย ย ย ย const metadataSource = document.getElementById('metadata-source');
ย ย ย ย ย ย ย ย ย ย const metadataOrigin = document.getElementById('metadata-origin');
ย ย ย ย ย ย ย ย ย ย const metadataUid = document.getElementById('metadata-uid');
ย ย ย ย ย ย ย ย ย ย const newDownloadButton = document.getElementById('downloadButton');

ย ย ย ย ย ย ย ย ย ย // Preenche os metadados
ย ย ย ย ย ย ย ย ย ย metadataDescription.innerText = pdfData.description || 'Nรฃo especificado';
ย ย ย ย ย ย ย ย ย ย metadataAuthors.innerText = (pdfData.authors && pdfData.authors.length > 0) ? pdfData.authors.join(', ') : 'Nรฃo especificado';
ย ย ย ย ย ย ย ย ย ย metadataDoi.innerText = pdfData.doi || 'Nรฃo especificado';
ย ย ย ย ย ย ย ย ย ย metadataSource.innerText = pdfData.source || 'Nรฃo especificado';
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const origins = [];
ย ย ย ย ย ย ย ย ย ย if (pdfData.is_wikipedia) origins.push('Wikipรฉdia');
ย ย ย ย ย ย ย ย ย ย if (pdfData.is_scielo) origins.push('SciELO');
ย ย ย ย ย ย ย ย ย ย if (pdfData.is_google_scholar) origins.push('Google Acadรชmico');
ย ย ย ย ย ย ย ย ย ย metadataOrigin.innerText = origins.length > 0 ? origins.join(', ') : 'Nรฃo especificado';
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย metadataUid.innerText = pdfData.uid || 'Nรฃo especificado';

ย ย ย ย ย ย ย ย ย ย // Adiciona o event listener para o botรฃo de download
ย ย ย ย ย ย ย ย ย ย newDownloadButton.addEventListener('click', () => {
ย ย ย ย ย ย ย ย ย ย ย ย showDownloadAlert();
ย ย ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย ย ย // Adiciona o event listener para o botรฃo de confirmaรงรฃo de download
ย ย ย ย ย ย ย ย ย ย confirmDownloadButton.onclick = () => {
ย ย ย ย ย ย ย ย ย ย ย ย const link = document.createElement('a');
ย ย ย ย ย ย ย ย ย ย ย ย link.href = pdfData.base64_code;
ย ย ย ย ย ย ย ย ย ย ย ย link.download = pdfData.file_name;
ย ย ย ย ย ย ย ย ย ย ย ย document.body.appendChild(link);
ย ย ย ย ย ย ย ย ย ย ย ย link.click();
ย ย ย ย ย ย ย ย ย ย ย ย document.body.removeChild(link);
ย ย ย ย ย ย ย ย ย ย ย ย closeDownloadAlert();
ย ย ย ย ย ย ย ย ย ย };

ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย pdfContainer.innerHTML = '<p style="text-align: center; color: #e74c3c;">PDF nรฃo encontrado.</p>';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย console.error("Erro ao buscar PDF:", error);
ย ย ย ย ย ย ย ย pdfContainer.innerHTML = '<p style="text-align: center; color: #e74c3c;">Erro ao carregar o PDF: ' + error.message + '</p>';
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย window.onload = buscarEExibirPdf;

ย ย </script>
</body>
</html>
