<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizar HTML - WZZM</title>
    <!-- Carrega o Tailwind CSS para um design moderno e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Importa a fonte Inter, amplamente usada em designs modernos */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Estilo customizado para o spinner de carregamento */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: #3b82f6; /* Azul moderno do Tailwind */
            border-radius: 50%;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Garantindo que o conte√∫do HTML interno se ajuste bem */
        .html-content > * {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<!-- Corpo da p√°gina com fundo suave e layout centralizado -->
<body class="bg-gray-50 p-4 md:p-8 min-h-screen flex items-start justify-center">

    <!-- Container principal: centralizado, card com sombra e cantos arredondados -->
    <div class="container bg-white max-w-4xl w-full p-6 md:p-10 rounded-xl shadow-2xl mt-10 transition-all duration-300">

        <!-- T√≠tulo da p√°gina: moderno e com separador em azul suave -->
        <h1 id="page-title" class="text-3xl font-extrabold text-gray-800 mb-8 pb-4 border-b-4 border-blue-500/50">
            Carregando...
        </h1>

        <!-- √Årea de exibi√ß√£o do HTML: com padding e fundo levemente diferente para destaque -->
        <div id="html-display" class="html-content text-left mt-6 p-4 md:p-8 border border-gray-200 bg-gray-50 rounded-lg min-h-[200px] transition-all duration-300 overflow-auto">
            
            <!-- Indicador de carregamento aprimorado com spinner CSS -->
            <div class="loading-container flex flex-col items-center justify-center p-8 space-y-4">
                <div class="spinner w-12 h-12"></div>
                <p class="text-center text-gray-500 text-lg font-medium">Verificando se voc√™ √© uma pessoa real...</p>
            </div>
        </div>
    </div>

    <!-- Scripts do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
        // Inicializa√ß√£o do Firebase
        const firebaseConfig = {
            // Chave de API removida por seguran√ßa
            authDomain: "wzzm-ce3fc.firebaseapp.com",
            projectId: "wzzm-ce3fc",
            storageBucket: "wzzm-ce3fc.appspot.com",
            messagingSenderId: "249427877153",
            appId: "1:249427877153:web:0e4297294794a5aadeb260",
            measurementId: "G-PLKNZNFCQ8"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const htmlDisplay = document.getElementById('html-display');
        const pageTitle = document.getElementById('page-title');

        /**
         * Intercepta cliques em todos os links <a> dentro de um container
         * para for√ßar a navega√ß√£o dentro do iframe atual, exceto se houver target="_blank".
         * @param {HTMLElement} container O elemento pai contendo os links.
         */
        function interceptLinks(container) {
            const links = container.querySelectorAll('a');

            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    // Se o link tiver target="_blank" (para abrir em nova aba), n√£o interfere
                    if (this.target === '_blank') {
                        return; 
                    }
                    
                    e.preventDefault(); // Impede a navega√ß√£o padr√£o do navegador
                    
                    const href = this.href;
                    if (href) {
                        // Redireciona a janela atual (que √© o iframe) para o novo link.
                        // Isso garante que o conte√∫do mude DENTRO da janela virtual.
                        window.location.href = href;
                    }
                });
            });
        }

        async function buscarEExibirHtml() {
            const urlParams = new URLSearchParams(window.location.search);
            const documentId = urlParams.get('uid');

            if (!documentId) {
                htmlDisplay.innerHTML = '<p class="text-center text-red-500 font-bold p-4">ID do documento n√£o fornecido na URL.</p>';
                pageTitle.innerText = "Erro";
                return;
            }

            try {
                const docRef = db.collection('HTML2W').doc(documentId);
                const doc = await docRef.get();

                if (doc.exists) {
                    const htmlData = doc.data();
                    pageTitle.innerText = htmlData.nomePagina || 'P√°gina sem T√≠tulo';
                    const htmlContent = htmlData.html_content || htmlData.codigo;
                    const jsScript = htmlData.js_script;

                    if (htmlContent) {
                        htmlDisplay.innerHTML = htmlContent;
                        // üÜï Chama a fun√ß√£o para interceptar links ap√≥s carregar o conte√∫do
                        interceptLinks(htmlDisplay); 
                    } else {
                        htmlDisplay.innerHTML = '<p class="text-center text-red-500 font-bold p-4">Conte√∫do HTML n√£o encontrado no documento.</p>';
                    }

                    if (jsScript) {
                        const scriptElement = document.createElement('script');
                        scriptElement.textContent = jsScript;
                        document.body.appendChild(scriptElement);
                    }
                } else {
                    htmlDisplay.innerHTML = '<p class="text-center text-red-500 font-bold p-4">Documento n√£o encontrado no banco de dados.</p>';
                    pageTitle.innerText = "Conte√∫do N√£o Encontrado";
                }
            } catch (error) {
                console.error("Ocorreu um erro ao carregar o conte√∫do:", error);
                const errorMessage = !navigator.onLine ? 
                    '<p class="text-center text-red-500 font-bold p-4">O sistema detectou uma anomalia em seu trafego, a p√°gina n√£o pode ser aberta!</p>' : 
                    '<p class="text-center text-red-500 font-bold p-4">O sistema detectou uma anomalia em seu trafego, a p√°gina n√£o pode ser aberta!</p>';
                
                htmlDisplay.innerHTML = errorMessage;
                pageTitle.innerText = "Erro";
            }
        }
        
        window.onload = buscarEExibirHtml;

        // ‚ùå C√ìDIGO DE FRAME-BUSTING REMOVIDO: 
        // A remo√ß√£o deste bloco garante que a p√°gina n√£o tente quebrar o iframe 
        // e carregar o conte√∫do na janela principal do navegador.
        
    </script>
</body>
</html>
