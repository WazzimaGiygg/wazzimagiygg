<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gerenciamento de Advertências</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* RESET E CONFIGURAÇÕES GERAIS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --danger-color: #dc3545;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --text-color: #333333;
            --text-light: #666666;
            --bg-color: #f8f9fa;
            --border-color: #dee2e6;
            --card-color: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* CONTAINER DE LOGIN */
        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease;
        }

        .login-card {
            background: white;
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 450px;
            width: 90%;
            transform: translateY(0);
            animation: slideUp 0.5s ease;
        }

        .login-card h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 2.2em;
            font-weight: 700;
        }

        .login-card p {
            color: var(--text-light);
            margin-bottom: 30px;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .btn-google {
            background: linear-gradient(135deg, #DB4437, #C33C2F);
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn-google::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .btn-google:hover::before {
            left: 100%;
        }

        .btn-google:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(219, 68, 55, 0.4);
            background: linear-gradient(135deg, #C33C2F, #A83227);
        }

        .login-status {
            margin-top: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .login-status p {
            margin: 0;
            font-size: 0.95em;
            color: var(--text-light);
        }

        /* CABEÇALHO DO USUÁRIO */
        .user-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: none;
            align-items: center;
            justify-content: space-between;
            animation: fadeIn 0.5s ease;
        }

        .user-info-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            color: white;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .user-details h3 {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-details p {
            font-size: 0.95em;
            opacity: 0.9;
        }

        .btn-logout {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .btn-logout:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* CABEÇALHO PRINCIPAL */
        .main-header {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: var(--shadow);
            text-align: center;
            border-left: 6px solid var(--primary-color);
            animation: fadeIn 0.6s ease;
        }

        .main-header h1 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 2.8em;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .main-header p {
            color: var(--text-light);
            font-size: 1.2em;
            max-width: 600px;
            margin: 0 auto;
        }

        /* ÁREA DE MENSAGENS */
        .message-area {
            margin-bottom: 30px;
        }

        .message {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
            animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            align-items: center;
            gap: 15px;
            border-left: 5px solid transparent;
        }

        .message.show {
            display: flex;
        }

        .message-success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border-left-color: var(--success-color);
        }

        .message-error {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border-left-color: var(--danger-color);
        }

        .message-warning {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            border-left-color: var(--warning-color);
        }

        .message-info {
            background: linear-gradient(135deg, #d1ecf1, #bee5eb);
            color: #0c5460;
            border-left-color: var(--info-color);
        }

        /* CONTEÚDO PRINCIPAL */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* CARDS */
        .card {
            background: var(--card-color);
            border-radius: 20px;
            padding: 35px;
            box-shadow: var(--shadow);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border-top: 5px solid var(--primary-color);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s ease;
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-hover);
        }

        .card-title {
            color: var(--primary-color);
            margin-bottom: 25px;
            font-size: 1.6em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .card-title i {
            font-size: 1.3em;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ESTATÍSTICAS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.15);
        }

        .stat-number {
            font-size: 2.8em;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 10px;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.95em;
            color: var(--text-light);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* FORMULÁRIOS */
        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 12px;
            font-weight: 700;
            color: var(--text-color);
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-label i {
            color: var(--primary-color);
            font-size: 0.9em;
        }

        .form-control {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s;
            background: #f8f9fa;
            color: var(--text-color);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            background: white;
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.1);
        }

        textarea.form-control {
            min-height: 150px;
            resize: vertical;
            line-height: 1.5;
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%234361ee' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 20px center;
            background-size: 16px;
            padding-right: 50px;
        }

        /* BOTÕES */
        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #218838);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #c82333);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #e0a800);
            color: #212529;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #545b62);
            color: white;
        }

        .btn-sm {
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .btn-block {
            width: 100%;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        /* LISTA DE ADVERTÊNCIAS */
        .advertencias-list {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .advertencia-item {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 6px solid var(--danger-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .advertencia-item:hover {
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.15);
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
        }

        .advertencia-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .advertencia-titulo {
            font-weight: 800;
            color: var(--danger-color);
            font-size: 1.3em;
            line-height: 1.3;
        }

        .advertencia-data {
            font-size: 0.9em;
            color: var(--text-light);
            background: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .advertencia-conteudo {
            color: var(--text-color);
            line-height: 1.7;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .advertencia-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .meta-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .meta-gravidade {
            background: rgba(255, 193, 7, 0.1);
            color: #856404;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .meta-criador {
            background: rgba(23, 162, 184, 0.1);
            color: #0c5460;
            border: 1px solid rgba(23, 162, 184, 0.3);
        }

        .advertencia-acoes {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* STATUS BADGES */
        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .status-ativa {
            background: linear-gradient(135deg, #ffeaea, #ffcccc);
            color: var(--danger-color);
            border: 1px solid rgba(220, 53, 69, 0.3);
        }

        .status-resolvida {
            background: linear-gradient(135deg, #e8f5e9, #d4edda);
            color: var(--success-color);
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9998;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: modalSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            color: var(--danger-color);
            font-size: 1.8em;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.8em;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .modal-close:hover {
            color: var(--danger-color);
            background: rgba(220, 53, 69, 0.1);
        }

        .modal-body {
            margin-bottom: 30px;
        }

        .modal-body p {
            color: var(--text-color);
            font-size: 1.1em;
            line-height: 1.6;
        }

        .modal-footer {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        /* LOADING */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
            font-size: 1.1em;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading::after {
            content: "Carregando";
            animation: dots 1.5s steps(4, end) infinite;
        }

        /* ANIMAÇÕES */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes dots {
            0%, 20% { content: "."; }
            40% { content: ".."; }
            60%, 100% { content: "..."; }
        }

        /* SCROLLBAR PERSONALIZADA */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
        }

        /* RESPONSIVIDADE */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .container {
                padding: 15px;
            }
            
            .login-card {
                padding: 30px 20px;
            }
            
            .login-card h2 {
                font-size: 1.8em;
            }
            
            .main-header {
                padding: 30px 20px;
            }
            
            .main-header h1 {
                font-size: 2.2em;
            }
            
            .card {
                padding: 25px 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .advertencia-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .advertencia-data {
                align-self: flex-start;
            }
            
            .advertencia-acoes {
                flex-direction: column;
            }
            
            .advertencia-acoes .btn {
                width: 100%;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .button-group .btn {
                width: 100%;
            }
            
            .modal-content {
                padding: 30px 20px;
                width: 95%;
            }
        }

        /* UTILITÁRIOS */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .p-20 {
            padding: 20px;
        }

        .border-radius-15 {
            border-radius: 15px;
        }

        .full-width {
            width: 100%;
        }

        .cursor-pointer {
            cursor: pointer;
        }

        .transition-all {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- CONTAINER DE LOGIN -->
    <div id="loginContainer" class="login-container">
        <div class="login-card">
            <h2><i class="fas fa-shield-alt"></i> Sistema de Advertências</h2>
            <p>Faça login com sua conta Google para acessar o sistema de gerenciamento de advertências.</p>
            
            <button id="btnGoogleLogin" class="btn-google">
                <i class="fab fa-google"></i> Entrar com Google
            </button>
            
            <div class="login-status mt-20">
                <p id="loginStatus">Aguardando login...</p>
            </div>
        </div>
    </div>

    <!-- CONTEÚDO PRINCIPAL -->
    <div id="mainContent" class="container hidden">
        <!-- CABEÇALHO DO USUÁRIO -->
        <div id="userHeader" class="user-header hidden">
            <div class="user-info-left">
                <div class="user-avatar" id="userAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-details">
                    <h3 id="currentUserName">Administrador</h3>
                    <p id="currentUserEmail">usuario@email.com</p>
                </div>
            </div>
            <button id="btnLogout" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>

        <!-- CABEÇALHO PRINCIPAL -->
        <div class="main-header">
            <h1><i class="fas fa-exclamation-triangle"></i> Sistema de Advertências</h1>
            <p>Gerencie advertências para usuários do sistema de forma eficiente e organizada</p>
        </div>

        <!-- ÁREA DE MENSAGENS -->
        <div id="messageArea" class="message-area"></div>

        <!-- CONTEÚDO PRINCIPAL -->
        <div class="main-content">
            <!-- PAINEL DE ESTATÍSTICAS E BUSCA -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-chart-line"></i> Estatísticas</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalAdvertencias">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="advertenciasAtivas">0</div>
                        <div class="stat-label">Ativas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="advertenciasResolvidas">0</div>
                        <div class="stat-label">Resolvidas</div>
                    </div>
                </div>

                <div class="mt-20">
                    <h3 style="color: var(--primary-color); margin-bottom: 20px; font-size: 1.2em;">
                        <i class="fas fa-search"></i> Buscar Usuário
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-id-card"></i> UID do Usuário
                        </label>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <input type="text" id="searchUserId" class="form-control" 
                                   placeholder="Cole o UID do usuário aqui">
                            <button id="btnSearchById" class="btn btn-primary">
                                <i class="fas fa-search"></i> Buscar
                            </button>
                        </div>
                        <small style="color: var(--text-light); margin-top: 10px; display: block; font-size: 0.9em;">
                            <i class="fas fa-info-circle"></i> Para encontrar o UID: Acesse a página do usuário no sistema principal e copie da URL
                        </small>
                    </div>
                </div>
            </div>

            <!-- FORMULÁRIO DE ADVERTÊNCIA -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-plus-circle"></i> Nova Advertência</h2>
                
                <form id="advertenciaForm">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-user"></i> Usuário Destino
                        </label>
                        <input type="text" id="userId" class="form-control" 
                               placeholder="UID do usuário" required readonly>
                        <small style="color: var(--text-light); margin-top: 8px; display: block; font-size: 0.9em;">
                            <i class="fas fa-exclamation-circle"></i> Primeiro busque o usuário acima
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-heading"></i> Título da Advertência *
                        </label>
                        <input type="text" id="advertenciaTitulo" class="form-control" 
                               placeholder="Ex: Uso inadequado do sistema" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-align-left"></i> Conteúdo *
                        </label>
                        <textarea id="advertenciaConteudo" class="form-control" 
                                  placeholder="Descreva detalhadamente a advertência, incluindo evidências se disponíveis..." 
                                  rows="6" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-exclamation-triangle"></i> Nível de Gravidade
                        </label>
                        <select id="advertenciaGravidade" class="form-control">
                            <option value="leve">⚠️ Leve - Aviso e orientação</option>
                            <option value="moderada" selected>⚠️⚠️ Moderada - Requer atenção</option>
                            <option value="grave">⚠️⚠️⚠️ Grave - Ação disciplinar necessária</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-flag"></i> Status
                        </label>
                        <select id="advertenciaStatus" class="form-control">
                            <option value="ativa" selected>Ativa - Em vigor</option>
                            <option value="resolvida">Resolvida - Concluída</option>
                        </select>
                    </div>
                    
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar Advertência
                        </button>
                        <button type="button" id="btnLimparForm" class="btn btn-secondary">
                            <i class="fas fa-broom"></i> Limpar Formulário
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- LISTA DE ADVERTÊNCIAS -->
        <div class="card mt-20">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 class="card-title" style="margin: 0;">
                    <i class="fas fa-list"></i> Advertências do Usuário
                </h2>
                <div style="display: flex; gap: 10px;">
                    <button id="btnFiltrarAtivas" class="btn btn-sm btn-danger" onclick="filtrarAdvertencias('ativa')">
                        <i class="fas fa-exclamation-circle"></i> Ativas
                    </button>
                    <button id="btnFiltrarResolvidas" class="btn btn-sm btn-success" onclick="filtrarAdvertencias('resolvida')">
                        <i class="fas fa-check-circle"></i> Resolvidas
                    </button>
                    <button id="btnFiltrarTodas" class="btn btn-sm btn-primary" onclick="filtrarAdvertencias('todas')">
                        <i class="fas fa-list"></i> Todas
                    </button>
                </div>
            </div>
            
            <div id="advertenciasList" class="advertencias-list">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div>Selecione um usuário para ver as advertências...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DE CONFIRMAÇÃO -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-exclamation-triangle"></i> Confirmar Ação</h3>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Tem certeza que deseja realizar esta ação?</p>
            </div>
            <div class="modal-footer">
                <button id="confirmAction" class="btn btn-danger">
                    <i class="fas fa-check"></i> Confirmar
                </button>
                <button onclick="closeModal()" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- FIREBASE E SCRIPTS -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        // ================= CONFIGURAÇÃO DO FIREBASE =================
        const firebaseConfig = {
            apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0",
            authDomain: "wzzm-ce3fc.firebaseapp.com",
            projectId: "wzzm-ce3fc",
            storageBucket: "wzzm-ce3fc.appspot.com",
            messagingSenderId: "249427877153",
            appId: "1:249427877153:web:0e4297294794a5aadeb260",
            measurementId: "G-PLKNZNFCQ8"
        };

        // Inicializar Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log('✅ Firebase inicializado com sucesso');
        } catch (error) {
            console.error('❌ Erro ao inicializar Firebase:', error);
            showMessage('Erro ao conectar ao banco de dados. Recarregue a página.', 'error');
        }

        // Referências do Firebase
        const db = firebase.firestore();
        const auth = firebase.auth();
        const googleProvider = new firebase.auth.GoogleAuthProvider();

        // ================= VARIÁVEIS GLOBAIS =================
        let selectedUserId = null;
        let currentUserAdvertencias = [];
        let currentModalCallback = null;
        let currentUser = null;
        let filtroAtual = 'todas';

        // ================= ELEMENTOS DOM =================
        const loginContainer = document.getElementById('loginContainer');
        const mainContent = document.getElementById('mainContent');
        const userHeader = document.getElementById('userHeader');
        const userAvatar = document.getElementById('userAvatar');
        const currentUserName = document.getElementById('currentUserName');
        const currentUserEmail = document.getElementById('currentUserEmail');
        const loginStatus = document.getElementById('loginStatus');
        const btnGoogleLogin = document.getElementById('btnGoogleLogin');
        const btnLogout = document.getElementById('btnLogout');
        const searchUserId = document.getElementById('searchUserId');
        const btnSearchById = document.getElementById('btnSearchById');
        const userIdInput = document.getElementById('userId');
        const advertenciaForm = document.getElementById('advertenciaForm');
        const advertenciasList = document.getElementById('advertenciasList');
        const messageArea = document.getElementById('messageArea');
        const totalAdvertencias = document.getElementById('totalAdvertencias');
        const advertenciasAtivas = document.getElementById('advertenciasAtivas');
        const advertenciasResolvidas = document.getElementById('advertenciasResolvidas');
        const confirmModal = document.getElementById('confirmModal');
        const confirmMessage = document.getElementById('confirmMessage');
        const confirmAction = document.getElementById('confirmAction');

        // ================= FUNÇÕES DE UTILIDADE =================

        // Função para mostrar mensagens
        function showMessage(text, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;
            messageDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                  type === 'error' ? 'exclamation-circle' : 
                                  type === 'warning' ? 'exclamation-triangle' : 
                                  'info-circle'}"></i>
                <span>${text}</span>
            `;
            
            messageArea.innerHTML = '';
            messageArea.appendChild(messageDiv);
            messageDiv.classList.add('show');
            
            setTimeout(() => {
                messageDiv.classList.remove('show');
                setTimeout(() => {
                    messageArea.innerHTML = '';
                }, 300);
            }, 5000);
        }

        // Função para formatar data
        function formatDate(timestamp) {
            if (!timestamp) return 'Data não registrada';
            try {
                const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
                return date.toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return 'Data inválida';
            }
        }

        // Função para verificar se o usuário é administrador
        async function checkAdminStatus(user) {
            try {
                // Lista de UIDs de administradores
                const adminUIDs = [
                    'sZxfMuOBPbXdR8nttVPXIN8QOOl1', // Adicione seu UID aqui
                    user.uid // Para desenvolvimento, permitir o próprio usuário
                ];
                
                // Verificar se está na lista de UIDs permitidos
                if (adminUIDs.includes(user.uid)) {
                    console.log('✅ Usuário autorizado (UID na lista)');
                    return true;
                }
                
                // Tentar verificar na coleção users
                try {
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        if (userData.isAdmin === true) {
                            console.log('✅ Usuário é administrador');
                            return true;
                        }
                    }
                } catch (dbError) {
                    console.log('ℹ️ Não foi possível verificar na coleção users:', dbError.message);
                }
                
                console.log('❌ Usuário não é administrador');
                return false;
                
            } catch (error) {
                console.error('❌ Erro ao verificar admin:', error);
                return false;
            }
        }

        // ================= FUNÇÕES DE AUTENTICAÇÃO =================

        // Login com Google
        async function loginWithGoogle() {
            try {
                showMessage('Iniciando login com Google...', 'info');
                loginStatus.textContent = 'Abrindo janela de login...';
                
                // Configurar provedor
                googleProvider.addScope('email');
                googleProvider.addScope('profile');
                
                // Fazer login com popup
                const result = await auth.signInWithPopup(googleProvider);
                
                if (result.user) {
                    console.log('✅ Login bem-sucedido:', result.user.email);
                    
                    // Verificar se é administrador
                    const isAdmin = await checkAdminStatus(result.user);
                    
                    if (isAdmin) {
                        showMessage('Login realizado com sucesso! Bem-vindo ao sistema.', 'success');
                        updateUIForUser(result.user);
                    } else {
                        showMessage('Esta conta não tem permissões de administrador.', 'error');
                        await auth.signOut();
                        loginStatus.textContent = 'Permissão negada. Faça login com uma conta de administrador.';
                    }
                }
                
            } catch (error) {
                console.error('❌ Erro no login:', error);
                
                let errorMsg = 'Erro ao fazer login: ';
                if (error.code === 'auth/popup-blocked') {
                    errorMsg = 'O popup foi bloqueado pelo navegador. Permita popups para este site.';
                } else if (error.code === 'auth/popup-closed-by-user') {
                    errorMsg = 'Login cancelado. A janela de login foi fechada.';
                } else if (error.code === 'auth/network-request-failed') {
                    errorMsg = 'Erro de conexão. Verifique sua internet e tente novamente.';
                } else if (error.code === 'auth/unauthorized-domain') {
                    errorMsg = 'Este domínio não está autorizado para fazer login.';
                } else {
                    errorMsg += error.message;
                }
                
                showMessage(errorMsg, 'error');
                loginStatus.textContent = errorMsg;
            }
        }

        // Logout
        async function logout() {
            try {
                showMessage('Fazendo logout...', 'info');
                await auth.signOut();
                showMessage('Logout realizado com sucesso.', 'success');
                
                // Resetar interface
                loginContainer.classList.remove('hidden');
                mainContent.classList.add('hidden');
                userHeader.classList.add('hidden');
                
                // Resetar dados
                selectedUserId = null;
                currentUserAdvertencias = [];
                userIdInput.value = '';
                searchUserId.value = '';
                advertenciasList.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>Selecione um usuário para ver as advertências...</div>
                    </div>
                `;
                updateStatistics();
                
                loginStatus.textContent = 'Desconectado';
                
            } catch (error) {
                console.error('❌ Erro ao fazer logout:', error);
                showMessage('Erro ao fazer logout: ' + error.message, 'error');
            }
        }

        // Atualizar interface para usuário logado
        function updateUIForUser(user) {
            currentUser = user;
            
            // Esconder login e mostrar conteúdo principal
            loginContainer.classList.add('hidden');
            mainContent.classList.remove('hidden');
            userHeader.classList.remove('hidden');
            
            // Atualizar informações do usuário
            currentUserName.textContent = user.displayName || 'Administrador';
            currentUserEmail.textContent = user.email;
            
            // Atualizar avatar
            if (user.photoURL) {
                userAvatar.innerHTML = `<img src="${user.photoURL}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
            } else {
                const initials = (user.displayName || 'A').charAt(0).toUpperCase();
                userAvatar.innerHTML = `<span style="font-size:1.2em;">${initials}</span>`;
            }
            
            loginStatus.textContent = `Logado como: ${user.email}`;
        }

        // ================= FUNÇÕES DE BUSCA E GESTÃO =================

        // Buscar usuário por UID
        async function searchUserById(uid) {
            if (!uid) {
                showMessage('Por favor, digite um UID para buscar.', 'warning');
                return null;
            }

            try {
                showMessage('Buscando usuário...', 'info');
                
                // Buscar na coleção userpage
                const userPageRef = db.collection('userpage').doc(uid);
                const userDoc = await userPageRef.get();
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    
                    return {
                        uid: uid,
                        name: userData.dadosCadastro?.nomeCompleto || 
                              userData.criadorNome || 
                              'Usuário',
                        email: userData.dadosCadastro?.email || 
                               userData.criadorEmail || 
                               'Email não informado',
                        hasUserPage: true
                    };
                } else {
                    // Usuário não tem página ainda
                    showMessage('Usuário não possui página criada. Você ainda pode adicionar advertências.', 'warning');
                    
                    return {
                        uid: uid,
                        name: 'Usuário sem página',
                        email: 'Não disponível',
                        hasUserPage: false
                    };
                }

            } catch (error) {
                console.error('❌ Erro ao buscar usuário:', error);
                
                if (error.code === 'permission-denied') {
                    showMessage('Permissão negada para buscar usuários.', 'error');
                } else if (error.code === 'not-found') {
                    showMessage('Usuário não encontrado. Verifique o UID.', 'warning');
                } else {
                    showMessage('Erro: ' + error.message, 'error');
                }
                
                return null;
            }
        }

        // Selecionar usuário
        async function selectUser(user) {
            selectedUserId = user.uid;
            userIdInput.value = user.uid;
            
            // Atualizar placeholder do campo de busca
            searchUserId.placeholder = `UID: ${user.uid.substring(0, 12)}...`;
            
            // Carregar advertências
            await loadUserAdvertencias(user.uid);
            
            showMessage(`Usuário "${user.name || user.uid}" selecionado com sucesso!`, 'success');
        }

        // Carregar advertências do usuário
        async function loadUserAdvertencias(userId) {
            try {
                advertenciasList.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>Carregando advertências...</div>
                    </div>
                `;
                
                const userPageRef = db.collection('userpage').doc(userId);
                const userPageDoc = await userPageRef.get();
                
                if (!userPageDoc.exists) {
                    advertenciasList.innerHTML = `
                        <div class="message message-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <strong>Este usuário não possui página ainda.</strong>
                                <p style="margin-top: 5px; font-size: 0.9em;">
                                    Você ainda pode adicionar advertências - elas serão criadas automaticamente.
                                </p>
                            </div>
                        </div>
                    `;
                    currentUserAdvertencias = [];
                    updateStatistics();
                    return;
                }

                const userPageData = userPageDoc.data();
                currentUserAdvertencias = userPageData.advertências || [];
                
                displayAdvertencias(currentUserAdvertencias);
                updateStatistics();

            } catch (error) {
                console.error('❌ Erro ao carregar advertências:', error);
                advertenciasList.innerHTML = `
                    <div class="message message-error">
                        <i class="fas fa-exclamation-circle"></i>
                        <div>
                            <strong>Erro ao carregar advertências</strong>
                            <p style="margin-top: 5px; font-size: 0.9em;">${error.message}</p>
                        </div>
                    </div>
                `;
            }
        }

        // Exibir advertências
        function displayAdvertencias(advertencias) {
            if (!advertencias || advertencias.length === 0) {
                advertenciasList.innerHTML = `
                    <div class="message message-info">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>Nenhuma advertência encontrada</strong>
                            <p style="margin-top: 5px; font-size: 0.9em;">
                                Este usuário não possui advertências registradas.
                            </p>
                        </div>
                    </div>
                `;
                return;
            }

            // Ordenar por data (mais recente primeiro)
            advertencias.sort((a, b) => {
                const dateA = a.data ? (a.data.toDate ? a.data.toDate() : new Date(a.data)) : new Date(0);
                const dateB = b.data ? (b.data.toDate ? b.data.toDate() : new Date(b.data)) : new Date(0);
                return dateB - dateA;
            });

            let html = '';
            
            advertencias.forEach((advertencia, index) => {
                // Aplicar filtro
                if (filtroAtual !== 'todas' && advertencia.status !== filtroAtual) {
                    return;
                }
                
                const data = advertencia.data ? formatDate(advertencia.data) : 'Data não registrada';
                const gravidade = advertencia.gravidade || 'moderada';
                const status = advertencia.status || 'ativa';
                const criador = advertencia.criador || { nome: 'Sistema', email: 'sistema' };
                
                // Definir ícone e texto da gravidade
                let gravidadeIcon = '⚠️';
                let gravidadeText = 'Moderada';
                let gravidadeClass = 'meta-gravidade';
                
                switch(gravidade) {
                    case 'leve':
                        gravidadeIcon = 'ℹ️';
                        gravidadeText = 'Leve';
                        gravidadeClass = 'meta-gravidade';
                        break;
                    case 'grave':
                        gravidadeIcon = '🚨';
                        gravidadeText = 'Grave';
                        gravidadeClass = 'meta-gravidade';
                        break;
                }
                
                html += `
                    <div class="advertencia-item" data-status="${status}" data-index="${index}">
                        <div class="advertencia-header">
                            <div>
                                <div class="advertencia-titulo">${advertencia.titulo || 'Advertência sem título'}</div>
                                <div class="advertencia-meta">
                                    <span class="meta-badge ${gravidadeClass}">
                                        ${gravidadeIcon} ${gravidadeText}
                                    </span>
                                    <span class="meta-badge meta-criador">
                                        <i class="fas fa-user-shield"></i> ${criador.nome}
                                    </span>
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 10px;">
                                <div class="advertencia-data">
                                    <i class="far fa-calendar"></i> ${data}
                                </div>
                                <span class="status-badge status-${status}">
                                    ${status === 'ativa' ? '⏳ Ativa' : '✅ Resolvida'}
                                </span>
                            </div>
                        </div>
                        
                        <div class="advertencia-conteudo">
                            ${advertencia.conteudo || 'Sem conteúdo detalhado.'}
                        </div>
                        
                        <div class="advertencia-acoes">
                            <button onclick="toggleAdvertenciaStatus(${index})" class="btn btn-sm ${status === 'ativa' ? 'btn-success' : 'btn-warning'}">
                                <i class="fas fa-${status === 'ativa' ? 'check' : 'undo'}"></i>
                                ${status === 'ativa' ? 'Marcar como Resolvida' : 'Marcar como Ativa'}
                            </button>
                            <button onclick="deleteAdvertencia(${index})" class="btn btn-sm btn-danger">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                            <button onclick="verDetalhesAdvertencia(${index})" class="btn btn-sm btn-secondary">
                                <i class="fas fa-eye"></i> Detalhes
                            </button>
                        </div>
                    </div>
                `;
            });

            advertenciasList.innerHTML = html;
            
            // Se não houver advertências após filtrar
            if (advertenciasList.innerHTML === '') {
                advertenciasList.innerHTML = `
                    <div class="message message-info">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>Nenhuma advertência ${filtroAtual === 'ativa' ? 'ativa' : 'resolvida'}</strong>
                            <p style="margin-top: 5px; font-size: 0.9em;">
                                Não há advertências ${filtroAtual === 'ativa' ? 'ativas' : 'resolvidas'} para este usuário.
                            </p>
                        </div>
                    </div>
                `;
            }
        }

        // Filtrar advertências
        function filtrarAdvertencias(filtro) {
            filtroAtual = filtro;
            displayAdvertencias(currentUserAdvertencias);
            
            // Atualizar botões ativos
            document.getElementById('btnFiltrarTodas').classList.remove('btn-primary');
            document.getElementById('btnFiltrarAtivas').classList.remove('btn-danger');
            document.getElementById('btnFiltrarResolvidas').classList.remove('btn-success');
            
            document.getElementById('btnFiltrarTodas').classList.add('btn-secondary');
            document.getElementById('btnFiltrarAtivas').classList.add('btn-secondary');
            document.getElementById('btnFiltrarResolvidas').classList.add('btn-secondary');
            
            if (filtro === 'todas') {
                document.getElementById('btnFiltrarTodas').classList.remove('btn-secondary');
                document.getElementById('btnFiltrarTodas').classList.add('btn-primary');
            } else if (filtro === 'ativa') {
                document.getElementById('btnFiltrarAtivas').classList.remove('btn-secondary');
                document.getElementById('btnFiltrarAtivas').classList.add('btn-danger');
            } else if (filtro === 'resolvida') {
                document.getElementById('btnFiltrarResolvidas').classList.remove('btn-secondary');
                document.getElementById('btnFiltrarResolvidas').classList.add('btn-success');
            }
        }

        // Atualizar estatísticas
        function updateStatistics() {
            const total = currentUserAdvertencias.length;
            const ativas = currentUserAdvertencias.filter(a => a.status === 'ativa').length;
            const resolvidas = total - ativas;
            
            totalAdvertencias.textContent = total;
            advertenciasAtivas.textContent = ativas;
            advertenciasResolvidas.textContent = resolvidas;
        }

        // ================= FUNÇÕES CRUD DE ADVERTÊNCIAS =================

        // Adicionar nova advertência
        async function addAdvertencia(userId, advertenciaData) {
            try {
                showMessage('Adicionando advertência...', 'info');
                
                const userPageRef = db.collection('userpage').doc(userId);
                
                // Buscar página existente
                const userPageDoc = await userPageRef.get();
                let advertências = [];
                let userData = {};
                
                if (userPageDoc.exists) {
                    userData = userPageDoc.data();
                    advertências = userData.advertências || [];
                }
                
                // Criar objeto da advertência
                const novaAdvertencia = {
                    titulo: advertenciaData.titulo,
                    conteudo: advertenciaData.conteudo,
                    gravidade: advertenciaData.gravidade,
                    status: advertenciaData.status,
                    data: firebase.firestore.FieldValue.serverTimestamp(),
                    criador: {
                        id: currentUser.uid,
                        nome: currentUser.displayName || 'Administrador',
                        email: currentUser.email
                    }
                };
                
                // Adicionar ao array
                advertências.push(novaAdvertencia);
                
                // Preparar dados para atualização
                const updateData = {
                    advertências: advertências,
                    atualizadoEm: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Se não existir a página, criar estrutura básica
                if (!userPageDoc.exists) {
                    updateData.titulo = `Página de Usuário`;
                    updateData.descricao = 'Página criada automaticamente pelo sistema de advertências';
                    updateData.criadorId = 'sistema';
                    updateData.criadorNome = 'Sistema de Advertências';
                    updateData.criadoEm = firebase.firestore.FieldValue.serverTimestamp();
                    updateData.restrito = true;
                    updateData.tipo = 'userpage';
                    updateData.dadosCadastro = {
                        nomeCompleto: 'Usuário não cadastrado',
                        email: 'Não disponível',
                        dataCadastro: firebase.firestore.FieldValue.serverTimestamp()
                    };
                }
                
                // Salvar no Firestore
                await userPageRef.set(updateData, { merge: true });
                
                // Recarregar lista
                await loadUserAdvertencias(userId);
                
                showMessage('✅ Advertência adicionada com sucesso!', 'success');
                return true;

            } catch (error) {
                console.error('❌ Erro ao adicionar advertência:', error);
                showMessage('❌ Erro ao adicionar advertência: ' + error.message, 'error');
                return false;
            }
        }

        // Alternar status da advertência
        async function toggleAdvertenciaStatus(index) {
            if (index < 0 || index >= currentUserAdvertencias.length) return;
            
            try {
                const advertencia = currentUserAdvertencias[index];
                const novoStatus = advertencia.status === 'ativa' ? 'resolvida' : 'ativa';
                
                // Atualizar localmente
                currentUserAdvertencias[index].status = novoStatus;
                
                // Atualizar no Firestore
                const userPageRef = db.collection('userpage').doc(selectedUserId);
                await userPageRef.update({
                    advertências: currentUserAdvertencias,
                    atualizadoEm: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showMessage(`✅ Advertência marcada como ${novoStatus === 'ativa' ? 'ativa' : 'resolvida'}!`, 'success');
                
                // Atualizar exibição
                displayAdvertencias(currentUserAdvertencias);
                updateStatistics();

            } catch (error) {
                console.error('❌ Erro ao atualizar status:', error);
                showMessage('❌ Erro ao atualizar status da advertência.', 'error');
            }
        }

        // Excluir advertência
        async function deleteAdvertencia(index) {
            if (index < 0 || index >= currentUserAdvertencias.length) return;
            
            const advertencia = currentUserAdvertencias[index];
            
            openModal(
                `Tem certeza que deseja excluir a advertência "<strong>${advertencia.titulo || 'Sem título'}</strong>"?`,
                async () => {
                    try {
                        showMessage('Excluindo advertência...', 'info');
                        
                        // Remover do array local
                        currentUserAdvertencias.splice(index, 1);
                        
                        // Atualizar no Firestore
                        const userPageRef = db.collection('userpage').doc(selectedUserId);
                        await userPageRef.update({
                            advertências: currentUserAdvertencias,
                            atualizadoEm: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        showMessage('✅ Advertência excluída com sucesso!', 'success');
                        
                        // Atualizar exibição
                        displayAdvertencias(currentUserAdvertencias);
                        updateStatistics();

                    } catch (error) {
                        console.error('❌ Erro ao excluir advertência:', error);
                        showMessage('❌ Erro ao excluir advertência.', 'error');
                    }
                }
            );
        }

        // Ver detalhes da advertência
        function verDetalhesAdvertencia(index) {
            if (index < 0 || index >= currentUserAdvertencias.length) return;
            
            const advertencia = currentUserAdvertencias[index];
            const data = advertencia.data ? formatDate(advertencia.data) : 'Não registrada';
            const criador = advertencia.criador || { nome: 'Sistema', email: 'sistema' };
            
            let gravidadeText = '';
            switch(advertencia.gravidade) {
                case 'leve': gravidadeText = 'Leve (Aviso)'; break;
                case 'moderada': gravidadeText = 'Moderada (Atenção)'; break;
                case 'grave': gravidadeText = 'Grave (Urgente)'; break;
                default: gravidadeText = 'Não especificada';
            }
            
            openModal(
                `<div>
                    <h4 style="color: var(--danger-color); margin-bottom: 15px;">${advertencia.titulo || 'Advertência sem título'}</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <p><strong>Conteúdo:</strong></p>
                        <p>${advertencia.conteudo || 'Sem conteúdo.'}</p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <div>
                            <p><strong>📅 Data:</strong></p>
                            <p>${data}</p>
                        </div>
                        <div>
                            <p><strong>⚖️ Gravidade:</strong></p>
                            <p>${gravidadeText}</p>
                        </div>
                        <div>
                            <p><strong>📊 Status:</strong></p>
                            <p>${advertencia.status === 'ativa' ? '⏳ Ativa' : '✅ Resolvida'}</p>
                        </div>
                        <div>
                            <p><strong>👤 Criador:</strong></p>
                            <p>${criador.nome}</p>
                        </div>
                    </div>
                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #dee2e6;">
                        <p style="font-size: 0.9em; color: var(--text-light);">
                            <i class="fas fa-info-circle"></i> Advertência ${index + 1} de ${currentUserAdvertencias.length}
                        </p>
                    </div>
                </div>`,
                null,
                'lg'
            );
        }

        // ================= FUNÇÕES DO MODAL =================

        function openModal(message, callback, size = 'md') {
            currentModalCallback = callback;
            confirmMessage.innerHTML = message;
            
            // Ajustar tamanho do modal
            const modalContent = confirmModal.querySelector('.modal-content');
            if (size === 'lg') {
                modalContent.style.maxWidth = '700px';
            } else {
                modalContent.style.maxWidth = '500px';
            }
            
            confirmModal.classList.add('active');
            
            // Mostrar ou esconder botão de confirmação
            if (callback) {
                confirmAction.style.display = 'flex';
            } else {
                confirmAction.style.display = 'none';
            }
        }

        function closeModal() {
            confirmModal.classList.remove('active');
            currentModalCallback = null;
        }

        // ================= LIMPAR FORMULÁRIO =================

        function limparFormulario() {
            document.getElementById('advertenciaTitulo').value = '';
            document.getElementById('advertenciaConteudo').value = '';
            document.getElementById('advertenciaGravidade').value = 'moderada';
            document.getElementById('advertenciaStatus').value = 'ativa';
            showMessage('Formulário limpo com sucesso!', 'info');
        }

        // ================= CONFIGURAR EVENT LISTENERS =================

        function setupEventListeners() {
            // Buscar por UID
            btnSearchById.addEventListener('click', async () => {
                const uid = searchUserId.value.trim();
                if (!uid) {
                    showMessage('Por favor, digite um UID para buscar.', 'warning');
                    return;
                }
                
                const user = await searchUserById(uid);
                if (user) {
                    await selectUser(user);
                }
            });
            
            // Permitir busca com Enter
            searchUserId.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    btnSearchById.click();
                }
            });
            
            // Formulário de advertência
            advertenciaForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                if (!selectedUserId) {
                    showMessage('Por favor, selecione um usuário primeiro.', 'warning');
                    return;
                }
                
                const titulo = document.getElementById('advertenciaTitulo').value.trim();
                const conteudo = document.getElementById('advertenciaConteudo').value.trim();
                const gravidade = document.getElementById('advertenciaGravidade').value;
                const status = document.getElementById('advertenciaStatus').value;
                
                if (!titulo || !conteudo) {
                    showMessage('Por favor, preencha título e conteúdo.', 'warning');
                    return;
                }
                
                if (titulo.length < 5) {
                    showMessage('O título deve ter pelo menos 5 caracteres.', 'warning');
                    return;
                }
                
                if (conteudo.length < 10) {
                    showMessage('O conteúdo deve ter pelo menos 10 caracteres.', 'warning');
                    return;
                }
                
                const advertenciaData = {
                    titulo,
                    conteudo,
                    gravidade,
                    status
                };
                
                const success = await addAdvertencia(selectedUserId, advertenciaData);
                if (success) {
                    limparFormulario();
                }
            });
            
            // Botão limpar formulário
            document.getElementById('btnLimparForm').addEventListener('click', limparFormulario);
            
            // Confirmar ação no modal
            confirmAction.addEventListener('click', () => {
                if (currentModalCallback) {
                    currentModalCallback();
                }
                closeModal();
            });
            
            // Fechar modal ao clicar fora
            confirmModal.addEventListener('click', (e) => {
                if (e.target === confirmModal) {
                    closeModal();
                }
            });
            
            // Fechar modal com ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && confirmModal.classList.contains('active')) {
                    closeModal();
                }
            });
        }

        // ================= MONITORAR ESTADO DE AUTENTICAÇÃO =================

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                console.log('✅ Usuário logado:', user.email);
                loginStatus.textContent = `Logado como: ${user.email}`;
                
                // Verificar se é administrador
                const isAdmin = await checkAdminStatus(user);
                
                if (isAdmin) {
                    updateUIForUser(user);
                    setupEventListeners();
                    showMessage(`Bem-vindo, ${user.displayName || user.email}!`, 'success');
                } else {
                    showMessage('❌ Você não tem permissão para acessar este sistema.', 'error');
                    loginStatus.textContent = 'Acesso negado: não é administrador';
                    
                    // Fazer logout após 3 segundos
                    setTimeout(() => {
                        if (auth.currentUser) {
                            auth.signOut();
                        }
                    }, 3000);
                }
            } else {
                console.log('ℹ️ Nenhum usuário logado');
                loginContainer.classList.remove('hidden');
                mainContent.classList.add('hidden');
                userHeader.classList.add('hidden');
                loginStatus.textContent = 'Não logado';
            }
        });

        // ================= INICIALIZAR EVENT LISTENERS =================

        btnGoogleLogin.addEventListener('click', loginWithGoogle);
        btnLogout.addEventListener('click', logout);

        // ================= FUNÇÕES GLOBAIS =================

        window.toggleAdvertenciaStatus = toggleAdvertenciaStatus;
        window.deleteAdvertencia = deleteAdvertencia;
        window.closeModal = closeModal;
        window.verDetalhesAdvertencia = verDetalhesAdvertencia;
        window.filtrarAdvertencias = filtrarAdvertencias;

        // ================= INICIALIZAÇÃO =================

        // Mostrar status inicial
        setTimeout(() => {
            if (!auth.currentUser) {
                loginStatus.textContent = 'Pronto para fazer login...';
            }
        }, 1000);

        // Tratar resultado de login por redirect
        auth.getRedirectResult().then((result) => {
            if (result.user) {
                console.log('✅ Login por redirect bem-sucedido:', result.user.email);
            }
        }).catch((error) => {
            console.error('❌ Erro no redirect:', error);
        });
    </script>
</body>
</html>
