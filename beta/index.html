<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WZZM - Sistema Operacional Web</title>
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    
    <style>
        /* --------------------------------------------------------------------------------- */
        /* ESTILOS GERAIS */
        /* --------------------------------------------------------------------------------- */
        
        body {
            font-family: 'Noto Sans', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden; 
        }
        
        #windows-desktop {
            width: 100vw;
            height: 100vh;
            background-color: #3f51b5; 
            background-image: linear-gradient(45deg, rgba(255,255,255,.05) 25%, transparent 25%, transparent 50%, rgba(255,255,255,.05) 50%, rgba(255,255,255,.05) 75%, transparent 75%, transparent);
            background-size: 40px 40px;
            position: relative;
            display: block; 
            box-sizing: border-box;
        }

        /* --------------------------------------------------------------------------------- */
        /* ÍCONES DO DESKTOP */
        /* --------------------------------------------------------------------------------- */
        #desktop-icons {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 80px;
            margin-bottom: 15px;
            text-align: center;
            color: white;
            text-shadow: 1px 1px 2px #000;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.1s;
            padding: 5px;
            border: 1px solid transparent;
        }
        
        .desktop-icon:hover {
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 5px;
        }

        .desktop-icon .material-icons {
            font-size: 40px;
            margin-bottom: 5px;
        }

        /* --------------------------------------------------------------------------------- */
        /* TASKBAR E START MENU */
        /* --------------------------------------------------------------------------------- */
        
        #windows-taskbar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background-color: #c0c0c0;
            border-top: 2px solid #fff;
            display: flex;
            align-items: center;
            padding: 0 5px;
            box-shadow: 0 -1px 3px rgba(0,0,0,0.5);
            z-index: 1000;
        }

        #start-button {
            position: relative; 
            background-color: #000080; 
            color: white;
            padding: 5px 10px;
            border-right: 2px solid #000;
            border-bottom: 2px solid #000;
            border-left: 2px solid #fff;
            border-top: 2px solid #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-weight: bold;
            margin-right: 10px;
            font-size: 0.9em;
        }

        #start-button.active {
            border-style: inset;
            border-color: #000 #fff #fff #000;
        }

        #start-menu {
            position: absolute;
            bottom: 40px; 
            left: 0;
            width: 250px;
            background-color: #c0c0c0;
            border: 2px solid #fff;
            border-bottom: none;
            box-shadow: 4px 4px 0 #000;
            display: none; 
            flex-direction: column;
            z-index: 999;
        }

        .start-menu-item {
            padding: 8px 15px;
            display: flex;
            align-items: center;
            color: #000;
            text-decoration: none;
            cursor: pointer;
            transition: background-color 0.1s;
        }

        .start-menu-item:hover {
            background-color: #000080;
            color: white;
        }

        .start-menu-item .material-icons {
            margin-right: 10px;
            font-size: 20px;
        }
        
        .submenu-container {
            position: relative;
        }
        
        .submenu-container .start-menu-item.has-submenu {
            justify-content: space-between;
        }

        .submenu {
            position: absolute;
            left: 100%; 
            bottom: 0; 
            width: 200px;
            background-color: #c0c0c0;
            border: 2px solid #fff;
            box-shadow: 4px 4px 0 #000;
            display: none; 
            flex-direction: column;
        }

        .submenu-container:hover .submenu {
            display: flex;
        }

        .start-menu-divider {
            height: 2px;
            background-color: #808080;
            border-top: 1px solid #fff;
            margin: 5px 0;
        }

        /* --------------------------------------------------------------------------------- */
        /* JANELAS E IFRAME */
        /* --------------------------------------------------------------------------------- */

        .window-frame {
            position: absolute;
            background-color: #f0f0f0; 
            border: 1px solid #000;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.5); 
            min-width: 300px;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            z-index: 10;
            resize: both; 
            overflow: hidden;
        }
        
        .window-content {
            padding: 0; /* Remove padding padrão para o iframe */
            overflow: auto;
            flex-grow: 1;
            display: block;
        }
        
        /* Estilo para a Janela de Artigos (IFRAME) */
        #window-artigos .window-content {
             padding: 0;
             display: flex;
        }
        
        #artigos-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Estilos de barra de título, controles, etc. (mantidos) */
        .window-title-bar {
            background-color: #005fb8; 
            color: white;
            padding: 5px 10px;
            cursor: move; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            flex-shrink: 0;
            user-select: none;
        }

        .window-controls button {
            background-color: #c0c0c0;
            border: 1px solid #000;
            padding: 0 5px;
            margin-left: 5px;
            cursor: pointer;
            font-size: 1em;
            line-height: 1;
            width: 25px;
            height: 25px;
            font-weight: bold;
            box-shadow: 1px 1px 0 #000;
        }
        
        .window-controls button:active {
            box-shadow: inset 1px 1px 1px rgba(0,0,0,0.5);
        }

        .close-btn {
            background-color: #d32f2f !important;
            color: white;
            border-color: #9a0007;
        }
        
    </style>
</head>
<body>

    <div id="windows-desktop">
    
        <div id="desktop-icons">
            <div id="icon-artigos" class="desktop-icon" data-window-id="window-artigos">
                <span class="material-icons">folder</span>
                Artigos
            </div>
            <div id="icon-lixeira" class="desktop-icon" data-window-id="window-lixeira">
                <span class="material-icons">delete</span>
                Lixeira
            </div>
            <div id="icon-documentos" class="desktop-icon" data-window-id="window-documentos">
                <span class="material-icons">description</span>
                Documentos
            </div>
            <div id="icon-sobre" class="desktop-icon" data-window-id="window-sobre">
                <span class="material-icons">info</span>
                Sobre WNPX
            </div>
        </div>

        <div id="windows-taskbar">
            <button id="start-button">
                <span class="material-icons">laptop_windows</span> WZZM OS
            </button>
            
            <div id="start-menu">
                
                <div class="submenu-container">
                    <div class="start-menu-item has-submenu">
                        <span class="material-icons">apps</span> Programas <span class="material-icons" style="margin-left: auto;">chevron_right</span>
                    </div>
                    <div class="submenu">
                        <div class="start-menu-item" data-window-id="window-artigos">
                            <span class="material-icons">article</span> Artigos Recentes
                        </div>
                        <div class="start-menu-item" data-window-id="window-novo-artigo">
                            <span class="material-icons">add_box</span> Criar Artigo
                        </div>
                        <div class="start-menu-item" data-window-id="window-buscar-artigos">
                            <span class="material-icons">search</span> Buscar Artigos
                        </div>
                        <div class="start-menu-item" data-window-id="window-busca-avancada">
                            <span class="material-icons">filter_alt</span> Busca Avançada
                        </div>
                    </div>
                </div>

                <div class="start-menu-item" data-window-id="window-configuracoes">
                    <span class="material-icons">settings</span> Configurações
                </div>

                <div class="start-menu-item" data-window-id="window-pagina-usuario">
                    <span class="material-icons">account_circle</span> Usuário
                </div>
                
                <div class="start-menu-divider"></div>
                
                <div id="start-menu-logout" class="start-menu-item">
                    <span class="material-icons">power_settings_new</span> Desligar
                </div>
            </div>

            <div class="taskbar-apps">
                </div>
        </div>

        <div id="windows-container">

            <div id="window-artigos" class="window-frame" data-content-id="artigos-pane" style="display: none;">
                <div class="window-title-bar">
                    <span class="window-title">WikiNotpedia - wazzimagiygg.com</span>
                    <div class="window-controls">
                        <button class="control-button minimize-btn" title="Minimizar">_</button>
                        <button class="control-button close-btn" title="Fechar">X</button>
                    </div>
                </div>
                <div class="window-content">
                    <iframe id="artigos-iframe" src="https://wazzimagiygg.com/wikinotpedia.html" frameborder="0"></iframe>
                </div>
            </div>
            
            <div id="window-lixeira" class="window-frame" data-content-id="lixeira-pane" style="width: 400px; height: 300px; left: 150px; top: 100px; display: none;">
                <div class="window-title-bar">
                    <span class="window-title">Lixeira</span>
                    <div class="window-controls">
                        <button class="control-button minimize-btn" title="Minimizar">_</button>
                        <button class="control-button close-btn" title="Fechar">X</button>
                    </div>
                </div>
                <div class="window-content" style="padding: 10px;">
                    <p>A lixeira está vazia.</p>
                    <p>Itens removidos apareceriam aqui.</p>
                </div>
            </div>
            
            <div id="window-documentos" class="window-frame" data-content-id="documentos-pane" style="width: 600px; height: 400px; left: 100px; top: 150px; display: none;">
                <div class="window-title-bar">
                    <span class="window-title">Documentos</span>
                    <div class="window-controls">
                        <button class="control-button minimize-btn" title="Minimizar">_</button>
                        <button class="control-button close-btn" title="Fechar">X</button>
                    </div>
                </div>
                <div class="window-content" style="padding: 10px;">
                    <h3>Meus Documentos</h3>
                    <ul id="documentos-list">
                        <li><span class="material-icons">folder_open</span> Configurações de Usuário</li>
                        <li><span class="material-icons">insert_drive_file</span> Meu Artigo Rascunho.txt</li>
                        <li><span class="material-icons">cloud</span> Backups na Nuvem</li>
                    </ul>
                </div>
            </div>

            <div id="window-sobre" class="window-frame" data-content-id="sobre-pane" style="width: 350px; height: 250px; left: 200px; top: 50px; display: none;">
                <div class="window-title-bar">
                    <span class="window-title">Sobre o WNPX</span>
                    <div class="window-controls">
                        <button class="control-button minimize-btn" title="Minimizar">_</button>
                        <button class="control-button close-btn" title="Fechar">X</button>
                    </div>
                </div>
                <div class="window-content" style="padding: 10px; text-align: center;">
                    <span class="material-icons" style="font-size: 50px; color: #3f51b5;">laptop_windows</span>
                    <h3>WZZM OS v1.0</h3>
                    <p>Sistema Operacional Web para gerenciamento de Artigos.</p>
                    <p>&copy; 2024 - Todos os direitos reservados.</p>
                </div>
            </div>

            <div id="window-configuracoes" class="window-frame" data-content-id="configuracoes-pane" style="width: 500px; height: 400px; left: 250px; top: 200px; display: none;">
                <div class="window-title-bar">
                    <span class="window-title">Configurações do Sistema</span>
                    <div class="window-controls">
                        <button class="control-button minimize-btn" title="Minimizar">_</button>
                        <button class="control-button close-btn" title="Fechar">X</button>
                    </div>
                </div>
                <div class="window-content" style="padding: 10px;">
                    <h2>Configurações</h2>
                    <p>Opções de temas, notificações e permissões do sistema.</p>
                    <div class="mdl-switch mdl-js-switch mdl-js-ripple-effect">
                        <input type="checkbox" id="switch-dark-mode" class="mdl-switch__input">
                        <label class="mdl-switch__label" for="switch-dark-mode">Modo Escuro (Em Breve)</label>
                    </div>
                </div>
            </div>
            
            <div id="window-novo-artigo" class="window-frame" data-content-id="novo-artigo" style="width: 600px; height: 550px; left: 150px; top: 150px; display: none;">
                 <div class="window-title-bar">
                    <span class="window-title">Criar Novo Artigo - WZZM</span>
                    <div class="window-controls">
                        <button class="control-button minimize-btn" title="Minimizar">_</button>
                        <button class="control-button close-btn" title="Fechar">X</button>
                    </div>
                </div>
                <div class="window-content" style="padding: 10px;">
                    <div id="novo-artigo" class="content-pane" style="display: block;">
                        <form id="form-novo-artigo"><h2>Criar Novo Artigo</h2></form>
                    </div>
                </div>
            </div>
            
             <div id="window-pagina-usuario" class="window-frame" data-content-id="pagina-usuario" style="width: 700px; height: 550px; left: 200px; top: 200px; display: none;">
                <div class="window-title-bar">
                    <span class="window-title" id="user-window-title">Meu Perfil - WZZM</span>
                    <div class="window-controls">
                        <button class="control-button minimize-btn" title="Minimizar">_</button>
                        <button class="control-button close-btn" title="Fechar">X</button>
                    </div>
                </div>
                <div class="window-content" style="padding: 10px;">
                    <div id="pagina-usuario" class="content-pane" style="display: block;">
                         <div class="user-header"> 
                            <h1 id="user-display-name" style="margin: 0;">Usuário Local</h1> 
                            <p id="user-role" style="color: #72777d; margin: 5px 0 0 0;">Cargo: Administrador Simulado</p>
                            <div class="user-tabs" style="margin-top: 1em;"> 
                                <button class="tab-button active" data-tab="contribuicoes">Minhas Contribuições</button> 
                                <button class="tab-button" data-tab="pagina-pessoal">Página Pessoal</button> 
                                <button class="tab-button" data-tab="discussao">Discussão</button> 
                            </div> 
                        </div>  
                        <div id="contribuicoes-tab" class="tab-content" style="display: block;"> <h3 style="margin-top: 0;">Últimas Contribuições</h3> <ul id="contribuicoesLista"> <p style="text-align: center; color: #888;">Nenhuma contribuição no modo offline.</p> </ul> </div>  
                        <div id="pagina-pessoal-tab" class="tab-content" style="display: none;"> <h3 style="margin-top: 0;">Minha Página</h3> <textarea id="pagina-pessoal-textarea" rows="20"></textarea> <div style="margin-top: 10px;"> <button id="salvar-pagina-pessoal">Salvar</button> <button id="cancelar-pagina-pessoal">Cancelar</button> </div> </div>  
                        <div id="discussao-tab" class="tab-content" style="display: none;"> <h3 style="margin-top: 0;">Mensagens e Notificações</h3> <div id="lista-mensagens"> <p style="text-align: center; color: #888;">Nenhuma mensagem nova.</p> </div> </div>
                    </div>
                </div>
            </div>
            
            </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Inicialização do Firebase (sem autenticação)
        const firebaseConfig = { /* ... */ };
        if (firebase.apps.length === 0) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // Elementos da interface
        const windowsDesktop = document.getElementById('windows-desktop');
        const startButton = document.getElementById('start-button');
        const startMenu = document.getElementById('start-menu');
        const startMenuLogout = document.getElementById('start-menu-logout');
        const desktopIcons = document.querySelectorAll('.desktop-icon');
        const taskbarApps = document.querySelector('.taskbar-apps');
        const desktopHeight = windowsDesktop.clientHeight;
        
        let zIndexCounter = 10;
        let activeWindow = null;

        // --- FUNÇÕES DE GERENCIAMENTO DE JANELAS ---
        
        function bringToFront(windowElement) {
            if (activeWindow && activeWindow !== windowElement) {
                // Remove o destaque do botão anterior
                const oldWindowId = activeWindow.id;
                const oldTaskbarItem = taskbarApps.querySelector(`[data-window-id="${oldWindowId}"]`);
                if (oldTaskbarItem) {
                    oldTaskbarItem.classList.remove('active');
                }
            }

            zIndexCounter++;
            windowElement.style.zIndex = zIndexCounter;
            activeWindow = windowElement;

            // Adiciona o destaque ao novo botão ativo
            const windowId = windowElement.id;
            const taskbarButton = taskbarApps.querySelector(`[data-window-id="${windowId}"]`);
            if (taskbarButton) {
                taskbarButton.classList.add('active');
            }
        }

        function createOrGetTaskbarItem(windowId, windowTitle) {
            let item = taskbarApps.querySelector(`[data-window-id="${windowId}"]`);
            if (!item) {
                item = document.createElement('button');
                item.className = 'taskbar-item';
                item.setAttribute('data-window-id', windowId);
                item.textContent = windowTitle;
                item.addEventListener('click', () => {
                    const windowElement = document.getElementById(windowId);
                    if (windowElement.style.display === 'flex' && activeWindow === windowElement) {
                        // Minimizar
                        windowElement.style.display = 'none';
                        item.classList.remove('active');
                        activeWindow = null;
                    } else {
                        // Restaurar ou trazer para frente
                        windowElement.style.display = 'flex';
                        bringToFront(windowElement);
                    }
                });
                taskbarApps.appendChild(item);
            }
            return item;
        }

        function openWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (!windowElement) return;

            const titleSpan = windowElement.querySelector('.window-title');
            const windowTitle = titleSpan ? titleSpan.textContent.replace(' - WZZM', '') : windowId;

            // **Lógica de Tela Cheia para a Janela de Artigos**
            if (windowId === 'window-artigos') {
                const taskbarHeight = 40; // Altura da barra de tarefas
                
                windowElement.style.width = '100%';
                windowElement.style.height = (desktopHeight - taskbarHeight) + 'px';
                windowElement.style.top = '0';
                windowElement.style.left = '0';
                // Remove a capacidade de arrastar/redimensionar em tela cheia (opcional)
                windowElement.style.resize = 'none'; 
            } else {
                // Lógica de Janela Flutuante para as outras
                 windowElement.style.resize = 'both';
            }


            windowElement.style.display = 'flex';
            
            createOrGetTaskbarItem(windowId, windowTitle);
            bringToFront(windowElement);
        }
        
        function closeWindow(windowElement) {
            const windowId = windowElement.id;
            windowElement.style.display = 'none';

            const taskbarItem = taskbarApps.querySelector(`[data-window-id="${windowId}"]`);
            if (taskbarItem) {
                taskbarItem.remove();
            }
            if (activeWindow === windowElement) {
                activeWindow = null;
            }
        }

        function makeWindowDraggableAndResizable(windowElement) {
            const titleBar = windowElement.querySelector('.window-title-bar');
            
            // Lógica de Arrastar (Mantida)
            windowElement.addEventListener('mousedown', (e) => {
                 const isControl = e.target.closest('button, input, textarea, select');
                if (!isControl) {
                    bringToFront(windowElement);
                }
            });

            titleBar.addEventListener('mousedown', (e) => {
                if (e.target.tagName !== 'BUTTON') {
                    bringToFront(windowElement);
                    e.preventDefault();
                    let shiftX = e.clientX - windowElement.getBoundingClientRect().left;
                    let shiftY = e.clientY - windowElement.getBoundingClientRect().top;

                    function moveAt(pageX, pageY) {
                        let newLeft = pageX - shiftX;
                        let newTop = pageY - shiftY;
                        
                        const desktop = document.getElementById('windows-desktop');
                        const desktopRect = desktop.getBoundingClientRect();
                        
                        // Limites
                        if (newLeft < -windowElement.offsetWidth + 50) newLeft = -windowElement.offsetWidth + 50;
                        if (newTop < 0) newTop = 0;
                        if (newLeft + windowElement.offsetWidth > desktopRect.width) newLeft = desktopRect.width - windowElement.offsetWidth;
                        if (newTop + windowElement.offsetHeight > desktopRect.height - 40) newTop = desktopRect.height - 40; 

                        windowElement.style.left = newLeft + 'px';
                        windowElement.style.top = newTop + 'px';
                    }

                    function onMouseMove(e) { moveAt(e.pageX, e.pageY); }
                    document.addEventListener('mousemove', onMouseMove);
                    titleBar.onmouseup = function() {
                        document.removeEventListener('mousemove', onMouseMove);
                        titleBar.onmouseup = null;
                    };
                }
            });
            titleBar.ondragstart = () => false; 

            // Lógica de Controles
            windowElement.querySelector('.close-btn').addEventListener('click', () => {
                closeWindow(windowElement);
            });
            
            windowElement.querySelector('.minimize-btn').addEventListener('click', () => {
                windowElement.style.display = 'none';
                const taskbarButton = taskbarApps.querySelector(`[data-window-id="${windowElement.id}"]`);
                if(taskbarButton) taskbarButton.classList.remove('active'); 
                if (activeWindow === windowElement) activeWindow = null;
            });
        }
        
        // --- INICIALIZAÇÃO DA INTERFACE ---

        // 1. Inicializa todas as janelas para serem arrastáveis/redimensionáveis
        document.querySelectorAll('.window-frame').forEach(makeWindowDraggableAndResizable);

        // 2. Lógica do Menu Iniciar
        startButton.addEventListener('click', (e) => {
            e.stopPropagation(); 
            startMenu.style.display = startMenu.style.display === 'flex' ? 'none' : 'flex';
            startButton.classList.toggle('active', startMenu.style.display === 'flex');
        });

        document.addEventListener('click', (e) => {
            if (startMenu.style.display === 'flex' && !startButton.contains(e.target) && !startMenu.contains(e.target)) {
                startMenu.style.display = 'none';
                startButton.classList.remove('active');
            }
        });

        // 3. Abrir Janelas pelo Menu Iniciar
        document.querySelectorAll('#start-menu .start-menu-item').forEach(item => {
            item.addEventListener('click', (e) => {
                const windowId = e.currentTarget.getAttribute('data-window-id');
                if (windowId) {
                    openWindow(windowId);
                }
                startMenu.style.display = 'none';
                startButton.classList.remove('active');
            });
        });

        // 4. Abrir Janelas pelos Ícones do Desktop (Duplo Clique)
        desktopIcons.forEach(icon => {
            icon.addEventListener('dblclick', (e) => { 
                const windowId = e.currentTarget.getAttribute('data-window-id');
                if (windowId) {
                    openWindow(windowId);
                }
            });
        });
        
        // 5. Simulação de Desligar/Sair
        startMenuLogout.addEventListener('click', () => {
             alert('Simulando o desligamento do sistema...');
             windowsDesktop.style.display = 'none';
        });
        
        // 6. Inicia a janela de Artigos (iframe) ao carregar
        openWindow('window-artigos'); 
        
    });
    </script>

</body>
</html>
