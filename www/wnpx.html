<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wiki Not P√©dia - Perfil e Configura√ß√£o</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos gerais */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1000px;
        }

        /* Card principal */
        .main-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .logo-icon {
            font-size: 48px;
            color: white;
        }

        .logo-text {
            font-size: 36px;
            font-weight: bold;
        }

        .card-subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .progress-container {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Conte√∫do do card */
        .card-content {
            padding: 30px;
            color: #333;
        }

        .welcome-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .welcome-icon {
            font-size: 64px;
            color: #1a2980;
            margin-bottom: 20px;
        }

        .welcome-title {
            font-size: 28px;
            color: #1a2980;
            margin-bottom: 10px;
        }

        .welcome-message {
            color: #666;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .user-info-summary {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid #1a2980;
        }

        .user-info-row {
            display: flex;
            margin-bottom: 10px;
            align-items: center;
        }

        .info-label {
            flex: 0 0 150px;
            font-weight: bold;
            color: #555;
        }

        .info-value {
            flex: 1;
            color: #333;
        }

        .info-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-complete {
            background: #4CAF50;
            color: white;
        }

        .status-incomplete {
            background: #ff9800;
            color: white;
        }

        /* Se√ß√µes do formul√°rio */
        .form-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        .section-title {
            color: #1a2980;
            font-size: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            font-size: 24px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-label.required::after {
            content: " *";
            color: #f44336;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #1a2980;
            box-shadow: 0 0 0 3px rgba(26, 41, 128, 0.1);
        }

        .form-input.error {
            border-color: #f44336;
        }

        .form-hint {
            font-size: 12px;
            color: #777;
            margin-top: 5px;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .checkbox-group input {
            margin-right: 10px;
            margin-top: 3px;
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .checkbox-group label {
            color: #555;
            font-size: 14px;
            line-height: 1.5;
        }

        .checkbox-group a {
            color: #1a2980;
            text-decoration: none;
            font-weight: 500;
        }

        .checkbox-group a:hover {
            text-decoration: underline;
        }

        .checkbox-group.required {
            border-left: 3px solid #f44336;
            background: #fff5f5;
        }

        /* Bot√µes */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            flex: 1;
            min-width: 200px;
        }

        @media (max-width: 768px) {
            .btn {
                min-width: 100%;
            }
        }

        .btn-primary {
            background: linear-gradient(to right, #1a2980, #26d0ce);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(to right, #142066, #20b8b5);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 41, 128, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        /* Mensagens */
        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4CAF50;
            display: block;
        }

        .message.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
            display: block;
        }

        .message.info {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #2196f3;
            display: block;
        }

        /* Status de carregamento */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1a2980;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Footer */
        .card-footer {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            text-align: center;
            color: #666;
            font-size: 14px;
        }

        .card-footer a {
            color: #1a2980;
            text-decoration: none;
        }

        .card-footer a:hover {
            text-decoration: underline;
        }

        /* Etapas do processo */
        .steps-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .steps-container::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 50px;
            right: 50px;
            height: 2px;
            background: #e0e0e0;
            z-index: 1;
        }

        .step {
            text-align: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-number {
            width: 30px;
            height: 30px;
            background: #e0e0e0;
            color: #777;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px auto;
            font-weight: bold;
            transition: all 0.3s;
        }

        .step.active .step-number {
            background: #1a2980;
            color: white;
            transform: scale(1.1);
        }

        .step.completed .step-number {
            background: #4CAF50;
            color: white;
        }

        .step-label {
            font-size: 12px;
            color: #777;
        }

        .step.active .step-label {
            color: #1a2980;
            font-weight: bold;
        }

        /* Contador de campos obrigat√≥rios */
        .required-counter {
            background: #ff9800;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-card">
            <!-- Cabe√ßalho -->
            <div class="card-header">
                <div class="logo-container">
                    <i class="fas fa-book-open logo-icon"></i>
                    <div class="logo-text">Wiki Not P√©dia</div>
                </div>
                <div class="card-subtitle">Complete seu perfil para acessar a enciclop√©dia</div>
                
                <div class="progress-container">
                    <div class="progress-text">
                        <span>Completo do perfil</span>
                        <span id="progressPercentage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
            </div>

            <!-- Etapas -->
            <div class="steps-container">
                <div class="step active" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-label">Dados Pessoais</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-label">Dados de Contato</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-label">Confirma√ß√£o</div>
                </div>
            </div>

            <!-- Conte√∫do -->
            <div class="card-content">
                <!-- Mensagens -->
                <div class="message" id="successMessage">
                    <i class="fas fa-check-circle"></i> Perfil salvo com sucesso! Redirecionando para a p√°gina principal...
                </div>
                <div class="message error" id="errorMessage">
                    <i class="fas fa-exclamation-circle"></i> <span id="errorText"></span>
                </div>

                <!-- Carregando -->
                <div class="loading" id="loadingIndicator">
                    <div class="loading-spinner"></div>
                    <p>Processando sua solicita√ß√£o...</p>
                </div>

                <!-- Se√ß√£o 1: Dados Pessoais -->
                <div class="form-section" id="sectionPersonal">
                    <h3 class="section-title">
                        <i class="fas fa-user"></i> Dados Pessoais
                        <span class="required-counter" id="requiredPersonal">5 obrigat√≥rios</span>
                    </h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="fullName">Nome Completo</label>
                            <input type="text" id="fullName" class="form-input" placeholder="Seu nome completo" required>
                            <div class="form-hint">Como aparece em documentos oficiais</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="socialName">Nome Social</label>
                            <input type="text" id="socialName" class="form-input" placeholder="Nome pelo qual prefere ser chamado">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="birthDate">Data de Nascimento</label>
                            <input type="date" id="birthDate" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label required" for="gender">G√™nero</label>
                            <select id="gender" class="form-input" required>
                                <option value="">Selecione</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Feminino">Feminino</option>
                                <option value="N√£o-bin√°rio">N√£o-bin√°rio</option>
                                <option value="Outro">Outro</option>
                                <option value="Prefiro n√£o informar">Prefiro n√£o informar</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="cpf">CPF</label>
                            <input type="text" id="cpf" class="form-input" placeholder="000.000.000-00" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label required" for="rg">RG</label>
                            <input type="text" id="rg" class="form-input" placeholder="N√∫mero do RG" required>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o 2: Dados de Contato -->
                <div class="form-section" id="sectionContact" style="display: none;">
                    <h3 class="section-title">
                        <i class="fas fa-address-book"></i> Dados de Contato
                        <span class="required-counter" id="requiredContact">3 obrigat√≥rios</span>
                    </h3>

                    <div class="form-group">
                        <label class="form-label required" for="address">Endere√ßo Completo</label>
                        <input type="text" id="address" class="form-input" placeholder="Rua, n√∫mero, bairro" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="cep">CEP</label>
                            <input type="text" id="cep" class="form-input" placeholder="00000-000" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label required" for="city">Cidade</label>
                            <input type="text" id="city" class="form-input" placeholder="Sua cidade" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="state">Estado</label>
                            <select id="state" class="form-input" required>
                                <option value="">Selecione</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amap√°</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Cear√°</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Esp√≠rito Santo</option>
                                <option value="GO">Goi√°s</option>
                                <option value="MA">Maranh√£o</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Par√°</option>
                                <option value="PB">Para√≠ba</option>
                                <option value="PR">Paran√°</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piau√≠</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rond√¥nia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">S√£o Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="country">Pa√≠s</label>
                            <input type="text" id="country" class="form-input" value="Brasil" readonly>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="phone">Telefone</label>
                            <input type="tel" id="phone" class="form-input" placeholder="(00) 00000-0000" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="additionalEmail">E-mail Adicional</label>
                            <input type="email" id="additionalEmail" class="form-input" placeholder="email@adicional.com">
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o 3: Confirma√ß√£o -->
                <div class="form-section" id="sectionConfirmation" style="display: none;">
                    <h3 class="section-title">
                        <i class="fas fa-check-circle"></i> Confirma√ß√£o dos Dados
                    </h3>

                    <div class="welcome-section">
                        <i class="fas fa-user-check welcome-icon"></i>
                        <h3 class="welcome-title">Confirme seus dados</h3>
                        <p class="welcome-message">
                            Verifique se todas as informa√ß√µes abaixo est√£o corretas antes de prosseguir.
                            Ap√≥s a confirma√ß√£o, voc√™ ser√° redirecionado para a p√°gina principal da Wiki Not P√©dia.
                        </p>
                    </div>

                    <div class="user-info-summary">
                        <div class="user-info-row">
                            <div class="info-label">Nome Completo:</div>
                            <div class="info-value" id="confirmFullName">-</div>
                        </div>
                        <div class="user-info-row">
                            <div class="info-label">Data de Nascimento:</div>
                            <div class="info-value" id="confirmBirthDate">-</div>
                        </div>
                        <div class="user-info-row">
                            <div class="info-label">CPF:</div>
                            <div class="info-value" id="confirmCPF">-</div>
                        </div>
                        <div class="user-info-row">
                            <div class="info-label">Endere√ßo:</div>
                            <div class="info-value" id="confirmAddress">-</div>
                        </div>
                        <div class="user-info-row">
                            <div class="info-label">Telefone:</div>
                            <div class="info-value" id="confirmPhone">-</div>
                        </div>
                        <div class="user-info-row">
                            <div class="info-label">Status do Perfil:</div>
                            <div class="info-value">
                                <span id="confirmStatus">Incompleto</span>
                                <span class="info-status status-incomplete">Pendente</span>
                            </div>
                        </div>
                    </div>

                    <!-- CHECKBOX DOS TERMOS DE SERVI√áO ADICIONADO AQUI -->
                    <div class="checkbox-group required" id="termsGroup">
                        <input type="checkbox" id="termsAgreement" required>
                        <label for="termsAgreement">
                            <strong>Declaro que as informa√ß√µes fornecidas s√£o verdadeiras e concordo com os</strong>
                            <a href="https://wazzimagiygg.com/Termos%20de%20Servi%C3%A7o.pdf" target="_blank">Termos de Servi√ßo</a>
                            <strong>e</strong>
                            <a href="https://wazzimagiygg.com/Pol%C3%ADtica%20de%20Privacidade.pdf" target="_blank">Pol√≠tica de Privacidade</a>
                            <strong>da Wiki Not P√©dia.</strong>
                        </label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="newsletterOptin">
                        <label for="newsletterOptin">
                            Desejo receber novidades e atualiza√ß√µes da Wiki Not P√©dia por e-mail
                        </label>
                    </div>
                </div>

                <!-- Bot√µes de a√ß√£o -->
                <div class="action-buttons">
                    <button class="btn btn-secondary" id="btnBack" onclick="previousStep()" style="display: none;">
                        <i class="fas fa-arrow-left"></i> Voltar
                    </button>
                    
                    <div style="flex: 1;"></div>
                    
                    <button class="btn btn-primary" id="btnNext" onclick="nextStep()">
                        Pr√≥ximo <i class="fas fa-arrow-right"></i>
                    </button>
                    
                    <button class="btn btn-success" id="btnComplete" onclick="completeProfile()" style="display: none;">
                        <i class="fas fa-check"></i> Confirmar e Acessar Wiki
                    </button>
                </div>
            </div>

            <!-- Rodap√© -->
            <div class="card-footer">
                <p>
                    <i class="fas fa-shield-alt"></i> Seus dados est√£o protegidos por criptografia. 
                    <a href="https://wazzimagiygg.com/Pol%C3%ADtica%20de%20Privacidade.pdf" target="_blank">Saiba mais sobre nossa seguran√ßa</a>
                </p>
                <p style="margin-top: 10px; font-size: 12px;">
                    Wiki Not P√©dia &copy; 2024. Todos os direitos reservados.
                </p>
            </div>
        </div>
    </div>

    <script>
        // üîπ Sistema de Etapas do Perfil
        let currentStep = 1;
        const totalSteps = 3;
        let userData = {};
        let isSubmitting = false;

        // üîπ Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            // Verificar se usu√°rio est√° logado
            checkLoginStatus();
            
            // Carregar dados existentes do usu√°rio
            loadExistingData();
            
            // Configurar m√°scaras de entrada
            setupInputMasks();
            
            // Atualizar progresso inicial
            updateProgress();
            
            // Adicionar valida√ß√£o visual ao checkbox dos termos
            const termsCheckbox = document.getElementById('termsAgreement');
            if (termsCheckbox) {
                termsCheckbox.addEventListener('change', function() {
                    const termsGroup = document.getElementById('termsGroup');
                    if (this.checked) {
                        termsGroup.style.background = '#e8f5e9';
                        termsGroup.style.borderLeftColor = '#4CAF50';
                    } else {
                        termsGroup.style.background = '#fff5f5';
                        termsGroup.style.borderLeftColor = '#f44336';
                    }
                });
            }
        });

        // üîπ Verificar status de login
        function checkLoginStatus() {
            const userData = localStorage.getItem('wikiUser');
            
            if (!userData) {
                // Usu√°rio n√£o est√° logado, redirecionar para login
                alert('Voc√™ precisa estar logado para acessar esta p√°gina.');
                window.location.href = 'login.html';
                return;
            }
            
            try {
                const user = JSON.parse(userData);
                console.log('Usu√°rio logado:', user);
                
                // Verificar se o perfil j√° est√° completo
                const isProfileComplete = localStorage.getItem('profileComplete') === 'true';
                
                if (isProfileComplete) {
                    // Se o perfil j√° est√° completo, redirecionar diretamente para wikinotpedia.html
                    showMessage('info', 'Seu perfil j√° est√° completo. Redirecionando para a p√°gina principal...');
                    setTimeout(() => {
                        window.location.href = 'wikinotpedia.html';
                    }, 2000);
                }
                
            } catch (error) {
                console.error('Erro ao verificar login:', error);
                window.location.href = 'login.html';
            }
        }

        // üîπ Carregar dados existentes
        function loadExistingData() {
            try {
                const savedData = localStorage.getItem('clientData');
                if (savedData) {
                    userData = JSON.parse(savedData);
                    
                    // Preencher campos com dados existentes
                    if (userData.fullName) document.getElementById('fullName').value = userData.fullName;
                    if (userData.socialName) document.getElementById('socialName').value = userData.socialName;
                    if (userData.birthDate) document.getElementById('birthDate').value = userData.birthDate;
                    if (userData.gender) document.getElementById('gender').value = userData.gender;
                    if (userData.cpf) document.getElementById('cpf').value = formatCPF(userData.cpf);
                    if (userData.rg) document.getElementById('rg').value = userData.rg;
                    if (userData.address) document.getElementById('address').value = userData.address;
                    if (userData.zipCode) document.getElementById('cep').value = userData.zipCode;
                    if (userData.city) document.getElementById('city').value = userData.city;
                    if (userData.state) document.getElementById('state').value = userData.state;
                    if (userData.country) document.getElementById('country').value = userData.country;
                    if (userData.phoneNumber) document.getElementById('phone').value = formatPhone(userData.phoneNumber);
                    if (userData.emailAdditional) document.getElementById('additionalEmail').value = userData.emailAdditional;
                    
                    // Preencher checkbox dos termos se j√° aceitou anteriormente
                    if (userData.termsAccepted) {
                        document.getElementById('termsAgreement').checked = true;
                        const termsGroup = document.getElementById('termsGroup');
                        termsGroup.style.background = '#e8f5e9';
                        termsGroup.style.borderLeftColor = '#4CAF50';
                    }
                    
                    // Preencher newsletter se j√° optou anteriormente
                    if (userData.newsletterOptin) {
                        document.getElementById('newsletterOptin').checked = true;
                    }
                    
                    console.log('Dados existentes carregados:', userData);
                }
            } catch (error) {
                console.error('Erro ao carregar dados existentes:', error);
            }
            
            updateRequiredCounters();
        }

        // üîπ Configurar m√°scaras de entrada
        function setupInputMasks() {
            // M√°scara para CPF
            const cpfInput = document.getElementById('cpf');
            cpfInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                
                if (value.length > 11) value = value.substring(0, 11);
                
                if (value.length > 9) {
                    value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
                } else if (value.length > 6) {
                    value = value.replace(/(\d{3})(\d{3})(\d{3})/, '$1.$2.$3');
                } else if (value.length > 3) {
                    value = value.replace(/(\d{3})(\d{3})/, '$1.$2');
                }
                
                e.target.value = value;
            });

            // M√°scara para CEP
            const cepInput = document.getElementById('cep');
            cepInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                
                if (value.length > 8) value = value.substring(0, 8);
                
                if (value.length > 5) {
                    value = value.replace(/(\d{5})(\d{3})/, '$1-$2');
                }
                
                e.target.value = value;
                
                // Buscar CEP automaticamente (opcional)
                if (value.replace(/\D/g, '').length === 8) {
                    // Aqui poderia chamar uma API de CEP
                }
            });

            // M√°scara para telefone
            const phoneInput = document.getElementById('phone');
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                
                if (value.length > 11) value = value.substring(0, 11);
                
                if (value.length > 10) {
                    value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                } else if (value.length > 6) {
                    value = value.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
                } else if (value.length > 2) {
                    value = value.replace(/(\d{2})(\d{4})/, '($1) $2');
                } else if (value.length > 0) {
                    value = value.replace(/(\d{2})/, '($1)');
                }
                
                e.target.value = value;
            });
        }

        // üîπ Formatar CPF
        function formatCPF(cpf) {
            cpf = cpf.replace(/\D/g, '');
            if (cpf.length === 11) {
                return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            }
            return cpf;
        }

        // üîπ Formatar telefone
        function formatPhone(phone) {
            phone = phone.replace(/\D/g, '');
            if (phone.length === 11) {
                return phone.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (phone.length === 10) {
                return phone.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
            }
            return phone;
        }

        // üîπ Atualizar contadores de campos obrigat√≥rios
        function updateRequiredCounters() {
            // Contar campos obrigat√≥rios preenchidos na se√ß√£o 1
            const personalFields = [
                'fullName', 'birthDate', 'gender', 'cpf', 'rg'
            ];
            
            let filledPersonal = 0;
            let requiredPersonal = personalFields.length;
            
            personalFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && field.value.trim()) {
                    filledPersonal++;
                }
            });
            
            document.getElementById('requiredPersonal').textContent = 
                `${requiredPersonal - filledPersonal} obrigat√≥rios restantes`;
            
            // Contar campos obrigat√≥rios preenchidos na se√ß√£o 2
            const contactFields = [
                'address', 'cep', 'city', 'state', 'phone'
            ];
            
            let filledContact = 0;
            let requiredContact = contactFields.length;
            
            contactFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && field.value.trim()) {
                    filledContact++;
                }
            });
            
            document.getElementById('requiredContact').textContent = 
                `${requiredContact - filledContact} obrigat√≥rios restantes`;
            
            // Atualizar progresso geral
            updateProgress();
        }

        // üîπ Atualizar barra de progresso
        function updateProgress() {
            const totalRequired = 8; // 5 pessoais + 3 de contato
            let filledRequired = 0;
            
            // Campos obrigat√≥rios pessoais
            const personalFields = ['fullName', 'birthDate', 'gender', 'cpf', 'rg'];
            personalFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && field.value.trim()) filledRequired++;
            });
            
            // Campos obrigat√≥rios de contato
            const contactFields = ['address', 'cep', 'phone'];
            contactFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && field.value.trim()) filledRequired++;
            });
            
            const percentage = Math.round((filledRequired / totalRequired) * 100);
            
            document.getElementById('progressPercentage').textContent = `${percentage}%`;
            document.getElementById('progressFill').style.width = `${percentage}%`;
            
            return percentage;
        }

        // üîπ Validar etapa atual
        function validateCurrentStep() {
            let isValid = true;
            let errorMessage = '';
            
            if (currentStep === 1) {
                // Validar dados pessoais
                if (!document.getElementById('fullName').value.trim()) {
                    isValid = false;
                    errorMessage = 'O nome completo √© obrigat√≥rio.';
                } else if (!document.getElementById('birthDate').value) {
                    isValid = false;
                    errorMessage = 'A data de nascimento √© obrigat√≥ria.';
                } else if (!document.getElementById('gender').value) {
                    isValid = false;
                    errorMessage = 'O g√™nero √© obrigat√≥rio.';
                } else if (!document.getElementById('cpf').value.trim()) {
                    isValid = false;
                    errorMessage = 'O CPF √© obrigat√≥rio.';
                } else if (document.getElementById('cpf').value.replace(/\D/g, '').length !== 11) {
                    isValid = false;
                    errorMessage = 'CPF inv√°lido. Deve conter 11 d√≠gitos.';
                } else if (!document.getElementById('rg').value.trim()) {
                    isValid = false;
                    errorMessage = 'O RG √© obrigat√≥rio.';
                }
            } else if (currentStep === 2) {
                // Validar dados de contato
                if (!document.getElementById('address').value.trim()) {
                    isValid = false;
                    errorMessage = 'O endere√ßo √© obrigat√≥rio.';
                } else if (!document.getElementById('cep').value.trim()) {
                    isValid = false;
                    errorMessage = 'O CEP √© obrigat√≥rio.';
                } else if (document.getElementById('cep').value.replace(/\D/g, '').length !== 8) {
                    isValid = false;
                    errorMessage = 'CEP inv√°lido. Deve conter 8 d√≠gitos.';
                } else if (!document.getElementById('city').value.trim()) {
                    isValid = false;
                    errorMessage = 'A cidade √© obrigat√≥ria.';
                } else if (!document.getElementById('state').value) {
                    isValid = false;
                    errorMessage = 'O estado √© obrigat√≥rio.';
                } else if (!document.getElementById('phone').value.trim()) {
                    isValid = false;
                    errorMessage = 'O telefone √© obrigat√≥rio.';
                } else if (document.getElementById('phone').value.replace(/\D/g, '').length < 10) {
                    isValid = false;
                    errorMessage = 'Telefone inv√°lido. Deve conter pelo menos 10 d√≠gitos.';
                }
            }
            
            return { isValid, errorMessage };
        }

        // üîπ Salvar dados da etapa atual
        function saveCurrentStepData() {
            if (currentStep === 1) {
                userData.fullName = document.getElementById('fullName').value.trim();
                userData.socialName = document.getElementById('socialName').value.trim();
                userData.birthDate = document.getElementById('birthDate').value;
                userData.gender = document.getElementById('gender').value;
                userData.cpf = document.getElementById('cpf').value.replace(/\D/g, '');
                userData.rg = document.getElementById('rg').value.trim();
            } else if (currentStep === 2) {
                userData.address = document.getElementById('address').value.trim();
                userData.zipCode = document.getElementById('cep').value.replace(/\D/g, '');
                userData.city = document.getElementById('city').value.trim();
                userData.state = document.getElementById('state').value;
                userData.country = document.getElementById('country').value;
                userData.phoneNumber = document.getElementById('phone').value.replace(/\D/g, '');
                userData.emailAdditional = document.getElementById('additionalEmail').value.trim();
            }
            
            // Atualizar contadores
            updateRequiredCounters();
            
            console.log('Dados salvos da etapa', currentStep, ':', userData);
        }

        // üîπ Pr√≥xima etapa
        function nextStep() {
            if (isSubmitting) return;
            
            // Validar etapa atual
            const validation = validateCurrentStep();
            
            if (!validation.isValid) {
                showMessage('error', validation.errorMessage);
                return;
            }
            
            // Salvar dados da etapa atual
            saveCurrentStepData();
            
            // Esconder etapa atual
            document.getElementById(`section${getSectionName(currentStep)}`).style.display = 'none';
            
            // Atualizar etapa
            document.getElementById(`step${currentStep}`).classList.remove('active');
            currentStep++;
            
            // Atualizar bot√µes
            document.getElementById('btnBack').style.display = 'inline-flex';
            
            if (currentStep === totalSteps) {
                document.getElementById('btnNext').style.display = 'none';
                document.getElementById('btnComplete').style.display = 'inline-flex';
                
                // Preencher dados de confirma√ß√£o
                fillConfirmationData();
            }
            
            // Mostrar pr√≥xima etapa
            document.getElementById(`section${getSectionName(currentStep)}`).style.display = 'block';
            document.getElementById(`step${currentStep}`).classList.add('active');
            
            // Rolar para o topo
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // üîπ Etapa anterior
        function previousStep() {
            if (isSubmitting) return;
            
            // Esconder etapa atual
            document.getElementById(`section${getSectionName(currentStep)}`).style.display = 'none';
            
            // Atualizar etapa
            document.getElementById(`step${currentStep}`).classList.remove('active');
            currentStep--;
            
            // Atualizar bot√µes
            if (currentStep === 1) {
                document.getElementById('btnBack').style.display = 'none';
            }
            
            document.getElementById('btnNext').style.display = 'inline-flex';
            document.getElementById('btnComplete').style.display = 'none';
            
            // Mostrar etapa anterior
            document.getElementById(`section${getSectionName(currentStep)}`).style.display = 'block';
            document.getElementById(`step${currentStep}`).classList.add('active');
            
            // Rolar para o topo
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // üîπ Obter nome da se√ß√£o
        function getSectionName(step) {
            switch(step) {
                case 1: return 'Personal';
                case 2: return 'Contact';
                case 3: return 'Confirmation';
                default: return 'Personal';
            }
        }

        // üîπ Preencher dados de confirma√ß√£o
        function fillConfirmationData() {
            document.getElementById('confirmFullName').textContent = userData.fullName || '-';
            document.getElementById('confirmBirthDate').textContent = 
                userData.birthDate ? new Date(userData.birthDate).toLocaleDateString('pt-BR') : '-';
            document.getElementById('confirmCPF').textContent = 
                userData.cpf ? formatCPF(userData.cpf) : '-';
            document.getElementById('confirmAddress').textContent = 
                `${userData.address || ''}, ${userData.city || ''} - ${userData.state || ''}`;
            document.getElementById('confirmPhone').textContent = 
                userData.phoneNumber ? formatPhone(userData.phoneNumber) : '-';
            
            // Verificar se todos os campos obrigat√≥rios est√£o preenchidos
            const progress = updateProgress();
            if (progress === 100) {
                document.getElementById('confirmStatus').textContent = 'Completo';
                const statusElement = document.querySelector('.status-incomplete');
                if (statusElement) {
                    statusElement.className = 'info-status status-complete';
                    statusElement.textContent = 'Completo';
                }
            }
        }

        // üîπ Completar perfil
        function completeProfile() {
            if (isSubmitting) return;
            
            // Validar aceite dos Termos de Servi√ßo
            const termsCheckbox = document.getElementById('termsAgreement');
            if (!termsCheckbox || !termsCheckbox.checked) {
                showMessage('error', 'Voc√™ precisa aceitar os Termos de Servi√ßo e Pol√≠tica de Privacidade para continuar.');
                
                // Destacar visualmente o campo obrigat√≥rio
                const termsGroup = document.getElementById('termsGroup');
                if (termsGroup) {
                    termsGroup.style.background = '#fff5f5';
                    termsGroup.style.borderLeftColor = '#f44336';
                    termsGroup.style.animation = 'shake 0.5s';
                    
                    // Remover anima√ß√£o ap√≥s execu√ß√£o
                    setTimeout(() => {
                        termsGroup.style.animation = '';
                    }, 500);
                }
                
                // Rolar para o checkbox dos termos
                window.scrollTo({ 
                    top: termsGroup.offsetTop - 100, 
                    behavior: 'smooth' 
                });
                
                return;
            }
            
            // Validar dados finais
            const validation = validateCurrentStep();
            if (!validation.isValid) {
                showMessage('error', validation.errorMessage);
                return;
            }
            
            // Salvar dados da etapa atual
            saveCurrentStepData();
            
            // Adicionar dados adicionais
            userData.newsletterOptin = document.getElementById('newsletterOptin').checked;
            userData.termsAccepted = true;
            userData.termsAcceptedAt = new Date().toISOString();
            userData.profileCompletedAt = new Date().toISOString();
            userData.profileCompleted = true;
            
            // Mostrar indicador de carregamento
            showLoading(true);
            
            // Simular processamento (em produ√ß√£o, enviar para backend)
            setTimeout(() => {
                // Salvar dados no localStorage
                try {
                    localStorage.setItem('clientData', JSON.stringify(userData));
                    localStorage.setItem('profileComplete', 'true');
                    
                    // Atualizar nome no wikiUser
                    const wikiUser = JSON.parse(localStorage.getItem('wikiUser') || '{}');
                    wikiUser.name = userData.fullName;
                    wikiUser.profileCompleted = true;
                    localStorage.setItem('wikiUser', JSON.stringify(wikiUser));
                    
                    console.log('Perfil salvo com sucesso:', userData);
                    
                    // Mostrar mensagem de sucesso
                    showMessage('success', 'Perfil salvo com sucesso! Redirecionando para a p√°gina principal...');
                    
                    // Redirecionar para wikinotpedia.html ap√≥s 2 segundos
                    setTimeout(() => {
                        window.location.href = 'wikinotpedia.html';
                    }, 2000);
                    
                } catch (error) {
                    console.error('Erro ao salvar perfil:', error);
                    showMessage('error', 'Erro ao salvar perfil. Tente novamente.');
                    showLoading(false);
                }
            }, 1500);
        }

        // üîπ Mostrar mensagem
        function showMessage(type, text) {
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            
            // Esconder todas as mensagens
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';
            
            // Mostrar mensagem apropriada
            if (type === 'success') {
                successMessage.style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else if (type === 'error') {
                errorText.textContent = text;
                errorMessage.style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else if (type === 'info') {
                // Para mensagens informativas, usar alert simples
                alert(text);
            }
        }

        // üîπ Mostrar/ocultar carregamento
        function showLoading(show) {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const actionButtons = document.querySelector('.action-buttons');
            
            if (show) {
                isSubmitting = true;
                loadingIndicator.style.display = 'block';
                actionButtons.style.display = 'none';
            } else {
                isSubmitting = false;
                loadingIndicator.style.display = 'none';
                actionButtons.style.display = 'flex';
            }
        }

        // üîπ Ouvir mudan√ßas nos campos para atualizar contadores
        document.querySelectorAll('.form-input').forEach(input => {
            input.addEventListener('input', updateRequiredCounters);
            input.addEventListener('change', updateRequiredCounters);
        });

        // üîπ Ouvir mudan√ßas em selects
        document.querySelectorAll('select').forEach(select => {
            select.addEventListener('change', updateRequiredCounters);
        });
        
        // üîπ Adicionar anima√ß√£o de shake (para destacar erro)
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                20%, 40%, 60%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
